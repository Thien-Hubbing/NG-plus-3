import{a as e,t}from"./chunk-CoEicJgV.js";import{n}from"./vue.runtime.esm-D16ICdaY.js";import{t as r}from"./constants-hHFhCqyo.js";import{t as i}from"./vuedraggable.umd-D85QxfcV.js";import{t as a}from"./_plugin-vue2_normalizer-Djvn235C.js";var o=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});function t(e){return e&&e.length===0}exports.isEmpty=t;function n(e){return e==null?[]:Object.keys(e)}exports.keys=n;function r(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++)t.push(e[n[r]]);return t}exports.values=r;function i(e,t){for(var r=[],i=n(e),a=0;a<i.length;a++){var o=i[a];r.push(t.call(null,e[o],o))}return r}exports.mapValues=i;function a(e,t){for(var n=[],r=0;r<e.length;r++)n.push(t.call(null,e[r],r));return n}exports.map=a;function o(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?t=t.concat(o(r)):t.push(r)}return t}exports.flatten=o;function s(e){return t(e)?void 0:e[0]}exports.first=s;function c(e){var t=e&&e.length;return t?e[t-1]:void 0}exports.last=c;function l(e,t){if(Array.isArray(e))for(var r=0;r<e.length;r++)t.call(null,e[r],r);else if(A(e))for(var i=n(e),r=0;r<i.length;r++){var a=i[r],o=e[a];t.call(null,o,a)}else throw Error(`non exhaustive match`)}exports.forEach=l;function u(e){return typeof e==`string`}exports.isString=u;function d(e){return e===void 0}exports.isUndefined=d;function f(e){return e instanceof Function}exports.isFunction=f;function p(e,t){return t===void 0&&(t=1),e.slice(t,e.length)}exports.drop=p;function m(e,t){return t===void 0&&(t=1),e.slice(0,e.length-t)}exports.dropRight=m;function h(e,t){var n=[];if(Array.isArray(e))for(var r=0;r<e.length;r++){var i=e[r];t.call(null,i)&&n.push(i)}return n}exports.filter=h;function g(e,t){return h(e,function(e){return!t(e)})}exports.reject=g;function _(e,t){for(var n=Object.keys(e),r={},i=0;i<n.length;i++){var a=n[i],o=e[a];t(o)&&(r[a]=o)}return r}exports.pick=_;function v(e,t){return A(e)?e.hasOwnProperty(t):!1}exports.has=v;function y(e,t){return S(e,function(e){return e===t})!==void 0}exports.contains=y;function b(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}exports.cloneArr=b;function x(e){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}exports.cloneObj=x;function S(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(t.call(null,r))return r}}exports.find=S;function C(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];t.call(null,i)&&n.push(i)}return n}exports.findAll=C;function w(e,t,i){for(var a=Array.isArray(e),o=a?e:r(e),s=a?[]:n(e),c=i,l=0;l<o.length;l++)c=t.call(null,c,o[l],a?l:s[l]);return c}exports.reduce=w;function T(e){return g(e,function(e){return e==null})}exports.compact=T;function E(e,t){t===void 0&&(t=function(e){return e});var n=[];return w(e,function(e,r){var i=t(r);return y(n,i)?e:(n.push(i),e.concat(r))},[])}exports.uniq=E;function D(e){var t=[...arguments].slice(1),n=[null].concat(t);return Function.bind.apply(e,n)}exports.partial=D;function O(e){return Array.isArray(e)}exports.isArray=O;function k(e){return e instanceof RegExp}exports.isRegExp=k;function A(e){return e instanceof Object}exports.isObject=A;function j(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n))return!1;return!0}exports.every=j;function M(e,t){return g(e,function(e){return y(t,e)})}exports.difference=M;function N(e,t){for(var n=0;n<e.length;n++)if(t(e[n]))return!0;return!1}exports.some=N;function P(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}exports.indexOf=P;function F(e,t){var n=b(e);return n.sort(function(e,n){return t(e)-t(n)}),n}exports.sortBy=F;function ee(e,t){if(e.length!==t.length)throw Error(`can't zipObject with different number of keys and values!`);for(var n={},r=0;r<e.length;r++)n[e[r]]=t[r];return n}exports.zipObject=ee;function te(e){for(var t=[...arguments].slice(1),r=0;r<t.length;r++)for(var i=t[r],a=n(i),o=0;o<a.length;o++){var s=a[o];e[s]=i[s]}return e}exports.assign=te;function I(e){for(var t=[...arguments].slice(1),r=0;r<t.length;r++){var i=t[r];if(!d(i))for(var a=n(i),o=0;o<a.length;o++){var s=a[o];v(e,s)||(e[s]=i[s])}}return e}exports.assignNoOverwrite=I;function L(){var e=[...arguments];return I.apply(null,[{}].concat(e))}exports.defaults=L;function ne(e,t){var n={};return l(e,function(e){var r=t(e),i=n[r];i?i.push(e):n[r]=[e]}),n}exports.groupBy=ne;function re(e,t){for(var r=x(e),i=n(t),a=0;a<i.length;a++){var o=i[a];r[o]=t[o]}return r}exports.merge=re;function ie(){}exports.NOOP=ie;function R(e){return e}exports.IDENTITY=R;function ae(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];t.push(r===void 0?void 0:r)}return t}exports.packArray=ae;function oe(e){console&&console.error&&console.error(`Error: `+e)}exports.PRINT_ERROR=oe;function se(e){console&&console.warn&&console.warn(`Warning: `+e)}exports.PRINT_WARNING=se;function z(){return typeof Map==`function`}exports.isES2015MapSupported=z;function B(e,t){t.forEach(function(t){var n=t.prototype;Object.getOwnPropertyNames(n).forEach(function(r){if(r!==`constructor`){var i=Object.getOwnPropertyDescriptor(n,r);i&&(i.get||i.set)?Object.defineProperty(e.prototype,r,i):e.prototype[r]=t.prototype[r]}})})}exports.applyMixins=B;function ce(e){function t(){}t.prototype=e;var n=new t;function r(){return typeof n.bar}return r(),r(),e}exports.toFastProperties=ce})),s=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o();function n(e){return a(e.constructor)}exports.classNameFromInstance=n;var r=/^\s*function\s*(\S*)\s*\(/,i=`name`;function a(e){return e.name||e.toString().match(r)[1]}exports.functionName=a;function s(e,n){var r=Object.getOwnPropertyDescriptor(e,i);return t.isUndefined(r)||r.configurable?(Object.defineProperty(e,i,{enumerable:!1,configurable:!0,writable:!1,value:n}),!0):!1}exports.defineNameProp=s,exports.HashTable=function(){function e(){this._state={}}return e.prototype.keys=function(){return t.keys(this._state)},e.prototype.values=function(){return t.values(this._state)},e.prototype.put=function(e,t){this._state[e]=t},e.prototype.putAll=function(e){this._state=t.assign(this._state,e._state)},e.prototype.get=function(e){return this._state[e]},e.prototype.containsKey=function(e){return t.has(this._state,e)},e.prototype.clear=function(){this._state={}},e}()})),c=t(((exports,t)=>{(function(e,n){typeof define==`function`&&define.amd?define([],n):typeof t==`object`&&t.exports?t.exports=n():e.regexpToAst=n()})(typeof self<`u`?self:exports,function(){function e(){}e.prototype.saveState=function(){return{idx:this.idx,input:this.input,groupIdx:this.groupIdx}},e.prototype.restoreState=function(e){this.idx=e.idx,this.input=e.input,this.groupIdx=e.groupIdx},e.prototype.pattern=function(e){this.idx=0,this.input=e,this.groupIdx=0,this.consumeChar(`/`);var t=this.disjunction();this.consumeChar(`/`);for(var n={type:`Flags`,global:!1,ignoreCase:!1,multiLine:!1,unicode:!1,sticky:!1};this.isRegExpFlag();)switch(this.popChar()){case`g`:o(n,`global`);break;case`i`:o(n,`ignoreCase`);break;case`m`:o(n,`multiLine`);break;case`u`:o(n,`unicode`);break;case`y`:o(n,`sticky`);break}if(this.idx!==this.input.length)throw Error(`Redundant input: `+this.input.substring(this.idx));return{type:`Pattern`,flags:n,value:t}},e.prototype.disjunction=function(){var e=[];for(e.push(this.alternative());this.peekChar()===`|`;)this.consumeChar(`|`),e.push(this.alternative());return{type:`Disjunction`,value:e}},e.prototype.alternative=function(){for(var e=[];this.isTerm();)e.push(this.term());return{type:`Alternative`,value:e}},e.prototype.term=function(){return this.isAssertion()?this.assertion():this.atom()},e.prototype.assertion=function(){switch(this.popChar()){case`^`:return{type:`StartAnchor`};case`$`:return{type:`EndAnchor`};case`\\`:switch(this.popChar()){case`b`:return{type:`WordBoundary`};case`B`:return{type:`NonWordBoundary`}}throw Error(`Invalid Assertion Escape`);case`(`:this.consumeChar(`?`);var e;switch(this.popChar()){case`=`:e=`Lookahead`;break;case`!`:e=`NegativeLookahead`;break}s(e);var t=this.disjunction();return this.consumeChar(`)`),{type:e,value:t}}c()},e.prototype.quantifier=function(e){var t;switch(this.popChar()){case`*`:t={atLeast:0,atMost:1/0};break;case`+`:t={atLeast:1,atMost:1/0};break;case`?`:t={atLeast:0,atMost:1};break;case`{`:var n=this.integerIncludingZero();switch(this.popChar()){case`}`:t={atLeast:n,atMost:n};break;case`,`:var r;this.isDigit()?(r=this.integerIncludingZero(),t={atLeast:n,atMost:r}):t={atLeast:n,atMost:1/0},this.consumeChar(`}`);break}if(e===!0&&t===void 0)return;s(t);break}if(!(e===!0&&t===void 0))return s(t),this.peekChar(0)===`?`?(this.consumeChar(`?`),t.greedy=!1):t.greedy=!0,t.type=`Quantifier`,t},e.prototype.atom=function(){var e;switch(this.peekChar()){case`.`:e=this.dotAll();break;case`\\`:e=this.atomEscape();break;case`[`:e=this.characterClass();break;case`(`:e=this.group();break}return e===void 0&&this.isPatternCharacter()&&(e=this.patternCharacter()),s(e),this.isQuantifier()&&(e.quantifier=this.quantifier()),e},e.prototype.dotAll=function(){return this.consumeChar(`.`),{type:`Set`,complement:!0,value:[i(`
`),i(`\r`),i(`\u2028`),i(`\u2029`)]}},e.prototype.atomEscape=function(){switch(this.consumeChar(`\\`),this.peekChar()){case`1`:case`2`:case`3`:case`4`:case`5`:case`6`:case`7`:case`8`:case`9`:return this.decimalEscapeAtom();case`d`:case`D`:case`s`:case`S`:case`w`:case`W`:return this.characterClassEscape();case`f`:case`n`:case`r`:case`t`:case`v`:return this.controlEscapeAtom();case`c`:return this.controlLetterEscapeAtom();case`0`:return this.nulCharacterAtom();case`x`:return this.hexEscapeSequenceAtom();case`u`:return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.decimalEscapeAtom=function(){return{type:`GroupBackReference`,value:this.positiveInteger()}},e.prototype.characterClassEscape=function(){var e,t=!1;switch(this.popChar()){case`d`:e=u;break;case`D`:e=u,t=!0;break;case`s`:e=f;break;case`S`:e=f,t=!0;break;case`w`:e=d;break;case`W`:e=d,t=!0;break}return s(e),{type:`Set`,value:e,complement:t}},e.prototype.controlEscapeAtom=function(){var e;switch(this.popChar()){case`f`:e=i(`\f`);break;case`n`:e=i(`
`);break;case`r`:e=i(`\r`);break;case`t`:e=i(`	`);break;case`v`:e=i(`\v`);break}return s(e),{type:`Character`,value:e}},e.prototype.controlLetterEscapeAtom=function(){this.consumeChar(`c`);var e=this.popChar();if(/[a-zA-Z]/.test(e)===!1)throw Error(`Invalid `);return{type:`Character`,value:e.toUpperCase().charCodeAt(0)-64}},e.prototype.nulCharacterAtom=function(){return this.consumeChar(`0`),{type:`Character`,value:i(`\0`)}},e.prototype.hexEscapeSequenceAtom=function(){return this.consumeChar(`x`),this.parseHexDigits(2)},e.prototype.regExpUnicodeEscapeSequenceAtom=function(){return this.consumeChar(`u`),this.parseHexDigits(4)},e.prototype.identityEscapeAtom=function(){var e=this.popChar();return{type:`Character`,value:i(e)}},e.prototype.classPatternCharacterAtom=function(){switch(this.peekChar()){case`
`:case`\r`:case`\u2028`:case`\u2029`:case`\\`:case`]`:throw Error(`TBD`);default:var e=this.popChar();return{type:`Character`,value:i(e)}}},e.prototype.characterClass=function(){var e=[],t=!1;for(this.consumeChar(`[`),this.peekChar(0)===`^`&&(this.consumeChar(`^`),t=!0);this.isClassAtom();){var n=this.classAtom();if(n.type===`Character`&&this.isRangeDash()){this.consumeChar(`-`);var r=this.classAtom();if(r.type===`Character`){if(r.value<n.value)throw Error(`Range out of order in character class`);e.push({from:n.value,to:r.value})}else a(n.value,e),e.push(i(`-`)),a(r.value,e)}else a(n.value,e)}return this.consumeChar(`]`),{type:`Set`,complement:t,value:e}},e.prototype.classAtom=function(){switch(this.peekChar()){case`]`:case`
`:case`\r`:case`\u2028`:case`\u2029`:throw Error(`TBD`);case`\\`:return this.classEscape();default:return this.classPatternCharacterAtom()}},e.prototype.classEscape=function(){switch(this.consumeChar(`\\`),this.peekChar()){case`b`:return this.consumeChar(`b`),{type:`Character`,value:i(`\b`)};case`d`:case`D`:case`s`:case`S`:case`w`:case`W`:return this.characterClassEscape();case`f`:case`n`:case`r`:case`t`:case`v`:return this.controlEscapeAtom();case`c`:return this.controlLetterEscapeAtom();case`0`:return this.nulCharacterAtom();case`x`:return this.hexEscapeSequenceAtom();case`u`:return this.regExpUnicodeEscapeSequenceAtom();default:return this.identityEscapeAtom()}},e.prototype.group=function(){var e=!0;switch(this.consumeChar(`(`),this.peekChar(0)){case`?`:this.consumeChar(`?`),this.consumeChar(`:`),e=!1;break;default:this.groupIdx++;break}var t=this.disjunction();this.consumeChar(`)`);var n={type:`Group`,capturing:e,value:t};return e&&(n.idx=this.groupIdx),n},e.prototype.positiveInteger=function(){var e=this.popChar();if(r.test(e)===!1)throw Error(`Expecting a positive integer`);for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.integerIncludingZero=function(){var e=this.popChar();if(n.test(e)===!1)throw Error(`Expecting an integer`);for(;n.test(this.peekChar(0));)e+=this.popChar();return parseInt(e,10)},e.prototype.patternCharacter=function(){var e=this.popChar();switch(e){case`
`:case`\r`:case`\u2028`:case`\u2029`:case`^`:case`$`:case`\\`:case`.`:case`*`:case`+`:case`?`:case`(`:case`)`:case`[`:case`|`:throw Error(`TBD`);default:return{type:`Character`,value:i(e)}}},e.prototype.isRegExpFlag=function(){switch(this.peekChar(0)){case`g`:case`i`:case`m`:case`u`:case`y`:return!0;default:return!1}},e.prototype.isRangeDash=function(){return this.peekChar()===`-`&&this.isClassAtom(1)},e.prototype.isDigit=function(){return n.test(this.peekChar(0))},e.prototype.isClassAtom=function(e){switch(e===void 0&&(e=0),this.peekChar(e)){case`]`:case`
`:case`\r`:case`\u2028`:case`\u2029`:return!1;default:return!0}},e.prototype.isTerm=function(){return this.isAtom()||this.isAssertion()},e.prototype.isAtom=function(){if(this.isPatternCharacter())return!0;switch(this.peekChar(0)){case`.`:case`\\`:case`[`:case`(`:return!0;default:return!1}},e.prototype.isAssertion=function(){switch(this.peekChar(0)){case`^`:case`$`:return!0;case`\\`:switch(this.peekChar(1)){case`b`:case`B`:return!0;default:return!1}case`(`:return this.peekChar(1)===`?`&&(this.peekChar(2)===`=`||this.peekChar(2)===`!`);default:return!1}},e.prototype.isQuantifier=function(){var e=this.saveState();try{return this.quantifier(!0)!==void 0}catch{return!1}finally{this.restoreState(e)}},e.prototype.isPatternCharacter=function(){switch(this.peekChar()){case`^`:case`$`:case`\\`:case`.`:case`*`:case`+`:case`?`:case`(`:case`)`:case`[`:case`|`:case`/`:case`
`:case`\r`:case`\u2028`:case`\u2029`:return!1;default:return!0}},e.prototype.parseHexDigits=function(e){for(var n=``,r=0;r<e;r++){var i=this.popChar();if(t.test(i)===!1)throw Error(`Expecting a HexDecimal digits`);n+=i}return{type:`Character`,value:parseInt(n,16)}},e.prototype.peekChar=function(e){return e===void 0&&(e=0),this.input[this.idx+e]},e.prototype.popChar=function(){var e=this.peekChar(0);return this.consumeChar(),e},e.prototype.consumeChar=function(e){if(e!==void 0&&this.input[this.idx]!==e)throw Error(`Expected: '`+e+`' but found: '`+this.input[this.idx]+`' at offset: `+this.idx);if(this.idx>=this.input.length)throw Error(`Unexpected end of input`);this.idx++};var t=/[0-9a-fA-F]/,n=/[0-9]/,r=/[1-9]/;function i(e){return e.charCodeAt(0)}function a(e,t){e.length===void 0?t.push(e):e.forEach(function(e){t.push(e)})}function o(e,t){if(e[t]===!0)throw`duplicate flag `+t;e[t]=!0}function s(e){if(e===void 0)throw Error(`Internal Error - Should never get here!`)}function c(){throw Error(`Internal Error - Should never get here!`)}var l,u=[];for(l=i(`0`);l<=i(`9`);l++)u.push(l);var d=[i(`_`)].concat(u);for(l=i(`a`);l<=i(`z`);l++)d.push(l);for(l=i(`A`);l<=i(`Z`);l++)d.push(l);var f=[i(` `),i(`\f`),i(`
`),i(`\r`),i(`	`),i(`\v`),i(`	`),i(`\xA0`),i(` `),i(` `),i(` `),i(` `),i(` `),i(` `),i(` `),i(` `),i(` `),i(` `),i(` `),i(` `),i(`\u2028`),i(`\u2029`),i(` `),i(` `),i(`　`),i(`﻿`)];function p(){}return p.prototype.visitChildren=function(e){for(var t in e){var n=e[t];e.hasOwnProperty(t)&&(n.type===void 0?Array.isArray(n)&&n.forEach(function(e){this.visit(e)},this):this.visit(n))}},p.prototype.visit=function(e){switch(e.type){case`Pattern`:this.visitPattern(e);break;case`Flags`:this.visitFlags(e);break;case`Disjunction`:this.visitDisjunction(e);break;case`Alternative`:this.visitAlternative(e);break;case`StartAnchor`:this.visitStartAnchor(e);break;case`EndAnchor`:this.visitEndAnchor(e);break;case`WordBoundary`:this.visitWordBoundary(e);break;case`NonWordBoundary`:this.visitNonWordBoundary(e);break;case`Lookahead`:this.visitLookahead(e);break;case`NegativeLookahead`:this.visitNegativeLookahead(e);break;case`Character`:this.visitCharacter(e);break;case`Set`:this.visitSet(e);break;case`Group`:this.visitGroup(e);break;case`GroupBackReference`:this.visitGroupBackReference(e);break;case`Quantifier`:this.visitQuantifier(e);break}this.visitChildren(e)},p.prototype.visitPattern=function(e){},p.prototype.visitFlags=function(e){},p.prototype.visitDisjunction=function(e){},p.prototype.visitAlternative=function(e){},p.prototype.visitStartAnchor=function(e){},p.prototype.visitEndAnchor=function(e){},p.prototype.visitWordBoundary=function(e){},p.prototype.visitNonWordBoundary=function(e){},p.prototype.visitLookahead=function(e){},p.prototype.visitNegativeLookahead=function(e){},p.prototype.visitCharacter=function(e){},p.prototype.visitSet=function(e){},p.prototype.visitGroup=function(e){},p.prototype.visitGroupBackReference=function(e){},p.prototype.visitQuantifier=function(e){},{RegExpParser:e,BaseRegExpVisitor:p,VERSION:`0.4.0`}})})),l=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=c(),r=o(),i=new n.RegExpParser,a=`Complement Sets are not supported for first char optimization`;exports.failedOptimizationPrefixMsg=`Unable to use "first char" lexer optimizations:
`;function s(t,a){a===void 0&&(a=!1);try{var o=i.pattern(t.toString()),s=l(o.value);return o.flags.ignoreCase&&(s=u(s)),s}catch(i){if(i.message===`Complement Sets are not supported for first char optimization`)a&&r.PRINT_WARNING(``+exports.failedOptimizationPrefixMsg+(`	Unable to optimize: < `+t.toString()+` >
`)+`	Complement Sets cannot be automatically optimized.
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#COMPLEMENT for details.`);else{var c=``;a&&(c=`
	This will disable the lexer's first char optimizations.
	See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#REGEXP_PARSING for details.`),r.PRINT_ERROR(exports.failedOptimizationPrefixMsg+`
`+(`	Failed parsing: < `+t.toString()+` >
`)+(`	Using the regexp-to-ast library version: `+n.VERSION+`
`)+`	Please open an issue at: https://github.com/bd82/regexp-to-ast/issues`+c)}}return[]}exports.getStartCodes=s;function l(e){switch(e.type){case`Disjunction`:return r.flatten(r.map(e.value,l));case`Alternative`:for(var t=[],n=e.value,i=0;i<n.length;i++){var o=n[i];if(!r.contains([`GroupBackReference`,`Lookahead`,`NegativeLookahead`,`StartAnchor`,`EndAnchor`,`WordBoundary`,`NonWordBoundary`],o.type)){var s=o;switch(s.type){case`Character`:t.push(s.value);break;case`Set`:if(s.complement===!0)throw Error(a);r.forEach(s.value,function(e){if(typeof e==`number`)t.push(e);else for(var n=e,r=n.from;r<=n.to;r++)t.push(r)});break;case`Group`:var c=l(s.value);r.forEach(c,function(e){return t.push(e)});break;default:throw Error(`Non Exhaustive Match`)}var u=s.quantifier!==void 0&&s.quantifier.atLeast===0;if(s.type===`Group`&&f(s)===!1||s.type!==`Group`&&u===!1)break}}return t;default:throw Error(`non exhaustive match!`)}}exports.firstChar=l;function u(e){var t=[];return r.forEach(e,function(e){t.push(e);var n=String.fromCharCode(e);n.toUpperCase()===n?n.toLowerCase()!==n&&t.push(n.toLowerCase().charCodeAt(0)):t.push(n.toUpperCase().charCodeAt(0))}),t}exports.applyIgnoreCase=u;function d(e,t){return r.find(e.value,function(e){if(typeof e==`number`)return r.contains(t,e);var n=e;return r.find(t,function(e){return n.from<=e&&e<=n.to})!==void 0})}function f(e){return e.quantifier&&e.quantifier.atLeast===0?!0:e.value?r.isArray(e.value)?r.every(e.value,f):f(e.value):!1}var p=function(e){t(n,e);function n(t){var n=e.call(this)||this;return n.targetCharCodes=t,n.found=!1,n}return n.prototype.visitChildren=function(t){switch(t.type){case`Lookahead`:this.visitLookahead(t);return;case`NegativeLookahead`:this.visitNegativeLookahead(t);return}e.prototype.visitChildren.call(this,t)},n.prototype.visitCharacter=function(e){r.contains(this.targetCharCodes,e.value)&&(this.found=!0)},n.prototype.visitSet=function(e){e.complement?d(e,this.targetCharCodes)===void 0&&(this.found=!0):d(e,this.targetCharCodes)!==void 0&&(this.found=!0)},n}(n.BaseRegExpVisitor);function m(e,t){if(t instanceof RegExp){var n=i.pattern(t.toString()),a=new p(e);return a.visit(n),a.found}else return r.find(t,function(t){return r.contains(e,t.charCodeAt(0))})!==void 0}exports.canMatchCharCode=m})),u=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=c(),r=m(),i=p(),a=o(),s=l(),u=new n.RegExpParser,d=`PATTERN`;exports.DEFAULT_MODE=`defaultMode`,exports.MODES=`modes`,exports.SUPPORT_STICKY=typeof RegExp(`(?:)`).sticky==`boolean`;function f(){exports.SUPPORT_STICKY=!1}exports.disableSticky=f;function h(){exports.SUPPORT_STICKY=!0}exports.enableSticky=h;function g(t,n){n=a.defaults(n,{useSticky:exports.SUPPORT_STICKY,debug:!1,safeMode:!1,positionTracking:`full`,lineTerminatorCharacters:[`\r`,`
`]});var o=a.reject(t,function(e){return e[d]===i.Lexer.NA}),c=!1,l=a.map(o,function(e){var t=e[d];if(a.isRegExp(t)){var r=t.source;return r.length===1&&r!==`^`&&r!==`$`&&r!==`.`?r:r.length===2&&r[0]===`\\`&&!a.contains([`d`,`D`,`s`,`S`,`t`,`r`,`n`,`t`,`0`,`c`,`b`,`B`,`f`,`v`,`w`,`W`],r[1])?r[1]:n.useSticky?P(t):N(t)}else if(a.isFunction(t))return c=!0,{exec:t};else if(a.has(t,`exec`))return c=!0,t;else if(typeof t==`string`){if(t.length===1)return t;var i=t.replace(/[\\^$.*+?()[\]{}|]/g,`\\$&`),o=new RegExp(i);return n.useSticky?P(o):N(o)}else throw Error(`non exhaustive match`)}),u=a.map(o,function(e){return e.tokenTypeIdx}),f=a.map(o,function(e){var t=e.GROUP;if(t!==i.Lexer.SKIPPED){if(a.isString(t))return t;if(a.isUndefined(t))return!1;throw Error(`non exhaustive match`)}}),p=a.map(o,function(e){var t=e.LONGER_ALT;if(t)return a.indexOf(o,t)}),m=a.map(o,function(e){return e.PUSH_MODE}),h=a.map(o,function(e){return a.has(e,`POP_MODE`)}),g=ie(n.lineTerminatorCharacters),_=a.map(o,function(e){return!1});n.positionTracking!==`onlyOffset`&&(_=a.map(o,function(e){if(a.has(e,`LINE_BREAKS`))return e.LINE_BREAKS;if(ne(e,g)===!1)return s.canMatchCharCode(g,e.PATTERN)}));var v=a.map(o,I),y=a.map(l,L),b=a.reduce(o,function(e,t){var n=t.GROUP;return a.isString(n)&&n!==i.Lexer.SKIPPED&&(e[n]=[]),e},{}),x=a.map(l,function(e,t){return{pattern:l[t],longerAlt:p[t],canLineTerminator:_[t],isCustom:v[t],short:y[t],group:f[t],push:m[t],pop:h[t],tokenTypeIdx:u[t],tokenType:o[t]}});function S(e,t,n){e[t]===void 0&&(e[t]=[]),e[t].push(n)}var C=!0,w=[];return n.safeMode||(w=a.reduce(o,function(e,t,i){if(typeof t.PATTERN==`string`){var o=t.PATTERN.charCodeAt(0);S(e,o,x[i])}else if(a.isArray(t.START_CHARS_HINT))a.forEach(t.START_CHARS_HINT,function(t){var n=typeof t==`string`?t.charCodeAt(0):t;S(e,n,x[i])});else if(a.isRegExp(t.PATTERN))if(t.PATTERN.unicode)C=!1,n.ensureOptimizations&&a.PRINT_ERROR(``+s.failedOptimizationPrefixMsg+(`	Unable to analyze < `+t.PATTERN.toString()+` > pattern.
`)+`	The regexp unicode flag is not currently supported by the regexp-to-ast library.
	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNICODE_OPTIMIZE`);else{var c=s.getStartCodes(t.PATTERN,n.ensureOptimizations);a.isEmpty(c)&&(C=!1),a.forEach(c,function(t){S(e,t,x[i])})}else n.ensureOptimizations&&a.PRINT_ERROR(``+s.failedOptimizationPrefixMsg+(`	TokenType: <`+r.tokenName(t)+`> is using a custom token pattern without providing <start_chars_hint> parameter.
`)+`	This will disable the lexer's first char optimizations.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_OPTIMIZE`),C=!1;return e},[])),C&&w.length<65536&&(w=a.packArray(w)),{emptyGroups:b,patternIdxToConfig:x,charCodeToPatternIdxToConfig:w,hasCustom:c,canBeOptimized:C}}exports.analyzeTokenTypes=g;function _(e,t){var n=[],r=y(e);n=n.concat(r.errors);var i=b(r.valid),a=i.valid;return n=n.concat(i.errors),n=n.concat(v(a)),n=n.concat(O(a)),n=n.concat(k(a,t)),n=n.concat(A(a)),n}exports.validatePatterns=_;function v(e){var t=[],n=a.filter(e,function(e){return a.isRegExp(e[d])});return t=t.concat(S(n)),t=t.concat(T(n)),t=t.concat(E(n)),t=t.concat(D(n)),t=t.concat(C(n)),t}function y(e){var t=a.filter(e,function(e){return!a.has(e,d)}),n=a.map(t,function(e){return{message:`Token Type: ->`+r.tokenName(e)+`<- missing static 'PATTERN' property`,type:i.LexerDefinitionErrorType.MISSING_PATTERN,tokenTypes:[e]}}),o=a.difference(e,t);return{errors:n,valid:o}}exports.findMissingPatterns=y;function b(e){var t=a.filter(e,function(e){var t=e[d];return!a.isRegExp(t)&&!a.isFunction(t)&&!a.has(t,`exec`)&&!a.isString(t)}),n=a.map(t,function(e){return{message:`Token Type: ->`+r.tokenName(e)+`<- static 'PATTERN' can only be a RegExp, a Function matching the {CustomPatternMatcherFunc} type or an Object matching the {ICustomPattern} interface.`,type:i.LexerDefinitionErrorType.INVALID_PATTERN,tokenTypes:[e]}}),o=a.difference(e,t);return{errors:n,valid:o}}exports.findInvalidPatterns=b;var x=/[^\\][\$]/;function S(e){var o=function(e){t(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.found=!1,t}return n.prototype.visitEndAnchor=function(e){this.found=!0},n}(n.BaseRegExpVisitor),s=a.filter(e,function(e){var t=e[d];try{var n=u.pattern(t.toString()),r=new o;return r.visit(n),r.found}catch{return x.test(t.source)}});return a.map(s,function(e){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+r.tokenName(e)+`<- static 'PATTERN' cannot contain end of input anchor '$'
	See sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:i.LexerDefinitionErrorType.EOI_ANCHOR_FOUND,tokenTypes:[e]}})}exports.findEndOfInputAnchor=S;function C(e){var t=a.filter(e,function(e){return e[d].test(``)});return a.map(t,function(e){return{message:`Token Type: ->`+r.tokenName(e)+`<- static 'PATTERN' must not match an empty string`,type:i.LexerDefinitionErrorType.EMPTY_MATCH_PATTERN,tokenTypes:[e]}})}exports.findEmptyMatchRegExps=C;var w=/[^\\[][\^]|^\^/;function T(e){var o=function(e){t(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.found=!1,t}return n.prototype.visitStartAnchor=function(e){this.found=!0},n}(n.BaseRegExpVisitor),s=a.filter(e,function(e){var t=e[d];try{var n=u.pattern(t.toString()),r=new o;return r.visit(n),r.found}catch{return w.test(t.source)}});return a.map(s,function(e){return{message:`Unexpected RegExp Anchor Error:
	Token Type: ->`+r.tokenName(e)+`<- static 'PATTERN' cannot contain start of input anchor '^'
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#ANCHORS	for details.`,type:i.LexerDefinitionErrorType.SOI_ANCHOR_FOUND,tokenTypes:[e]}})}exports.findStartOfInputAnchor=T;function E(e){var t=a.filter(e,function(e){var t=e[d];return t instanceof RegExp&&(t.multiline||t.global)});return a.map(t,function(e){return{message:`Token Type: ->`+r.tokenName(e)+`<- static 'PATTERN' may NOT contain global('g') or multiline('m')`,type:i.LexerDefinitionErrorType.UNSUPPORTED_FLAGS_FOUND,tokenTypes:[e]}})}exports.findUnsupportedFlags=E;function D(e){var t=[],n=a.map(e,function(n){return a.reduce(e,function(e,r){return n.PATTERN.source===r.PATTERN.source&&!a.contains(t,r)&&r.PATTERN!==i.Lexer.NA?(t.push(r),e.push(r),e):e},[])});n=a.compact(n);var o=a.filter(n,function(e){return e.length>1});return a.map(o,function(e){var t=a.map(e,function(e){return r.tokenName(e)});return{message:`The same RegExp pattern ->`+a.first(e).PATTERN+`<-`+(`has been used in all of the following Token Types: `+t.join(`, `)+` <-`),type:i.LexerDefinitionErrorType.DUPLICATE_PATTERNS_FOUND,tokenTypes:e}})}exports.findDuplicatePatterns=D;function O(e){var t=a.filter(e,function(e){if(!a.has(e,`GROUP`))return!1;var t=e.GROUP;return t!==i.Lexer.SKIPPED&&t!==i.Lexer.NA&&!a.isString(t)});return a.map(t,function(e){return{message:`Token Type: ->`+r.tokenName(e)+`<- static 'GROUP' can only be Lexer.SKIPPED/Lexer.NA/A String`,type:i.LexerDefinitionErrorType.INVALID_GROUP_TYPE_FOUND,tokenTypes:[e]}})}exports.findInvalidGroupType=O;function k(e,t){var n=a.filter(e,function(e){return e.PUSH_MODE!==void 0&&!a.contains(t,e.PUSH_MODE)});return a.map(n,function(e){return{message:`Token Type: ->`+r.tokenName(e)+`<- static 'PUSH_MODE' value cannot refer to a Lexer Mode ->`+e.PUSH_MODE+`<-which does not exist`,type:i.LexerDefinitionErrorType.PUSH_MODE_DOES_NOT_EXIST,tokenTypes:[e]}})}exports.findModesThatDoNotExist=k;function A(e){var t=[],n=a.reduce(e,function(e,t,n){var r=t.PATTERN;return r===i.Lexer.NA||(a.isString(r)?e.push({str:r,idx:n,tokenType:t}):a.isRegExp(r)&&M(r)&&e.push({str:r.source,idx:n,tokenType:t})),e},[]);return a.forEach(e,function(e,o){a.forEach(n,function(n){var a=n.str,s=n.idx,c=n.tokenType;if(o<s&&j(a,e.PATTERN)){var l=`Token: ->`+r.tokenName(c)+`<- can never be matched.
`+(`Because it appears AFTER the Token Type ->`+r.tokenName(e)+`<-`)+`in the lexer's definition.
See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#UNREACHABLE`;t.push({message:l,type:i.LexerDefinitionErrorType.UNREACHABLE_PATTERN,tokenTypes:[e,c]})}})}),t}exports.findUnreachablePatterns=A;function j(e,t){if(a.isRegExp(t)){var n=t.exec(e);return n!==null&&n.index===0}else if(a.isFunction(t))return t(e,0,[],{});else if(a.has(t,`exec`))return t.exec(e,0,[],{});else if(typeof t==`string`)return t===e;else throw Error(`non exhaustive match`)}function M(e){return a.find([`.`,`\\`,`[`,`]`,`|`,`^`,`$`,`(`,`)`,`?`,`*`,`+`,`{`],function(t){return e.source.indexOf(t)!==-1})===void 0}function N(e){var t=e.ignoreCase?`i`:``;return RegExp(`^(?:`+e.source+`)`,t)}exports.addStartOfInput=N;function P(e){var t=e.ignoreCase?`iy`:`y`;return RegExp(``+e.source,t)}exports.addStickyFlag=P;function F(t,n,r){var o=[];return a.has(t,exports.DEFAULT_MODE)||o.push({message:`A MultiMode Lexer cannot be initialized without a <`+exports.DEFAULT_MODE+`> property in its definition
`,type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE}),a.has(t,exports.MODES)||o.push({message:`A MultiMode Lexer cannot be initialized without a <`+exports.MODES+`> property in its definition
`,type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY}),a.has(t,exports.MODES)&&a.has(t,exports.DEFAULT_MODE)&&!a.has(t.modes,t.defaultMode)&&o.push({message:`A MultiMode Lexer cannot be initialized with a `+exports.DEFAULT_MODE+`: <`+t.defaultMode+`>which does not exist
`,type:i.LexerDefinitionErrorType.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST}),a.has(t,exports.MODES)&&a.forEach(t.modes,function(e,t){a.forEach(e,function(e,n){a.isUndefined(e)&&o.push({message:`A Lexer cannot be initialized using an undefined Token Type. Mode:`+(`<`+t+`> at index: <`+n+`>
`),type:i.LexerDefinitionErrorType.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED})})}),o}exports.performRuntimeChecks=F;function ee(e,t,n){var r=[],o=!1,c=a.compact(a.flatten(a.mapValues(e.modes,function(e){return e}))),l=a.reject(c,function(e){return e[d]===i.Lexer.NA}),u=ie(n);return t&&a.forEach(l,function(e){var t=ne(e,u);if(t!==!1){var n={message:re(e,t),type:t.issue,tokenType:e};r.push(n)}else a.has(e,`LINE_BREAKS`)?e.LINE_BREAKS===!0&&(o=!0):s.canMatchCharCode(u,e.PATTERN)&&(o=!0)}),t&&!o&&r.push({message:`Warning: No LINE_BREAKS Found.
	This Lexer has been defined to track line and column information,
	But none of the Token Types can be identified as matching a line terminator.
	See https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#LINE_BREAKS 
	for details.`,type:i.LexerDefinitionErrorType.NO_LINE_BREAKS_FLAGS}),r}exports.performWarningRuntimeChecks=ee;function te(e){var t={},n=a.keys(e);return a.forEach(n,function(n){var r=e[n];if(a.isArray(r))t[n]=[];else throw Error(`non exhaustive match`)}),t}exports.cloneEmptyGroups=te;function I(e){var t=e.PATTERN;if(a.isRegExp(t))return!1;if(a.isFunction(t)||a.has(t,`exec`))return!0;if(a.isString(t))return!1;throw Error(`non exhaustive match`)}exports.isCustomPattern=I;function L(e){return a.isString(e)&&e.length===1?e.charCodeAt(0):!1}exports.isShortPattern=L,exports.LineTerminatorOptimizedTester={test:function(e){for(var t=e.length,n=this.lastIndex;n<t;n++){var r=e.charCodeAt(n);if(r===10)return this.lastIndex=n+1,!0;if(r===13)return e.charCodeAt(n+1)===10?this.lastIndex=n+2:this.lastIndex=n+1,!0}return!1},lastIndex:0};function ne(e,t){if(a.has(e,`LINE_BREAKS`))return!1;if(a.isRegExp(e.PATTERN)){try{s.canMatchCharCode(t,e.PATTERN)}catch(e){return{issue:i.LexerDefinitionErrorType.IDENTIFY_TERMINATOR,errMsg:e.message}}return!1}else if(a.isString(e.PATTERN))return!1;else if(I(e))return{issue:i.LexerDefinitionErrorType.CUSTOM_LINE_BREAK};else throw Error(`non exhaustive match`)}function re(e,t){if(t.issue===i.LexerDefinitionErrorType.IDENTIFY_TERMINATOR)return`Warning: unable to identify line terminator usage in pattern.
`+(`	The problem is in the <`+e.name+`> Token Type
`)+(`	 Root cause: `+t.errMsg+`.
`)+`	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#IDENTIFY_TERMINATOR`;if(t.issue===i.LexerDefinitionErrorType.CUSTOM_LINE_BREAK)return`Warning: A Custom Token Pattern should specify the <line_breaks> option.
`+(`	The problem is in the <`+e.name+`> Token Type
`)+`	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#CUSTOM_LINE_BREAK`;throw Error(`non exhaustive match`)}exports.buildLineBreakIssueMessage=re;function ie(e){return a.map(e,function(e){return a.isString(e)&&e.length>0?e.charCodeAt(0):e})}})),d=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=s(),r=m();function i(e,t){var n=e.tokenTypeIdx;return n===t.tokenTypeIdx?!0:t.isParent===!0&&t.categoryMatchesMap[n]===!0}exports.tokenStructuredMatcher=i;function a(e,t){return e.tokenTypeIdx===t.tokenTypeIdx}exports.tokenStructuredMatcherNoCategories=a,exports.tokenShortNameIdx=1,exports.tokenIdxToClass=new n.HashTable;function c(e){var n=l(e);u(n),f(n),d(n),t.forEach(n,function(e){e.isParent=e.categoryMatches.length>0})}exports.augmentTokenTypes=c;function l(e){for(var n=t.cloneArr(e),r=e,i=!0;i;){r=t.compact(t.flatten(t.map(r,function(e){return e.CATEGORIES})));var a=t.difference(r,n);n=n.concat(a),t.isEmpty(a)?i=!1:r=a}return n}exports.expandCategories=l;function u(n){t.forEach(n,function(n){h(n)||(exports.tokenIdxToClass.put(exports.tokenShortNameIdx,n),n.tokenTypeIdx=exports.tokenShortNameIdx++),g(n)&&!t.isArray(n.CATEGORIES)&&(n.CATEGORIES=[n.CATEGORIES]),g(n)||(n.CATEGORIES=[]),_(n)||(n.categoryMatches=[]),v(n)||(n.categoryMatchesMap={}),y(n)||(n.tokenName=r.tokenName(n))})}exports.assignTokenDefaultProps=u;function d(n){t.forEach(n,function(n){n.categoryMatches=[],t.forEach(n.categoryMatchesMap,function(t,r){n.categoryMatches.push(exports.tokenIdxToClass.get(r).tokenTypeIdx)})})}exports.assignCategoriesTokensProp=d;function f(e){t.forEach(e,function(e){p([],e)})}exports.assignCategoriesMapProp=f;function p(e,n){t.forEach(e,function(e){n.categoryMatchesMap[e.tokenTypeIdx]=!0}),t.forEach(n.CATEGORIES,function(r){var i=e.concat(n);t.contains(i,r)||p(i,r)})}exports.singleAssignCategoriesToksMap=p;function h(e){return t.has(e,`tokenTypeIdx`)}exports.hasShortKeyProperty=h;function g(e){return t.has(e,`CATEGORIES`)}exports.hasCategoriesProperty=g;function _(e){return t.has(e,`categoryMatches`)}exports.hasExtendingTokensTypesProperty=_;function v(e){return t.has(e,`categoryMatchesMap`)}exports.hasExtendingTokensTypesMapProperty=v;function y(e){return t.has(e,`tokenName`)}exports.hasTokenNameProperty=y;function b(e){return t.has(e,`tokenTypeIdx`)}exports.isTokenType=b})),f=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.defaultLexerErrorProvider={buildUnableToPopLexerModeMessage:function(e){return`Unable to pop Lexer Mode after encountering Token ->`+e.image+`<- The Mode Stack is empty`},buildUnexpectedCharactersMessage:function(e,t,n,r,i){return`unexpected character: ->`+e.charAt(t)+`<- at offset: `+t+`,`+(` skipped `+n+` characters.`)}}})),p=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=u(),n=o(),r=d(),i=f();(function(e){e[e.MISSING_PATTERN=0]=`MISSING_PATTERN`,e[e.INVALID_PATTERN=1]=`INVALID_PATTERN`,e[e.EOI_ANCHOR_FOUND=2]=`EOI_ANCHOR_FOUND`,e[e.UNSUPPORTED_FLAGS_FOUND=3]=`UNSUPPORTED_FLAGS_FOUND`,e[e.DUPLICATE_PATTERNS_FOUND=4]=`DUPLICATE_PATTERNS_FOUND`,e[e.INVALID_GROUP_TYPE_FOUND=5]=`INVALID_GROUP_TYPE_FOUND`,e[e.PUSH_MODE_DOES_NOT_EXIST=6]=`PUSH_MODE_DOES_NOT_EXIST`,e[e.MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE=7]=`MULTI_MODE_LEXER_WITHOUT_DEFAULT_MODE`,e[e.MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY=8]=`MULTI_MODE_LEXER_WITHOUT_MODES_PROPERTY`,e[e.MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST=9]=`MULTI_MODE_LEXER_DEFAULT_MODE_VALUE_DOES_NOT_EXIST`,e[e.LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED=10]=`LEXER_DEFINITION_CANNOT_CONTAIN_UNDEFINED`,e[e.SOI_ANCHOR_FOUND=11]=`SOI_ANCHOR_FOUND`,e[e.EMPTY_MATCH_PATTERN=12]=`EMPTY_MATCH_PATTERN`,e[e.NO_LINE_BREAKS_FLAGS=13]=`NO_LINE_BREAKS_FLAGS`,e[e.UNREACHABLE_PATTERN=14]=`UNREACHABLE_PATTERN`,e[e.IDENTIFY_TERMINATOR=15]=`IDENTIFY_TERMINATOR`,e[e.CUSTOM_LINE_BREAK=16]=`CUSTOM_LINE_BREAK`})(exports.LexerDefinitionErrorType||={});var a={deferDefinitionErrorsHandling:!1,positionTracking:`full`,lineTerminatorsPattern:/\n|\r\n?/g,lineTerminatorCharacters:[`
`,`\r`],ensureOptimizations:!1,safeMode:!1,errorMessageProvider:i.defaultLexerErrorProvider};Object.freeze(a),exports.Lexer=function(){function e(e,i){var o=this;if(i===void 0&&(i=a),this.lexerDefinition=e,this.lexerDefinitionErrors=[],this.lexerDefinitionWarning=[],this.patternIdxToConfig={},this.charCodeToPatternIdxToConfig={},this.modes=[],this.emptyGroups={},this.config=void 0,this.trackStartLines=!0,this.trackEndLines=!0,this.hasCustom=!1,this.canModeBeOptimized={},typeof i==`boolean`)throw Error(`The second argument to the Lexer constructor is now an ILexerConfig Object.
a boolean 2nd argument is no longer supported`);if(this.config=n.merge(a,i),this.config.lineTerminatorsPattern===a.lineTerminatorsPattern)this.config.lineTerminatorsPattern=t.LineTerminatorOptimizedTester;else if(this.config.lineTerminatorCharacters===a.lineTerminatorCharacters)throw Error(`Error: Missing <lineTerminatorCharacters> property on the Lexer config.
	For details See: https://sap.github.io/chevrotain/docs/guide/resolving_lexer_errors.html#MISSING_LINE_TERM_CHARS`);if(i.safeMode&&i.ensureOptimizations)throw Error(`"safeMode" and "ensureOptimizations" flags are mutually exclusive.`);this.trackStartLines=/full|onlyStart/i.test(this.config.positionTracking),this.trackEndLines=/full/i.test(this.config.positionTracking);var s=!0,c;n.isArray(e)?(c={modes:{}},c.modes[t.DEFAULT_MODE]=n.cloneArr(e),c[t.DEFAULT_MODE]=t.DEFAULT_MODE):(s=!1,c=n.cloneObj(e)),this.lexerDefinitionErrors=this.lexerDefinitionErrors.concat(t.performRuntimeChecks(c,this.trackStartLines,this.config.lineTerminatorCharacters)),this.lexerDefinitionWarning=this.lexerDefinitionWarning.concat(t.performWarningRuntimeChecks(c,this.trackStartLines,this.config.lineTerminatorCharacters)),c.modes=c.modes?c.modes:{},n.forEach(c.modes,function(e,t){c.modes[t]=n.reject(e,function(e){return n.isUndefined(e)})});var l=n.keys(c.modes);if(n.forEach(c.modes,function(e,a){if(o.modes.push(a),o.lexerDefinitionErrors=o.lexerDefinitionErrors.concat(t.validatePatterns(e,l)),n.isEmpty(o.lexerDefinitionErrors)){r.augmentTokenTypes(e);var s=t.analyzeTokenTypes(e,{lineTerminatorCharacters:o.config.lineTerminatorCharacters,positionTracking:i.positionTracking,ensureOptimizations:i.ensureOptimizations,safeMode:i.safeMode});o.patternIdxToConfig[a]=s.patternIdxToConfig,o.charCodeToPatternIdxToConfig[a]=s.charCodeToPatternIdxToConfig,o.emptyGroups=n.merge(o.emptyGroups,s.emptyGroups),o.hasCustom=s.hasCustom||o.hasCustom,o.canModeBeOptimized[a]=s.canBeOptimized}}),this.defaultMode=c.defaultMode,!n.isEmpty(this.lexerDefinitionErrors)&&!this.config.deferDefinitionErrorsHandling){var u=n.map(this.lexerDefinitionErrors,function(e){return e.message}).join(`-----------------------
`);throw Error(`Errors detected in definition of Lexer:
`+u)}if(n.forEach(this.lexerDefinitionWarning,function(e){n.PRINT_WARNING(e.message)}),t.SUPPORT_STICKY?(this.chopInput=n.IDENTITY,this.match=this.matchWithTest):(this.updateLastIndex=n.NOOP,this.match=this.matchWithExec),s&&(this.handleModes=n.NOOP),this.trackStartLines===!1&&(this.computeNewColumn=n.IDENTITY),this.trackEndLines===!1&&(this.updateTokenEndLineColumnLocation=n.NOOP),/full/i.test(this.config.positionTracking))this.createTokenInstance=this.createFullToken;else if(/onlyStart/i.test(this.config.positionTracking))this.createTokenInstance=this.createStartOnlyToken;else if(/onlyOffset/i.test(this.config.positionTracking))this.createTokenInstance=this.createOffsetOnlyToken;else throw Error(`Invalid <positionTracking> config option: "`+this.config.positionTracking+`"`);this.hasCustom?(this.addToken=this.addTokenUsingPush,this.handlePayload=this.handlePayloadWithCustom):(this.addToken=this.addTokenUsingMemberAccess,this.handlePayload=this.handlePayloadNoCustom);var d=n.reduce(this.canModeBeOptimized,function(e,t,n){return t===!1&&e.push(n),e},[]);if(i.ensureOptimizations&&!n.isEmpty(d))throw Error(`Lexer Modes: < `+d.join(`, `)+` > cannot be optimized.
	 Disable the "ensureOptimizations" lexer config flag to silently ignore this and run the lexer in an un-optimized mode.
	 Or inspect the console log for details on how to resolve these issues.`);n.toFastProperties(this)}return e.prototype.tokenize=function(e,t){if(t===void 0&&(t=this.defaultMode),!n.isEmpty(this.lexerDefinitionErrors)){var r=n.map(this.lexerDefinitionErrors,function(e){return e.message}).join(`-----------------------
`);throw Error(`Unable to Tokenize because Errors detected in definition of Lexer:
`+r)}return this.tokenizeInternal(e,t)},e.prototype.tokenizeInternal=function(e,r){var i=this,a,o,s,c,l,u,d,f,p,m,h,g,_,v,y=e,b=y.length,x=0,S=0,C=this.hasCustom?0:Math.floor(e.length/10),w=Array(C),T=[],E=this.trackStartLines?1:void 0,D=this.trackStartLines?1:void 0,O=t.cloneEmptyGroups(this.emptyGroups),k=this.trackStartLines,A=this.config.lineTerminatorsPattern,j=0,M=[],N=[],P=[],F=[];Object.freeze(F);var ee=void 0,te=function(e){if(P.length===1&&e.tokenType.PUSH_MODE===void 0){var t=i.config.errorMessageProvider.buildUnableToPopLexerModeMessage(e);T.push({offset:e.startOffset,line:e.startLine===void 0?void 0:e.startLine,column:e.startColumn===void 0?void 0:e.startColumn,length:e.image.length,message:t})}else{P.pop();var r=n.last(P);M=i.patternIdxToConfig[r],N=i.charCodeToPatternIdxToConfig[r],j=M.length;var a=i.canModeBeOptimized[r]&&i.config.safeMode===!1;ee=N&&a?function(e){var t=N[e];return t===void 0?F:t}:function(){return M}}};function I(e){P.push(e),N=this.charCodeToPatternIdxToConfig[e],M=this.patternIdxToConfig[e],j=M.length,j=M.length;var t=this.canModeBeOptimized[e]&&this.config.safeMode===!1;ee=N&&t?function(e){var t=N[e];return t===void 0?F:t}:function(){return M}}I.call(this,r);for(var L;x<b;){l=null;var ne=y.charCodeAt(x),re=ee(ne),ie=re.length;for(a=0;a<ie;a++){L=re[a];var R=L.pattern;u=null;var ae=L.short;if(ae===!1?L.isCustom===!0?(v=R.exec(y,x,w,O),v===null?l=null:(l=v[0],v.payload!==void 0&&(u=v.payload))):(this.updateLastIndex(R,x),l=this.match(R,e,x)):ne===ae&&(l=R),l!==null){if(c=L.longerAlt,c!==void 0){var oe=M[c],se=oe.pattern;d=null,oe.isCustom===!0?(v=se.exec(y,x,w,O),v===null?s=null:(s=v[0],v.payload!==void 0&&(d=v.payload))):(this.updateLastIndex(se,x),s=this.match(se,e,x)),s&&s.length>l.length&&(l=s,u=d,L=oe)}break}}if(l!==null){if(f=l.length,p=L.group,p!==void 0&&(m=L.tokenTypeIdx,h=this.createTokenInstance(l,x,m,L.tokenType,E,D,f),this.handlePayload(h,u),p===!1?S=this.addToken(w,S,h):O[p].push(h)),e=this.chopInput(e,f),x+=f,D=this.computeNewColumn(D,f),k===!0&&L.canLineTerminator===!0){var z=0,B=void 0,ce=void 0;A.lastIndex=0;do B=A.test(l),B===!0&&(ce=A.lastIndex-1,z++);while(B===!0);z!==0&&(E+=z,D=f-ce,this.updateTokenEndLineColumnLocation(h,p,ce,z,E,D,f))}this.handleModes(L,te,I,h)}else{for(var H=x,U=E,le=D,ue=!1;!ue&&x<b;)for(y.charCodeAt(x),e=this.chopInput(e,1),x++,o=0;o<j;o++){var de=M[o],R=de.pattern,ae=de.short;if(ae===!1?de.isCustom===!0?ue=R.exec(y,x,w,O)!==null:(this.updateLastIndex(R,x),ue=R.exec(e)!==null):y.charCodeAt(x)===ae&&(ue=!0),ue===!0)break}g=x-H,_=this.config.errorMessageProvider.buildUnexpectedCharactersMessage(y,H,g,U,le),T.push({offset:H,line:U,column:le,length:g,message:_})}}return this.hasCustom||(w.length=S),{tokens:w,groups:O,errors:T}},e.prototype.handleModes=function(e,t,n,r){if(e.pop===!0){var i=e.push;t(r),i!==void 0&&n.call(this,i)}else e.push!==void 0&&n.call(this,e.push)},e.prototype.chopInput=function(e,t){return e.substring(t)},e.prototype.updateLastIndex=function(e,t){e.lastIndex=t},e.prototype.updateTokenEndLineColumnLocation=function(e,t,n,r,i,a,o){var s,c;t!==void 0&&(s=n===o-1,c=s?-1:0,r===1&&s===!0||(e.endLine=i+c,e.endColumn=a-1+-c))},e.prototype.computeNewColumn=function(e,t){return e+t},e.prototype.createTokenInstance=function(){return null},e.prototype.createOffsetOnlyToken=function(e,t,n,r){return{image:e,startOffset:t,tokenTypeIdx:n,tokenType:r}},e.prototype.createStartOnlyToken=function(e,t,n,r,i,a){return{image:e,startOffset:t,startLine:i,startColumn:a,tokenTypeIdx:n,tokenType:r}},e.prototype.createFullToken=function(e,t,n,r,i,a,o){return{image:e,startOffset:t,endOffset:t+o-1,startLine:i,endLine:i,startColumn:a,endColumn:a+o-1,tokenTypeIdx:n,tokenType:r}},e.prototype.addToken=function(e,t,n){return 666},e.prototype.addTokenUsingPush=function(e,t,n){return e.push(n),t},e.prototype.addTokenUsingMemberAccess=function(e,t,n){return e[t]=n,t++,t},e.prototype.handlePayload=function(e,t){},e.prototype.handlePayloadNoCustom=function(e,t){},e.prototype.handlePayloadWithCustom=function(e,t){t!==null&&(e.payload=t)},e.prototype.match=function(e,t,n){return null},e.prototype.matchWithTest=function(e,t,n){return e.test(t)===!0?t.substring(n,e.lastIndex):null},e.prototype.matchWithExec=function(e,t){var n=e.exec(t);return n===null?n:n[0]},e.SKIPPED=`This marks a skipped Token pattern, this means each token identified by it willbe consumed and then thrown into oblivion, this can be used to for example to completely ignore whitespace.`,e.NA=/NOT_APPLICABLE/,e}()})),m=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=s(),r=p(),i=d();function a(e){return c(e)?e.LABEL:l(e)}exports.tokenLabel=a;function c(e){return t.isString(e.LABEL)&&e.LABEL!==``}exports.hasTokenLabel=c;function l(e){return t.isObject(e)&&e.hasOwnProperty(`tokenName`)&&t.isString(e.tokenName)?e.tokenName:n.functionName(e)}exports.tokenName=l;var u=`categories`,f=`label`,m=`group`,h=`push_mode`,g=`pop_mode`,_=`longer_alt`,v=`line_breaks`,y=`start_chars_hint`;function b(e){return x(e)}exports.createToken=b;function x(e){var r=e.name,a=e.pattern,o={};if(n.defineNameProp(o,r)||(o.tokenName=r),t.isUndefined(a)||(o.PATTERN=a),t.has(e,`parent`))throw`The parent property is no longer supported.
See: https://github.com/SAP/chevrotain/issues/564#issuecomment-349062346 for details.`;return t.has(e,`categories`)&&(o.CATEGORIES=e[u]),i.augmentTokenTypes([o]),t.has(e,`label`)&&(o.LABEL=e[f]),t.has(e,`group`)&&(o.GROUP=e[m]),t.has(e,`pop_mode`)&&(o.POP_MODE=e[g]),t.has(e,`push_mode`)&&(o.PUSH_MODE=e[h]),t.has(e,`longer_alt`)&&(o.LONGER_ALT=e[_]),t.has(e,`line_breaks`)&&(o.LINE_BREAKS=e[v]),t.has(e,`start_chars_hint`)&&(o.START_CHARS_HINT=e[y]),o}exports.EOF=b({name:`EOF`,pattern:r.Lexer.NA}),i.augmentTokenTypes([exports.EOF]);function S(e,t,n,r,i,a,o,s){return{image:t,startOffset:n,endOffset:r,startLine:i,endLine:a,startColumn:o,endColumn:s,tokenTypeIdx:e.tokenTypeIdx,tokenType:e}}exports.createTokenInstance=S;function C(e,t){return i.tokenStructuredMatcher(e,t)}exports.tokenMatcher=C})),h=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=o(),r=m(),i=function(){function e(e){this.definition=e}return e.prototype.accept=function(e){e.visit(this),n.forEach(this.definition,function(t){t.accept(e)})},e}();exports.AbstractProduction=i;var a=function(e){t(r,e);function r(t){var r=e.call(this,[])||this;return r.idx=1,n.assign(r,n.pick(t,function(e){return e!==void 0})),r}return Object.defineProperty(r.prototype,`definition`,{get:function(){return this.referencedRule===void 0?[]:this.referencedRule.definition},set:function(e){},enumerable:!0,configurable:!0}),r.prototype.accept=function(e){e.visit(this)},r}(i);exports.NonTerminal=a;var s=function(e){t(r,e);function r(t){var r=e.call(this,t.definition)||this;return r.orgText=``,n.assign(r,n.pick(t,function(e){return e!==void 0})),r}return r}(i);exports.Rule=s;var c=function(e){t(r,e);function r(t){var r=e.call(this,t.definition)||this;return n.assign(r,n.pick(t,function(e){return e!==void 0})),r}return r}(i);exports.Flat=c;var l=function(e){t(r,e);function r(t){var r=e.call(this,t.definition)||this;return r.idx=1,n.assign(r,n.pick(t,function(e){return e!==void 0})),r}return r}(i);exports.Option=l;var u=function(e){t(r,e);function r(t){var r=e.call(this,t.definition)||this;return r.idx=1,n.assign(r,n.pick(t,function(e){return e!==void 0})),r}return r}(i);exports.RepetitionMandatory=u;var d=function(e){t(r,e);function r(t){var r=e.call(this,t.definition)||this;return r.idx=1,n.assign(r,n.pick(t,function(e){return e!==void 0})),r}return r}(i);exports.RepetitionMandatoryWithSeparator=d;var f=function(e){t(r,e);function r(t){var r=e.call(this,t.definition)||this;return r.idx=1,n.assign(r,n.pick(t,function(e){return e!==void 0})),r}return r}(i);exports.Repetition=f;var p=function(e){t(r,e);function r(t){var r=e.call(this,t.definition)||this;return r.idx=1,n.assign(r,n.pick(t,function(e){return e!==void 0})),r}return r}(i);exports.RepetitionWithSeparator=p;var h=function(e){t(r,e);function r(t){var r=e.call(this,t.definition)||this;return r.idx=1,n.assign(r,n.pick(t,function(e){return e!==void 0})),r}return r}(i);exports.Alternation=h;var g=function(){function e(e){this.idx=1,n.assign(this,n.pick(e,function(e){return e!==void 0}))}return e.prototype.accept=function(e){e.visit(this)},e}();exports.Terminal=g;function _(e){return n.map(e,v)}exports.serializeGrammar=_;function v(e){function t(e){return n.map(e,v)}if(e instanceof a)return{type:`NonTerminal`,name:e.nonTerminalName,idx:e.idx};if(e instanceof c)return{type:`Flat`,definition:t(e.definition)};if(e instanceof l)return{type:`Option`,idx:e.idx,definition:t(e.definition)};if(e instanceof u)return{type:`RepetitionMandatory`,name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof d)return{type:`RepetitionMandatoryWithSeparator`,name:e.name,idx:e.idx,separator:v(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof p)return{type:`RepetitionWithSeparator`,name:e.name,idx:e.idx,separator:v(new g({terminalType:e.separator})),definition:t(e.definition)};if(e instanceof f)return{type:`Repetition`,name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof h)return{type:`Alternation`,name:e.name,idx:e.idx,definition:t(e.definition)};if(e instanceof g){var i={type:`Terminal`,name:r.tokenName(e.terminalType),label:r.tokenLabel(e.terminalType),idx:e.idx},o=e.terminalType.PATTERN;return e.terminalType.PATTERN&&(i.pattern=n.isRegExp(o)?o.source:o),i}else if(e instanceof s)return{type:`Rule`,name:e.name,orgText:e.orgText,definition:t(e.definition)};else throw Error(`non exhaustive match`)}exports.serializeProduction=v})),g=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=h();exports.RestWalker=function(){function e(){}return e.prototype.walk=function(e,r){var i=this;r===void 0&&(r=[]),t.forEach(e.definition,function(a,o){var s=t.drop(e.definition,o+1);if(a instanceof n.NonTerminal)i.walkProdRef(a,s,r);else if(a instanceof n.Terminal)i.walkTerminal(a,s,r);else if(a instanceof n.Flat)i.walkFlat(a,s,r);else if(a instanceof n.Option)i.walkOption(a,s,r);else if(a instanceof n.RepetitionMandatory)i.walkAtLeastOne(a,s,r);else if(a instanceof n.RepetitionMandatoryWithSeparator)i.walkAtLeastOneSep(a,s,r);else if(a instanceof n.RepetitionWithSeparator)i.walkManySep(a,s,r);else if(a instanceof n.Repetition)i.walkMany(a,s,r);else if(a instanceof n.Alternation)i.walkOr(a,s,r);else throw Error(`non exhaustive match`)})},e.prototype.walkTerminal=function(e,t,n){},e.prototype.walkProdRef=function(e,t,n){},e.prototype.walkFlat=function(e,t,n){var r=t.concat(n);this.walk(e,r)},e.prototype.walkOption=function(e,t,n){var r=t.concat(n);this.walk(e,r)},e.prototype.walkAtLeastOne=function(e,t,r){var i=[new n.Option({definition:e.definition})].concat(t,r);this.walk(e,i)},e.prototype.walkAtLeastOneSep=function(e,t,n){var i=r(e,t,n);this.walk(e,i)},e.prototype.walkMany=function(e,t,r){var i=[new n.Option({definition:e.definition})].concat(t,r);this.walk(e,i)},e.prototype.walkManySep=function(e,t,n){var i=r(e,t,n);this.walk(e,i)},e.prototype.walkOr=function(e,r,i){var a=this,o=r.concat(i);t.forEach(e.definition,function(e){var t=new n.Flat({definition:[e]});a.walk(t,o)})},e}();function r(e,t,r){return[new n.Option({definition:[new n.Terminal({terminalType:e.separator})].concat(e.definition)})].concat(t,r)}})),_=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=h();exports.GAstVisitor=function(){function e(){}return e.prototype.visit=function(e){if(e instanceof t.NonTerminal)return this.visitNonTerminal(e);if(e instanceof t.Flat)return this.visitFlat(e);if(e instanceof t.Option)return this.visitOption(e);if(e instanceof t.RepetitionMandatory)return this.visitRepetitionMandatory(e);if(e instanceof t.RepetitionMandatoryWithSeparator)return this.visitRepetitionMandatoryWithSeparator(e);if(e instanceof t.RepetitionWithSeparator)return this.visitRepetitionWithSeparator(e);if(e instanceof t.Repetition)return this.visitRepetition(e);if(e instanceof t.Alternation)return this.visitAlternation(e);if(e instanceof t.Terminal)return this.visitTerminal(e);if(e instanceof t.Rule)return this.visitRule(e);throw Error(`non exhaustive match`)},e.prototype.visitNonTerminal=function(e){},e.prototype.visitFlat=function(e){},e.prototype.visitOption=function(e){},e.prototype.visitRepetition=function(e){},e.prototype.visitRepetitionMandatory=function(e){},e.prototype.visitRepetitionMandatoryWithSeparator=function(e){},e.prototype.visitRepetitionWithSeparator=function(e){},e.prototype.visitAlternation=function(e){},e.prototype.visitTerminal=function(e){},e.prototype.visitRule=function(e){},e}()})),v=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=o(),r=h(),i=_(),a=m();function s(e){return e instanceof r.Flat||e instanceof r.Option||e instanceof r.Repetition||e instanceof r.RepetitionMandatory||e instanceof r.RepetitionMandatoryWithSeparator||e instanceof r.RepetitionWithSeparator||e instanceof r.Terminal||e instanceof r.Rule}exports.isSequenceProd=s;function c(e,t){return t===void 0&&(t=[]),e instanceof r.Option||e instanceof r.Repetition||e instanceof r.RepetitionWithSeparator?!0:e instanceof r.Alternation?n.some(e.definition,function(e){return c(e,t)}):e instanceof r.NonTerminal&&n.contains(t,e)?!1:e instanceof r.AbstractProduction?(e instanceof r.NonTerminal&&t.push(e),n.every(e.definition,function(e){return c(e,t)})):!1}exports.isOptionalProd=c;function l(e){return e instanceof r.Alternation}exports.isBranchingProd=l;function u(e){if(e instanceof r.NonTerminal)return`SUBRULE`;if(e instanceof r.Option)return`OPTION`;if(e instanceof r.Alternation)return`OR`;if(e instanceof r.RepetitionMandatory)return`AT_LEAST_ONE`;if(e instanceof r.RepetitionMandatoryWithSeparator)return`AT_LEAST_ONE_SEP`;if(e instanceof r.RepetitionWithSeparator)return`MANY_SEP`;if(e instanceof r.Repetition)return`MANY`;if(e instanceof r.Terminal)return`CONSUME`;throw Error(`non exhaustive match`)}exports.getProductionDslName=u,exports.DslMethodsCollectorVisitor=function(e){t(r,e);function r(){var t=e!==null&&e.apply(this,arguments)||this;return t.separator=`-`,t.dslMethods={option:[],alternation:[],repetition:[],repetitionWithSeparator:[],repetitionMandatory:[],repetitionMandatoryWithSeparator:[]},t}return r.prototype.visitTerminal=function(e){var t=a.tokenName(e.terminalType)+this.separator+`Terminal`;n.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},r.prototype.visitNonTerminal=function(e){var t=e.nonTerminalName+this.separator+`Terminal`;n.has(this.dslMethods,t)||(this.dslMethods[t]=[]),this.dslMethods[t].push(e)},r.prototype.visitOption=function(e){this.dslMethods.option.push(e)},r.prototype.visitRepetitionWithSeparator=function(e){this.dslMethods.repetitionWithSeparator.push(e)},r.prototype.visitRepetitionMandatory=function(e){this.dslMethods.repetitionMandatory.push(e)},r.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.dslMethods.repetitionMandatoryWithSeparator.push(e)},r.prototype.visitRepetition=function(e){this.dslMethods.repetition.push(e)},r.prototype.visitAlternation=function(e){this.dslMethods.alternation.push(e)},r}(i.GAstVisitor)})),y=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=h(),r=v();function i(e){if(e instanceof n.NonTerminal)return i(e.referencedRule);if(e instanceof n.Terminal)return c(e);if(r.isSequenceProd(e))return a(e);if(r.isBranchingProd(e))return s(e);throw Error(`non exhaustive match`)}exports.first=i;function a(e){for(var n=[],a=e.definition,o=0,s=a.length>o,c,l=!0;s&&l;)c=a[o],l=r.isOptionalProd(c),n=n.concat(i(c)),o+=1,s=a.length>o;return t.uniq(n)}exports.firstForSequence=a;function s(e){var n=t.map(e.definition,function(e){return i(e)});return t.uniq(t.flatten(n))}exports.firstForBranching=s;function c(e){return[e.terminalType]}exports.firstForTerminal=c})),b=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.IN=`_~IN~_`})),x=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=g(),r=s(),i=y(),a=o(),c=b(),l=m(),u=h(),d=function(e){t(n,e);function n(t){var n=e.call(this)||this;return n.topProd=t,n.follows=new r.HashTable,n}return n.prototype.startWalking=function(){return this.walk(this.topProd),this.follows},n.prototype.walkTerminal=function(e,t,n){},n.prototype.walkProdRef=function(e,t,n){var r=p(e.referencedRule,e.idx)+this.topProd.name,a=t.concat(n),o=new u.Flat({definition:a}),s=i.first(o);this.follows.put(r,s)},n}(n.RestWalker);exports.ResyncFollowsWalker=d;function f(e){var t=new r.HashTable;return a.forEach(e,function(e){var n=new d(e).startWalking();t.putAll(n)}),t}exports.computeAllProdsFollows=f;function p(e,t){return e.name+t+c.IN}exports.buildBetweenProdsFollowPrefix=p;function _(e){return l.tokenName(e.terminalType)+e.idx+c.IN}exports.buildInProdFollowPrefix=_})),S=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.Range=function(){function e(e,n){if(this.start=e,this.end=n,!t(e,n))throw Error(`INVALID RANGE`)}return e.prototype.contains=function(e){return this.start<=e&&this.end>=e},e.prototype.containsRange=function(e){return this.start<=e.start&&this.end>=e.end},e.prototype.isContainedInRange=function(e){return e.containsRange(this)},e.prototype.strictlyContainsRange=function(e){return this.start<e.start&&this.end>e.end},e.prototype.isStrictlyContainedInRange=function(e){return e.strictlyContainsRange(this)},e}();function t(e,t){return!(e<0||t<e)}exports.isValidRange=t})),C=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=S(),n=o(),r=h(),i;(function(e){e[e.OPTION=0]=`OPTION`,e[e.OR=1]=`OR`,e[e.MANY=2]=`MANY`,e[e.MANY_SEP=3]=`MANY_SEP`,e[e.AT_LEAST_ONE=4]=`AT_LEAST_ONE`,e[e.AT_LEAST_ONE_SEP=5]=`AT_LEAST_ONE_SEP`,e[e.REF=6]=`REF`,e[e.TERMINAL=7]=`TERMINAL`,e[e.FLAT=8]=`FLAT`})(i=exports.ProdType||={});var a=/(?:\s*{\s*NAME\s*:\s*["'`]([\w$]*)["'`])?/,s=new RegExp(a.source.replace(`{`,``).replace(`)?`,`\\s*,)?`)),c=/\.\s*CONSUME(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,l=new RegExp(c.source,`g`),u=/\.\s*SUBRULE(\d+)?\s*\(\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,d=new RegExp(u.source,`g`),f=/\.\s*OPTION(\d+)?\s*\(/,p=new RegExp(f.source+a.source),m=new RegExp(f.source,`g`),g=/\.\s*MANY(\d+)?\s*\(/,_=new RegExp(g.source+a.source),v=new RegExp(g.source,`g`),y=/\s*SEP\s*:\s*(?:[a-zA-Z_$]\w*\s*\.\s*)*([a-zA-Z_$]\w*)/,b=RegExp(`\\.\\s*MANY_SEP(\\d+)?\\s*\\(\\s*{`+s.source+y.source),x=new RegExp(b.source,`g`),C=RegExp(`\\.\\s*AT_LEAST_ONE_SEP(\\d+)?\\s*\\(\\s*{`+s.source+y.source),w=new RegExp(C.source,`g`),T=/\.\s*AT_LEAST_ONE(\d+)?\s*\(/,E=new RegExp(T.source+a.source),D=new RegExp(T.source,`g`),O=/\.\s*OR(\d+)?\s*\(/,k=new RegExp(O.source+a.source),A=new RegExp(O.source,`g`),j=RegExp(s.source+`\\s*(ALT)\\s*:`),M=new RegExp(j.source,`g`);function N(n,r,i){exports.terminalNameToConstructor=i;var a=` `+n,o=ue(` `+a),s=fe(o),c=pe(s),l=new t.Range(0,n.length+2);return P(r,l,c,n)}exports.buildTopProduction=N;function P(e,t,n,i){var a=new r.Rule({name:e,definition:[],orgText:i});return z(a,t,n,e)}function F(e,t,n){switch(e.type){case i.AT_LEAST_ONE:return L(e,t,n);case i.AT_LEAST_ONE_SEP:return ne(e,t,n);case i.MANY_SEP:return ie(e,t,n);case i.MANY:return re(e,t,n);case i.OPTION:return ae(e,t,n);case i.OR:return oe(e,t,n);case i.FLAT:return se(e,t,n);case i.REF:return ee(e);case i.TERMINAL:return te(e,n);default:throw Error(`non exhaustive match`)}}exports.buildProdGast=F;function ee(e){var t=u.exec(e.text),n=t[1]===void 0?0:parseInt(t[1],10),i=t[2];return new r.NonTerminal({nonTerminalName:i,idx:n})}function te(t,n){var i=c.exec(t.text),a=i[1]===void 0?0:parseInt(i[1],10),o=i[2],s=exports.terminalNameToConstructor[o];if(!s)throw Error(`Terminal Token name: <`+o+`> not found in rule: <`+n+`>  
	See: https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#TERMINAL_NAME_NOT_FOUND
	For Further details.`);return new r.Terminal({terminalType:s,idx:a})}function I(e,t,r,i,a){var o=e.exec(r.text);t.idx=o[1]===void 0?0:parseInt(o[1],10);var s=o[2];return n.isUndefined(s)||(t.name=s),z(t,r.range,i,a)}function L(e,t,n){return I(E,new r.RepetitionMandatory({definition:[]}),e,t,n)}function ne(e,t,n){return R(e,t,r.RepetitionMandatoryWithSeparator,C,n)}function re(e,t,n){return I(_,new r.Repetition({definition:[]}),e,t,n)}function ie(e,t,n){return R(e,t,r.RepetitionWithSeparator,b,n)}function R(t,r,i,a,o){var s=a.exec(t.text),c=s[1]===void 0?0:parseInt(s[1],10),l=s[3],u=exports.terminalNameToConstructor[l];if(!u)throw Error(`Separator Terminal Token name: `+l+` not found`);var d=new i({definition:[],separator:u,idx:c}),f=s[2];return n.isUndefined(f)||(d.name=f),z(d,t.range,r,o)}function ae(e,t,n){return I(p,new r.Option({definition:[]}),e,t,n)}function oe(e,t,n){return I(k,new r.Alternation({definition:[]}),e,t,n)}function se(e,t,i){var a=new r.Flat({definition:[]}),o=j.exec(e.text)[1];return n.isUndefined(o)||(a.name=o),z(a,e.range,t,i)}function z(e,t,r,i){var a=B(t,r),o=n.sortBy(a,function(e){return e.range.start}),s=[];return n.forEach(o,function(e){s.push(F(e,r,i))}),e.definition=s,e}function B(e,t){return n.filter(t,function(r){var i=e.strictlyContainsRange(r.range),a=n.every(t,function(t){var n=t.range.strictlyContainsRange(r.range),i=t.range.isStrictlyContainedInRange(e);return!(n&&i)});return i&&a})}exports.getDirectlyContainedRanges=B;var ce=/\/\/.*/g,H=/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\//g,U=/(NAME\s*:\s*)?"([^\\"]|\\([bfnrtv"\\/]|u[0-9a-fA-F]{4}))*"/g,le=/(NAME\s*:\s*)?'([^\\']|\\([bfnrtv'\\/]|u[0-9a-fA-F]{4}))*'/g;function ue(e){return e.replace(ce,``).replace(H,``)}exports.removeComments=ue;function de(e,t){return t===void 0?``:e}function fe(e){return e.replace(U,de).replace(le,de)}exports.removeStringLiterals=fe;function pe(e){var t=me(e),n=he(e),r=ge(e),i=_e(e),a=W(e),o=ve(e),s=G(e),c=ye(e);return[].concat(t,n,r,i,a,o,s,c)}exports.createRanges=pe;function me(e){return Ce(e,i.TERMINAL,l)}exports.createTerminalRanges=me;function he(e){return Ce(e,i.REF,d)}exports.createRefsRanges=he;function ge(e){return K(e,i.AT_LEAST_ONE,D)}exports.createAtLeastOneRanges=ge;function _e(e){return K(e,i.AT_LEAST_ONE_SEP,w)}exports.createAtLeastOneSepRanges=_e;function W(e){return K(e,i.MANY,v)}exports.createManyRanges=W;function ve(e){return K(e,i.MANY_SEP,x)}exports.createManySepRanges=ve;function G(e){return K(e,i.OPTION,m)}exports.createOptionRanges=G;function ye(e){var t=K(e,i.OR,A),n=Se(t);return t.concat(n)}exports.createOrRanges=ye;var be=n.partial(Te,`{`,`}`),xe=n.partial(Te,`(`,`)`);function Se(e){var t=[];return n.forEach(e,function(e){var r=we(e.text,i.FLAT,M,be),a=e.range.start;n.forEach(r,function(e){e.range.start+=a,e.range.end+=a}),t=t.concat(r)}),n.uniq(t,function(e){return e.type+`~`+e.range.start+`~`+e.range.end+`~`+e.text})}exports.createOrPartRanges=Se;function Ce(e,n,r){for(var i=[],a;a=r.exec(e);){var o=a.index,s=r.lastIndex,c=new t.Range(o,s),l=a[0];i.push({range:c,text:l,type:n})}return i}function K(e,t,n){return we(e,t,n,xe)}function we(e,n,r,i){for(var a=[],o;o=r.exec(e);){var s=o.index,c=i(s+o[0].length,e),l=new t.Range(s,c),u=e.substr(s,c-s+1);a.push({range:l,text:u,type:n})}return a}function Te(e,t,r,i){for(var a=[1],o=-1;!n.isEmpty(a)&&o+r<i.length;){o++;var s=i.charAt(r+o);s===e?a.push(1):s===t&&a.pop()}if(n.isEmpty(a))return o+r;throw Error(`INVALID INPUT TEXT, UNTERMINATED PARENTHESIS`)}exports.findClosingOffset=Te;function q(e,t){return n.map(e,function(e){return Ee(e,t)})}exports.deserializeGrammar=q;function Ee(e,t){switch(e.type){case`NonTerminal`:return new r.NonTerminal({nonTerminalName:e.name,idx:e.idx});case`Flat`:return new r.Flat({name:e.name,definition:q(e.definition,t)});case`Option`:return new r.Option({name:e.name,idx:e.idx,definition:q(e.definition,t)});case`RepetitionMandatory`:return new r.RepetitionMandatory({name:e.name,idx:e.idx,definition:q(e.definition,t)});case`RepetitionMandatoryWithSeparator`:return new r.RepetitionMandatoryWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:q(e.definition,t)});case`RepetitionWithSeparator`:return new r.RepetitionWithSeparator({name:e.name,idx:e.idx,separator:t[e.separator.name],definition:q(e.definition,t)});case`Repetition`:return new r.Repetition({name:e.name,idx:e.idx,definition:q(e.definition,t)});case`Alternation`:return new r.Alternation({name:e.name,idx:e.idx,definition:q(e.definition,t)});case`Terminal`:return new r.Terminal({terminalType:t[e.name],idx:e.idx});case`Rule`:return new r.Rule({name:e.name,orgText:e.orgText,definition:q(e.definition,t)});default:}}exports.deserializeProduction=Ee})),w=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.BITS_FOR_METHOD_IDX=4,exports.BITS_FOR_OCCURRENCE_IDX=4,exports.BITS_FOR_RULE_IDX=24,exports.BITS_FOR_ALT_IDX=8,exports.OR_IDX=1<<exports.BITS_FOR_METHOD_IDX,exports.OPTION_IDX=2<<exports.BITS_FOR_METHOD_IDX,exports.MANY_IDX=3<<exports.BITS_FOR_METHOD_IDX,exports.AT_LEAST_ONE_IDX=4<<exports.BITS_FOR_METHOD_IDX,exports.MANY_SEP_IDX=5<<exports.BITS_FOR_METHOD_IDX,exports.AT_LEAST_ONE_SEP_IDX=6<<exports.BITS_FOR_METHOD_IDX;function t(e,t,n){return n|t|e}exports.getKeyForAutomaticLookahead=t;var n=32-exports.BITS_FOR_ALT_IDX;function r(e,r,i,a){var o=a+1<<n;return t(e,r,i)|o}exports.getKeyForAltIndex=r})),T=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=o(),r=s(),i=w(),a=h(),c=_();function l(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.endOffset=t.endOffset):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset)}exports.setNodeLocationOnlyOffset=l;function u(e,t){isNaN(e.startOffset)===!0?(e.startOffset=t.startOffset,e.startColumn=t.startColumn,e.startLine=t.startLine,e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine):e.endOffset<t.endOffset&&(e.endOffset=t.endOffset,e.endColumn=t.endColumn,e.endLine=t.endLine)}exports.setNodeLocationFull=u;function d(e,t,n){e.children[n]===void 0?e.children[n]=[t]:e.children[n].push(t)}exports.addTerminalToCst=d;function f(e,t,n){e.children[t]===void 0?e.children[t]=[n]:e.children[t].push(n)}exports.addNoneTerminalToCst=f;var p=function(e){t(r,e);function r(t){var n=e.call(this)||this;return n.result=[],n.ruleIdx=t,n}return r.prototype.collectNamedDSLMethod=function(e,t,r){if(!n.isUndefined(e.name)){var o=void 0;if(e instanceof a.Option||e instanceof a.Repetition||e instanceof a.RepetitionMandatory||e instanceof a.Alternation)o=new t({definition:e.definition,idx:e.idx});else if(e instanceof a.RepetitionMandatoryWithSeparator||e instanceof a.RepetitionWithSeparator)o=new t({definition:e.definition,idx:e.idx,separator:e.separator});else throw Error(`non exhaustive match`);var s=[o],c=i.getKeyForAutomaticLookahead(this.ruleIdx,r,e.idx);this.result.push({def:s,key:c,name:e.name,orgProd:e})}},r.prototype.visitOption=function(e){this.collectNamedDSLMethod(e,a.Option,i.OPTION_IDX)},r.prototype.visitRepetition=function(e){this.collectNamedDSLMethod(e,a.Repetition,i.MANY_IDX)},r.prototype.visitRepetitionMandatory=function(e){this.collectNamedDSLMethod(e,a.RepetitionMandatory,i.AT_LEAST_ONE_IDX)},r.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.collectNamedDSLMethod(e,a.RepetitionMandatoryWithSeparator,i.AT_LEAST_ONE_SEP_IDX)},r.prototype.visitRepetitionWithSeparator=function(e){this.collectNamedDSLMethod(e,a.RepetitionWithSeparator,i.MANY_SEP_IDX)},r.prototype.visitAlternation=function(e){var t=this;this.collectNamedDSLMethod(e,a.Alternation,i.OR_IDX);var r=e.definition.length>1;n.forEach(e.definition,function(o,s){if(!n.isUndefined(o.name)){var c=o.definition;c=r?[new a.Option({definition:o.definition})]:o.definition;var l=i.getKeyForAltIndex(t.ruleIdx,i.OR_IDX,e.idx,s);t.result.push({def:c,key:l,name:o.name,orgProd:o})}})},r}(c.GAstVisitor);exports.NamedDSLMethodsCollectorVisitor=p;function m(e,t){var i={dictDef:new r.HashTable,allRuleNames:[]};return n.forEach(e,function(e){var r=t.get(e.name);i.allRuleNames.push(e.name);var a=new p(r);e.accept(a),n.forEach(a.result,function(t){t.def,t.key;var n=t.name;i.allRuleNames.push(e.name+n)})}),i}exports.analyzeCst=m})),E=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=g(),r=o(),i=m(),a=y(),s=h(),c=function(e){t(n,e);function n(t,n){var r=e.call(this)||this;return r.topProd=t,r.path=n,r.possibleTokTypes=[],r.nextProductionName=``,r.nextProductionOccurrence=0,r.found=!1,r.isAtEndOfPath=!1,r}return n.prototype.startWalking=function(){if(this.found=!1,this.path.ruleStack[0]!==this.topProd.name)throw Error(`The path does not start with the walker's top Rule!`);return this.ruleStack=r.cloneArr(this.path.ruleStack).reverse(),this.occurrenceStack=r.cloneArr(this.path.occurrenceStack).reverse(),this.ruleStack.pop(),this.occurrenceStack.pop(),this.updateExpectedNext(),this.walk(this.topProd),this.possibleTokTypes},n.prototype.walk=function(t,n){n===void 0&&(n=[]),this.found||e.prototype.walk.call(this,t,n)},n.prototype.walkProdRef=function(e,t,n){if(e.referencedRule.name===this.nextProductionName&&e.idx===this.nextProductionOccurrence){var r=t.concat(n);this.updateExpectedNext(),this.walk(e.referencedRule,r)}},n.prototype.updateExpectedNext=function(){r.isEmpty(this.ruleStack)?(this.nextProductionName=``,this.nextProductionOccurrence=0,this.isAtEndOfPath=!0):(this.nextProductionName=this.ruleStack.pop(),this.nextProductionOccurrence=this.occurrenceStack.pop())},n}(n.RestWalker);exports.AbstractNextPossibleTokensWalker=c,exports.NextAfterTokenWalker=function(e){t(n,e);function n(t,n){var r=e.call(this,t,n)||this;return r.path=n,r.nextTerminalName=``,r.nextTerminalOccurrence=0,r.nextTerminalName=i.tokenName(r.path.lastTok),r.nextTerminalOccurrence=r.path.lastTokOccurrence,r}return n.prototype.walkTerminal=function(e,t,n){if(this.isAtEndOfPath&&i.tokenName(e.terminalType)===this.nextTerminalName&&e.idx===this.nextTerminalOccurrence&&!this.found){var r=t.concat(n),o=new s.Flat({definition:r});this.possibleTokTypes=a.first(o),this.found=!0}},n}(c);var l=function(e){t(n,e);function n(t,n){var r=e.call(this)||this;return r.topRule=t,r.occurrence=n,r.result={token:void 0,occurrence:void 0,isEndOfRule:void 0},r}return n.prototype.startWalking=function(){return this.walk(this.topRule),this.result},n}(n.RestWalker);exports.AbstractNextTerminalAfterProductionWalker=l,exports.NextTerminalAfterManyWalker=function(e){t(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.walkMany=function(t,n,i){if(t.idx===this.occurrence){var a=r.first(n.concat(i));this.result.isEndOfRule=a===void 0,a instanceof s.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkMany.call(this,t,n,i)},n}(l),exports.NextTerminalAfterManySepWalker=function(e){t(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.walkManySep=function(t,n,i){if(t.idx===this.occurrence){var a=r.first(n.concat(i));this.result.isEndOfRule=a===void 0,a instanceof s.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkManySep.call(this,t,n,i)},n}(l),exports.NextTerminalAfterAtLeastOneWalker=function(e){t(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.walkAtLeastOne=function(t,n,i){if(t.idx===this.occurrence){var a=r.first(n.concat(i));this.result.isEndOfRule=a===void 0,a instanceof s.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkAtLeastOne.call(this,t,n,i)},n}(l),exports.NextTerminalAfterAtLeastOneSepWalker=function(e){t(n,e);function n(){return e!==null&&e.apply(this,arguments)||this}return n.prototype.walkAtLeastOneSep=function(t,n,i){if(t.idx===this.occurrence){var a=r.first(n.concat(i));this.result.isEndOfRule=a===void 0,a instanceof s.Terminal&&(this.result.token=a.terminalType,this.result.occurrence=a.idx)}else e.prototype.walkAtLeastOneSep.call(this,t,n,i)},n}(l);function u(e,t,n){n===void 0&&(n=[]),n=r.cloneArr(n);var i=[],a=0;function o(t){return t.concat(r.drop(e,a+1))}function c(e){var r=u(o(e),t,n);return i.concat(r)}for(;n.length<t&&a<e.length;){var l=e[a];if(l instanceof s.Flat||l instanceof s.NonTerminal)return c(l.definition);if(l instanceof s.Option)i=c(l.definition);else if(l instanceof s.RepetitionMandatory){var d=l.definition.concat([new s.Repetition({definition:l.definition})]);return c(d)}else if(l instanceof s.RepetitionMandatoryWithSeparator){var d=[new s.Flat({definition:l.definition}),new s.Repetition({definition:[new s.Terminal({terminalType:l.separator})].concat(l.definition)})];return c(d)}else if(l instanceof s.RepetitionWithSeparator){var d=l.definition.concat([new s.Repetition({definition:[new s.Terminal({terminalType:l.separator})].concat(l.definition)})]);i=c(d)}else if(l instanceof s.Repetition){var d=l.definition.concat([new s.Repetition({definition:l.definition})]);i=c(d)}else if(l instanceof s.Alternation)return r.forEach(l.definition,function(e){i=c(e.definition)}),i;else if(l instanceof s.Terminal)n.push(l.terminalType);else throw Error(`non exhaustive match`);a++}return i.push({partialPath:n,suffixDef:r.drop(e,a)}),i}exports.possiblePathsFrom=u;function d(e,t,n,i){var a=`EXIT_NONE_TERMINAL`,o=[a],c=`EXIT_ALTERNATIVE`,l=!1,u=t.length,d=u-i-1,p=[],m=[];for(m.push({idx:-1,def:e,ruleStack:[],occurrenceStack:[]});!r.isEmpty(m);){var h=m.pop();if(h===c){l&&r.last(m).idx<=d&&m.pop();continue}var g=h.def,_=h.idx,v=h.ruleStack,y=h.occurrenceStack;if(!r.isEmpty(g)){var b=g[0];if(b===a){var x={idx:_,def:r.drop(g),ruleStack:r.dropRight(v),occurrenceStack:r.dropRight(y)};m.push(x)}else if(b instanceof s.Terminal)if(_<u-1){var S=_+1,C=t[S];if(n(C,b.terminalType)){var x={idx:S,def:r.drop(g),ruleStack:v,occurrenceStack:y};m.push(x)}}else if(_===u-1)p.push({nextTokenType:b.terminalType,nextTokenOccurrence:b.idx,ruleStack:v,occurrenceStack:y}),l=!0;else throw Error(`non exhaustive match`);else if(b instanceof s.NonTerminal){var w=r.cloneArr(v);w.push(b.nonTerminalName);var T=r.cloneArr(y);T.push(b.idx);var x={idx:_,def:b.definition.concat(o,r.drop(g)),ruleStack:w,occurrenceStack:T};m.push(x)}else if(b instanceof s.Option){var E={idx:_,def:r.drop(g),ruleStack:v,occurrenceStack:y};m.push(E),m.push(c);var D={idx:_,def:b.definition.concat(r.drop(g)),ruleStack:v,occurrenceStack:y};m.push(D)}else if(b instanceof s.RepetitionMandatory){var O=new s.Repetition({definition:b.definition,idx:b.idx}),k=b.definition.concat([O],r.drop(g)),x={idx:_,def:k,ruleStack:v,occurrenceStack:y};m.push(x)}else if(b instanceof s.RepetitionMandatoryWithSeparator){var A=new s.Terminal({terminalType:b.separator}),O=new s.Repetition({definition:[A].concat(b.definition),idx:b.idx}),k=b.definition.concat([O],r.drop(g)),x={idx:_,def:k,ruleStack:v,occurrenceStack:y};m.push(x)}else if(b instanceof s.RepetitionWithSeparator){var E={idx:_,def:r.drop(g),ruleStack:v,occurrenceStack:y};m.push(E),m.push(c);var A=new s.Terminal({terminalType:b.separator}),j=new s.Repetition({definition:[A].concat(b.definition),idx:b.idx}),k=b.definition.concat([j],r.drop(g)),D={idx:_,def:k,ruleStack:v,occurrenceStack:y};m.push(D)}else if(b instanceof s.Repetition){var E={idx:_,def:r.drop(g),ruleStack:v,occurrenceStack:y};m.push(E),m.push(c);var j=new s.Repetition({definition:b.definition,idx:b.idx}),k=b.definition.concat([j],r.drop(g)),D={idx:_,def:k,ruleStack:v,occurrenceStack:y};m.push(D)}else if(b instanceof s.Alternation)for(var M=b.definition.length-1;M>=0;M--){var N=b.definition[M],P={idx:_,def:N.definition.concat(r.drop(g)),ruleStack:v,occurrenceStack:y};m.push(P),m.push(c)}else if(b instanceof s.Flat)m.push({idx:_,def:b.definition.concat(r.drop(g)),ruleStack:v,occurrenceStack:y});else if(b instanceof s.Rule)m.push(f(b,_,v,y));else throw Error(`non exhaustive match`)}}return p}exports.nextPossibleTokensAfter=d;function f(e,t,n,i){var a=r.cloneArr(n);a.push(e.name);var o=r.cloneArr(i);return o.push(1),{idx:t,def:e.definition,ruleStack:a,occurrenceStack:o}}})),D=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=o(),r=E(),i=g(),a=d(),s=h(),c=_(),l;(function(e){e[e.OPTION=0]=`OPTION`,e[e.REPETITION=1]=`REPETITION`,e[e.REPETITION_MANDATORY=2]=`REPETITION_MANDATORY`,e[e.REPETITION_MANDATORY_WITH_SEPARATOR=3]=`REPETITION_MANDATORY_WITH_SEPARATOR`,e[e.REPETITION_WITH_SEPARATOR=4]=`REPETITION_WITH_SEPARATOR`,e[e.ALTERNATION=5]=`ALTERNATION`})(l=exports.PROD_TYPE||={});function u(e){if(e instanceof s.Option)return l.OPTION;if(e instanceof s.Repetition)return l.REPETITION;if(e instanceof s.RepetitionMandatory)return l.REPETITION_MANDATORY;if(e instanceof s.RepetitionMandatoryWithSeparator)return l.REPETITION_MANDATORY_WITH_SEPARATOR;if(e instanceof s.RepetitionWithSeparator)return l.REPETITION_WITH_SEPARATOR;if(e instanceof s.Alternation)return l.ALTERNATION;throw Error(`non exhaustive match`)}exports.getProdType=u;function f(e,t,n,r,i,o){var s=S(e,t,n),c=D(s)?a.tokenStructuredMatcherNoCategories:a.tokenStructuredMatcher;return o(s,r,c,i)}exports.buildLookaheadFuncForOr=f;function p(e,t,n,r,i,o){var s=C(e,t,i,n),c=D(s)?a.tokenStructuredMatcherNoCategories:a.tokenStructuredMatcher;return o(s[0],c,r)}exports.buildLookaheadFuncForOptionalProd=p;function m(e,t,r,i){var a=e.length,o=n.every(e,function(e){return n.every(e,function(e){return e.length===1})});if(t)return function(t){for(var i=n.map(t,function(e){return e.GATE}),o=0;o<a;o++){var s=e[o],c=s.length,l=i[o];if(!(l!==void 0&&l.call(this)===!1))nextPath:for(var u=0;u<c;u++){for(var d=s[u],f=d.length,p=0;p<f;p++){var m=this.LA(p+1);if(r(m,d[p])===!1)continue nextPath}return o}}};if(o&&!i){var s=n.map(e,function(e){return n.flatten(e)}),c=n.reduce(s,function(e,t,r){return n.forEach(t,function(t){n.has(e,t.tokenTypeIdx)||(e[t.tokenTypeIdx]=r),n.forEach(t.categoryMatches,function(t){n.has(e,t)||(e[t]=r)})}),e},[]);return function(){var e=this.LA(1);return c[e.tokenTypeIdx]}}else return function(){for(var t=0;t<a;t++){var n=e[t],i=n.length;nextPath:for(var o=0;o<i;o++){for(var s=n[o],c=s.length,l=0;l<c;l++){var u=this.LA(l+1);if(r(u,s[l])===!1)continue nextPath}return t}}}}exports.buildAlternativesLookAheadFunc=m;function v(e,t,r){var i=n.every(e,function(e){return e.length===1}),a=e.length;if(i&&!r){var o=n.flatten(e);if(o.length===1&&n.isEmpty(o[0].categoryMatches)){var s=o[0].tokenTypeIdx;return function(){return this.LA(1).tokenTypeIdx===s}}else{var c=n.reduce(o,function(e,t,r){return e[t.tokenTypeIdx]=!0,n.forEach(t.categoryMatches,function(t){e[t]=!0}),e},[]);return function(){var e=this.LA(1);return c[e.tokenTypeIdx]===!0}}}else return function(){nextPath:for(var n=0;n<a;n++){for(var r=e[n],i=r.length,o=0;o<i;o++){var s=this.LA(o+1);if(t(s,r[o])===!1)continue nextPath}return!0}return!1}}exports.buildSingleAlternativeLookaheadFunction=v;var y=function(e){t(n,e);function n(t,n,r){var i=e.call(this)||this;return i.topProd=t,i.targetOccurrence=n,i.targetProdType=r,i}return n.prototype.startWalking=function(){return this.walk(this.topProd),this.restDef},n.prototype.checkIsTarget=function(e,t,n,r){return e.idx===this.targetOccurrence&&this.targetProdType===t?(this.restDef=n.concat(r),!0):!1},n.prototype.walkOption=function(t,n,r){this.checkIsTarget(t,l.OPTION,n,r)||e.prototype.walkOption.call(this,t,n,r)},n.prototype.walkAtLeastOne=function(t,n,r){this.checkIsTarget(t,l.REPETITION_MANDATORY,n,r)||e.prototype.walkOption.call(this,t,n,r)},n.prototype.walkAtLeastOneSep=function(t,n,r){this.checkIsTarget(t,l.REPETITION_MANDATORY_WITH_SEPARATOR,n,r)||e.prototype.walkOption.call(this,t,n,r)},n.prototype.walkMany=function(t,n,r){this.checkIsTarget(t,l.REPETITION,n,r)||e.prototype.walkOption.call(this,t,n,r)},n.prototype.walkManySep=function(t,n,r){this.checkIsTarget(t,l.REPETITION_WITH_SEPARATOR,n,r)||e.prototype.walkOption.call(this,t,n,r)},n}(i.RestWalker),b=function(e){t(n,e);function n(t,n){var r=e.call(this)||this;return r.targetOccurrence=t,r.targetProdType=n,r.result=[],r}return n.prototype.checkIsTarget=function(e,t){e.idx===this.targetOccurrence&&this.targetProdType===t&&(this.result=e.definition)},n.prototype.visitOption=function(e){this.checkIsTarget(e,l.OPTION)},n.prototype.visitRepetition=function(e){this.checkIsTarget(e,l.REPETITION)},n.prototype.visitRepetitionMandatory=function(e){this.checkIsTarget(e,l.REPETITION_MANDATORY)},n.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.checkIsTarget(e,l.REPETITION_MANDATORY_WITH_SEPARATOR)},n.prototype.visitRepetitionWithSeparator=function(e){this.checkIsTarget(e,l.REPETITION_WITH_SEPARATOR)},n.prototype.visitAlternation=function(e){this.checkIsTarget(e,l.ALTERNATION)},n}(c.GAstVisitor);function x(e,t){function i(e,t){return n.reduce(e,function(e,r,i){if(i!==t){var a=n.map(r,function(e){return e.partialPath});return e.concat(a)}return e},[])}function a(e,t){return n.find(e,function(e){return n.every(t,function(t,n){return o(t,e[n])})})===void 0}function o(e,t){return e===t||e&&t&&(e.categoryMatchesMap[t.tokenTypeIdx]||t.categoryMatchesMap[e.tokenTypeIdx])}function s(e){for(var t=[],n=0;n<e;n++)t.push([]);return t}for(var c=n.map(e,function(e){return r.possiblePathsFrom([e],1)}),l=s(c.length),u=c,d=1;d<=t;d++){var f=u;u=s(f.length);for(var p=0;p<f.length;p++)for(var m=f[p],h=i(f,p),g=0;g<m.length;g++){var _=m[g].partialPath,v=m[g].suffixDef;if(a(h,_)||n.isEmpty(v)||_.length===t){var y=l[p];w(y,_)||y.push(_)}else{var b=r.possiblePathsFrom(v,d+1,_);u[p]=u[p].concat(b)}}}return l}exports.lookAheadSequenceFromAlternatives=x;function S(e,t,n){var r=new b(e,l.ALTERNATION);return t.accept(r),x(r.result,n)}exports.getLookaheadPathsForOr=S;function C(e,t,n,r){var i=new b(e,n);t.accept(i);var a=i.result,o=new y(t,e,n).startWalking(),c=new s.Flat({definition:a}),l=new s.Flat({definition:o});return x([c,l],r)}exports.getLookaheadPathsForOptionalProd=C;function w(e,t){return n.find(e,function(e){return t.length===e.length&&n.every(t,function(t,n){return t===e[n]||e[n].categoryMatchesMap[t.tokenTypeIdx]})})!==void 0}exports.containsPath=w;function T(e,t){return e.length<t.length&&n.every(e,function(e,n){var r=t[n];return e===r||r.categoryMatchesMap[e.tokenTypeIdx]})}exports.isStrictPrefixOfPath=T;function D(e){return n.every(e,function(e){return n.every(e,function(e){return n.every(e,function(e){return n.isEmpty(e.categoryMatches)})})})}exports.areTokenCategoriesNotUsed=D})),O=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=o(),r=o(),i=R(),a=v(),s=m(),c=D(),l=T(),u=E(),d=h(),f=_();function p(e,t,i,a,o,s){var c=n.map(e,function(e){return y(e,o)}),l=n.map(e,function(e){return j(e,e,o)}),u=[],d=[],f=[];r.every(l,r.isEmpty)&&(u=r.map(e,function(e){return P(e,o)}),d=r.map(e,function(e){return F(e,t,a,o)}),f=I(e,t,o));var p=re(e,i,o),m=n.map(i,function(e){return O(e,o)}),h=g(e,o),_=ie(e,o),v=r.map(e,function(e){return te(e,o)}),b=r.map(e,function(e){return C(e,o)}),x=r.map(e,function(t){return k(t,e,s,o)});return n.flatten(c.concat(m,h,_,f,l,u,d,p,v,b,x))}exports.validateGrammar=p;function g(e,t){var n=[];return r.forEach(e,function(e){var i=new l.NamedDSLMethodsCollectorVisitor(``);e.accept(i);var a=r.map(i.result,function(e){return e.orgProd});n.push(r.map(a,function(n){return w(e,n,t)}))}),r.flatten(n)}function y(e,t){var r=new S;e.accept(r);var o=r.allProductions,s=n.groupBy(o,b),c=n.pick(s,function(e){return e.length>1});return n.map(n.values(c),function(r){var o=n.first(r),s=t.buildDuplicateFoundError(e,r),c=a.getProductionDslName(o),l={message:s,type:i.ParserDefinitionErrorType.DUPLICATE_PRODUCTIONS,ruleName:e.name,dslName:c,occurrence:o.idx},u=x(o);return u&&(l.parameter=u),l})}function b(e){return a.getProductionDslName(e)+`_#_`+e.idx+`_#_`+x(e)}exports.identifyProductionForDuplicates=b;function x(e){return e instanceof d.Terminal?s.tokenName(e.terminalType):e instanceof d.NonTerminal?e.nonTerminalName:``}var S=function(e){t(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.allProductions=[],t}return n.prototype.visitNonTerminal=function(e){this.allProductions.push(e)},n.prototype.visitOption=function(e){this.allProductions.push(e)},n.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},n.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},n.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},n.prototype.visitRepetition=function(e){this.allProductions.push(e)},n.prototype.visitAlternation=function(e){this.allProductions.push(e)},n.prototype.visitTerminal=function(e){this.allProductions.push(e)},n}(f.GAstVisitor);exports.OccurrenceValidationCollector=S,exports.validTermsPattern=/^[a-zA-Z_]\w*$/,exports.validNestedRuleName=new RegExp(exports.validTermsPattern.source.replace(`^`,`^\\$`));function C(t,n){var r=[],a=t.name;return a.match(exports.validTermsPattern)||r.push({message:n.buildInvalidRuleNameError({topLevelRule:t,expectedPattern:exports.validTermsPattern}),type:i.ParserDefinitionErrorType.INVALID_RULE_NAME,ruleName:a}),r}exports.validateRuleName=C;function w(t,n,r){var a=[],o;return n.name.match(exports.validNestedRuleName)||(o=r.buildInvalidNestedRuleNameError(t,n),a.push({message:o,type:i.ParserDefinitionErrorType.INVALID_NESTED_RULE_NAME,ruleName:t.name})),a}exports.validateNestedRuleName=w;function O(t,n){var r=[];return s.tokenName(t).match(exports.validTermsPattern)||r.push({message:n.buildTokenNameError({tokenType:t,expectedPattern:exports.validTermsPattern}),type:i.ParserDefinitionErrorType.INVALID_TOKEN_NAME}),r}exports.validateTokenName=O;function k(e,t,n,a){var o=[];if(r.reduce(t,function(t,n){return n.name===e.name?t+1:t},0)>1){var s=a.buildDuplicateRuleNameError({topLevelRule:e,grammarName:n});o.push({message:s,type:i.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e.name})}return o}exports.validateRuleDoesNotAlreadyExist=k;function A(e,t,r){var a=[],o;return n.contains(t,e)||(o=`Invalid rule override, rule: ->`+e+`<- cannot be overridden in the grammar: ->`+r+`<-as it is not defined in any of the super grammars `,a.push({message:o,type:i.ParserDefinitionErrorType.INVALID_RULE_OVERRIDE,ruleName:e})),a}exports.validateRuleIsOverridden=A;function j(e,t,r,a){a===void 0&&(a=[]);var o=[],s=M(t.definition);if(n.isEmpty(s))return[];var c=e.name;n.contains(s,e)&&o.push({message:r.buildLeftRecursionError({topLevelRule:e,leftRecursionPath:a}),type:i.ParserDefinitionErrorType.LEFT_RECURSION,ruleName:c});var l=n.difference(s,a.concat([e])),u=n.map(l,function(t){var i=n.cloneArr(a);return i.push(t),j(e,t,r,i)});return o.concat(n.flatten(u))}exports.validateNoLeftRecursion=j;function M(e){var t=[];if(n.isEmpty(e))return t;var r=n.first(e);if(r instanceof d.NonTerminal)t.push(r.referencedRule);else if(r instanceof d.Flat||r instanceof d.Option||r instanceof d.RepetitionMandatory||r instanceof d.RepetitionMandatoryWithSeparator||r instanceof d.RepetitionWithSeparator||r instanceof d.Repetition)t=t.concat(M(r.definition));else if(r instanceof d.Alternation)t=n.flatten(n.map(r.definition,function(e){return M(e.definition)}));else if(!(r instanceof d.Terminal))throw Error(`non exhaustive match`);var i=a.isOptionalProd(r),o=e.length>1;if(i&&o){var s=n.drop(e);return t.concat(M(s))}else return t}exports.getFirstNoneTerminal=M;var N=function(e){t(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.alternations=[],t}return n.prototype.visitAlternation=function(e){this.alternations.push(e)},n}(f.GAstVisitor);function P(e,t){var r=new N;e.accept(r);var a=r.alternations;return n.reduce(a,function(r,a){var o=n.dropRight(a.definition),s=n.map(o,function(r,o){var s=u.nextPossibleTokensAfter([r],[],null,1);return n.isEmpty(s)?{message:t.buildEmptyAlternationError({topLevelRule:e,alternation:a,emptyChoiceIdx:o}),type:i.ParserDefinitionErrorType.NONE_LAST_EMPTY_ALT,ruleName:e.name,occurrence:a.idx,alternative:o+1}:null});return r.concat(n.compact(s))},[])}exports.validateEmptyOrAlternative=P;function F(e,t,i,o){var s=new N;e.accept(s);var l=s.alternations,u=i[e.name];return u&&(l=r.reject(l,function(e){return u[a.getProductionDslName(e)+(e.idx===0?``:e.idx)]})),n.reduce(l,function(n,r){var i=r.idx,a=c.getLookaheadPathsForOr(i,e,t),s=L(a,r,e,o),l=ne(a,r,e,o);return n.concat(s,l)},[])}exports.validateAmbiguousAlternationAlternatives=F;var ee=function(e){t(n,e);function n(){var t=e!==null&&e.apply(this,arguments)||this;return t.allProductions=[],t}return n.prototype.visitRepetitionWithSeparator=function(e){this.allProductions.push(e)},n.prototype.visitRepetitionMandatory=function(e){this.allProductions.push(e)},n.prototype.visitRepetitionMandatoryWithSeparator=function(e){this.allProductions.push(e)},n.prototype.visitRepetition=function(e){this.allProductions.push(e)},n}(f.GAstVisitor);exports.RepetionCollector=ee;function te(e,t){var r=new N;e.accept(r);var a=r.alternations;return n.reduce(a,function(n,r){return r.definition.length>255&&n.push({message:t.buildTooManyAlternativesError({topLevelRule:e,alternation:r}),type:i.ParserDefinitionErrorType.TOO_MANY_ALTS,ruleName:e.name,occurrence:r.idx}),n},[])}exports.validateTooManyAlts=te;function I(e,t,n){var a=[];return r.forEach(e,function(e){var o=new ee;e.accept(o);var s=o.allProductions;r.forEach(s,function(o){var s=c.getProdType(o),l=o.idx,u=c.getLookaheadPathsForOptionalProd(l,e,s,t)[0];if(r.isEmpty(r.flatten(u))){var d=n.buildEmptyRepetitionError({topLevelRule:e,repetition:o});a.push({message:d,type:i.ParserDefinitionErrorType.NO_NON_EMPTY_LOOKAHEAD,ruleName:e.name})}})}),a}exports.validateSomeNonEmptyLookaheadPath=I;function L(e,t,a,o){var s=[],l=r.reduce(e,function(t,n,i){return r.forEach(n,function(n){var a=[i];r.forEach(e,function(e,t){i!==t&&c.containsPath(e,n)&&a.push(t)}),a.length>1&&!c.containsPath(s,n)&&(s.push(n),t.push({alts:a,path:n}))}),t},[]);return n.map(l,function(e){var n=r.map(e.alts,function(e){return e+1});return{message:o.buildAlternationAmbiguityError({topLevelRule:a,alternation:t,ambiguityIndices:n,prefixPath:e.path}),type:i.ParserDefinitionErrorType.AMBIGUOUS_ALTS,ruleName:a.name,occurrence:t.idx,alternatives:[e.alts]}})}function ne(e,t,n,a){var o=[],s=r.reduce(e,function(e,t,n){var i=r.map(t,function(e){return{idx:n,path:e}});return e.concat(i)},[]);return r.forEach(s,function(e){var l=e.idx,u=e.path,d=r.findAll(s,function(e){return e.idx<l&&c.isStrictPrefixOfPath(e.path,u)}),f=r.map(d,function(e){var r=[e.idx+1,l+1],o=t.idx===0?``:t.idx;return{message:a.buildAlternationPrefixAmbiguityError({topLevelRule:n,alternation:t,ambiguityIndices:r,prefixPath:e.path}),type:i.ParserDefinitionErrorType.AMBIGUOUS_PREFIX_ALTS,ruleName:n.name,occurrence:o,alternatives:r}});o=o.concat(f)}),o}exports.checkPrefixAlternativesAmbiguities=ne;function re(e,t,n){var a=[],o=r.map(t,function(e){return s.tokenName(e)});return r.forEach(e,function(e){var t=e.name;if(r.contains(o,t)){var s=n.buildNamespaceConflictError(e);a.push({message:s,type:i.ParserDefinitionErrorType.CONFLICT_TOKENS_RULES_NAMESPACE,ruleName:t})}}),a}function ie(e,t){var n=[];return r.forEach(e,function(e){var a=new l.NamedDSLMethodsCollectorVisitor(``);e.accept(a);var o=r.groupBy(a.result,function(e){return e.name}),s=r.pick(o,function(e){return e.length>1});r.forEach(r.values(s),function(a){var o=r.map(a,function(e){return e.orgProd}),s=t.buildDuplicateNestedRuleNameError(e,o);n.push({message:s,type:i.ParserDefinitionErrorType.DUPLICATE_NESTED_NAME,ruleName:e.name})})}),n}})),k=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0}),exports.VERSION=`4.8.1`})),A=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=m(),n=o(),r=o(),i=h(),a=v(),s=O(),c=k(),l=R();exports.defaultParserErrorProvider={buildMismatchTokenMessage:function(e){var n=e.expected,r=e.actual;return e.previous,e.ruleName,`Expecting `+(t.hasTokenLabel(n)?`--> `+t.tokenLabel(n)+` <--`:`token of type --> `+t.tokenName(n)+` <--`)+` but found --> '`+r.image+`' <--`},buildNotAllInputParsedMessage:function(e){var t=e.firstRedundant;return e.ruleName,`Redundant input, expecting EOF but found: `+t.image},buildNoViableAltMessage:function(e){var n=e.expectedPathsPerAlt,i=e.actual;e.previous;var a=e.customUserDescription;e.ruleName;var o=`Expecting: `,s=`
but found: '`+r.first(i).image+`'`;if(a)return o+a+s;var c=r.reduce(n,function(e,t){return e.concat(t)},[]),l=r.map(c,function(e){return`[`+r.map(e,function(e){return t.tokenLabel(e)}).join(`, `)+`]`}),u=`one of these possible Token sequences:
`+r.map(l,function(e,t){return`  `+(t+1)+`. `+e}).join(`
`);return o+u+s},buildEarlyExitMessage:function(e){var n=e.expectedIterationPaths,i=e.actual,a=e.customUserDescription;e.ruleName;var o=`Expecting: `,s=`
but found: '`+r.first(i).image+`'`;if(a)return o+a+s;var c=`expecting at least one iteration which starts with one of these possible Token sequences::
  `+(`<`+r.map(n,function(e){return`[`+r.map(e,function(e){return t.tokenLabel(e)}).join(`,`)+`]`}).join(` ,`)+`>`);return o+c+s}},Object.freeze(exports.defaultParserErrorProvider),exports.defaultGrammarResolverErrorProvider={buildRuleNotFoundError:function(e,t){return`Invalid grammar, reference to a rule which is not defined: ->`+t.nonTerminalName+`<-
inside top level rule: ->`+e.name+`<-`}},exports.defaultGrammarValidatorErrorProvider={buildDuplicateFoundError:function(e,n){function o(e){return e instanceof i.Terminal?t.tokenName(e.terminalType):e instanceof i.NonTerminal?e.nonTerminalName:``}var s=e.name,c=r.first(n),l=c.idx,u=a.getProductionDslName(c),d=o(c),f=`->`+u+`<- with numerical suffix: ->`+l+`<-
                  `+(d?`and argument: ->`+d+`<-`:``)+`
                  appears more than once (`+n.length+` times) in the top level rule: ->`+s+`<-.
                  `+(l===0?`Also note that numerical suffix 0 means `+u+` without any suffix.`:``)+`
                  To fix this make sure each usage of `+u+` `+(d?`with the argument: ->`+d+`<-`:``)+`
                  in the rule ->`+s+`<- has a different occurrence index (0-5), as that combination acts as a unique
                  position key in the grammar, which is needed by the parsing engine.
                  
                  For further details see: https://sap.github.io/chevrotain/docs/FAQ.html#NUMERICAL_SUFFIXES 
                  `;return f=f.replace(/[ \t]+/g,` `),f=f.replace(/\s\s+/g,`
`),f},buildInvalidNestedRuleNameError:function(e,t){return`Invalid nested rule name: ->`+t.name+`<- inside rule: ->`+e.name+`<-
`+(`it must match the pattern: ->`+s.validNestedRuleName.toString()+`<-.
`)+`Note that this means a nested rule name must start with the '$'(dollar) sign.`},buildDuplicateNestedRuleNameError:function(e,t){return`Duplicate nested rule name: ->`+r.first(t).name+`<- inside rule: ->`+e.name+`<-
A nested name must be unique in the scope of a top level grammar rule.`},buildNamespaceConflictError:function(e){return`Namespace conflict found in grammar.
`+(`The grammar has both a Terminal(Token) and a Non-Terminal(Rule) named: <`+e.name+`>.
`)+`To resolve this make sure each Terminal and Non-Terminal names are unique
This is easy to accomplish by using the convention that Terminal names start with an uppercase letter
and Non-Terminal names start with a lower case letter.`},buildAlternationPrefixAmbiguityError:function(e){var n=r.map(e.prefixPath,function(e){return t.tokenLabel(e)}).join(`, `),i=e.alternation.idx===0?``:e.alternation.idx;return`Ambiguous alternatives: <`+e.ambiguityIndices.join(` ,`)+`> due to common lookahead prefix
`+(`in <OR`+i+`> inside <`+e.topLevelRule.name+`> Rule,
`)+(`<`+n+`> may appears as a prefix path in all these alternatives.
`)+`https://sap.github.io/chevrotain/docs/guide/resolving_grammar_errors.html#COMMON_PREFIX
For Further details.`},buildAlternationAmbiguityError:function(e){var n=r.map(e.prefixPath,function(e){return t.tokenLabel(e)}).join(`, `),i=e.alternation.idx===0?``:e.alternation.idx,a=`Ambiguous alternatives: <`+e.ambiguityIndices.join(` ,`)+`> in <OR`+i+`>`+(` inside <`+e.topLevelRule.name+`> Rule,
`)+(`<`+n+`> may appears as a prefix path in all these alternatives.
`),o=c.VERSION.replace(/\./g,`_`);return a=a+`To Resolve this, try one of of the following: 
`+(`1. Refactor your grammar to be LL(K) for the current value of k (by default k=`+l.DEFAULT_PARSER_CONFIG.maxLookahead+`})
`)+`2. Increase the value of K for your grammar by providing a larger 'maxLookahead' value in the parser's config
3. This issue can be ignored (if you know what you are doing...), see https://sap.github.io/chevrotain/documentation/`+o+`/interfaces/iparserconfig.html#ignoredissues for more details
`,a},buildEmptyRepetitionError:function(e){var t=a.getProductionDslName(e.repetition);return e.repetition.idx!==0&&(t+=e.repetition.idx),`The repetition <`+t+`> within Rule <`+e.topLevelRule.name+`> can never consume any tokens.
This could lead to an infinite loop.`},buildTokenNameError:function(e){return`Invalid Grammar Token name: ->`+t.tokenName(e.tokenType)+`<- it must match the pattern: ->`+e.expectedPattern.toString()+`<-`},buildEmptyAlternationError:function(e){return`Ambiguous empty alternative: <`+(e.emptyChoiceIdx+1)+`>`+(` in <OR`+e.alternation.idx+`> inside <`+e.topLevelRule.name+`> Rule.
`)+`Only the last alternative may be an empty alternative.`},buildTooManyAlternativesError:function(e){return`An Alternation cannot have more than 256 alternatives:
`+(`<OR`+e.alternation.idx+`> inside <`+e.topLevelRule.name+`> Rule.
 has `+(e.alternation.definition.length+1)+` alternatives.`)},buildLeftRecursionError:function(e){var t=e.topLevelRule.name,r=n.map(e.leftRecursionPath,function(e){return e.name}),i=t+` --> `+r.concat([t]).join(` --> `);return`Left Recursion found in grammar.
`+(`rule: <`+t+`> can be invoked from itself (directly or indirectly)
`)+(`without consuming any Tokens. The grammar path that causes this is: 
 `+i+`
`)+` To fix this refactor your grammar to remove the left recursion.
see: https://en.wikipedia.org/wiki/LL_parser#Left_Factoring.`},buildInvalidRuleNameError:function(e){var t=e.topLevelRule.name,n=e.expectedPattern.toString();return`Invalid grammar rule name: ->`+t+`<- it must match the pattern: ->`+n+`<-`},buildDuplicateRuleNameError:function(e){return`Duplicate definition, rule: ->`+(e.topLevelRule instanceof i.Rule?e.topLevelRule.name:e.topLevelRule)+`<- is already defined in the grammar: ->`+e.grammarName+`<-`}}})),j=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=R(),r=o(),i=_();function a(e,t){var n=new s(e,t);return n.resolveRefs(),n.errors}exports.resolveGrammar=a;var s=function(e){t(i,e);function i(t,n){var r=e.call(this)||this;return r.nameToTopRule=t,r.errMsgProvider=n,r.errors=[],r}return i.prototype.resolveRefs=function(){var e=this;r.forEach(this.nameToTopRule.values(),function(t){e.currTopLevel=t,t.accept(e)})},i.prototype.visitNonTerminal=function(e){var t=this.nameToTopRule.get(e.nonTerminalName);if(t)e.referencedRule=t;else{var r=this.errMsgProvider.buildRuleNotFoundError(this.currTopLevel,e);this.errors.push({message:r,type:n.ParserDefinitionErrorType.UNRESOLVED_SUBRULE_REF,ruleName:this.currTopLevel.name,unresolvedRefName:e.nonTerminalName})}},i}(i.GAstVisitor);exports.GastRefResolverVisitor=s})),M=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=s(),r=j(),i=O(),a=A(),c=v();function l(e){e=t.defaults(e,{errMsgProvider:a.defaultGrammarResolverErrorProvider});var i=new n.HashTable;return t.forEach(e.rules,function(e){i.put(e.name,e)}),r.resolveGrammar(i,e.errMsgProvider)}exports.resolveGrammar=l;function u(e){return e=t.defaults(e,{errMsgProvider:a.defaultGrammarValidatorErrorProvider,ignoredIssues:{}}),i.validateGrammar(e.rules,e.maxLookahead,e.tokenTypes,e.ignoredIssues,e.errMsgProvider,e.grammarName)}exports.validateGrammar=u;function d(e){t.forEach(e.rules,function(e){var n=new c.DslMethodsCollectorVisitor;e.accept(n),t.forEach(n.dslMethods,function(e){t.forEach(e,function(e,t){e.idx=t+1})})})}exports.assignOccurrenceIndices=d})),N=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=`MismatchedTokenException`,r=`NoViableAltException`,i=`EarlyExitException`,a=`NotAllInputParsedException`,s=[n,r,i,a];Object.freeze(s);function c(e){return t.contains(s,e.name)}exports.isRecognitionException=c;function l(e,t,r){this.name=n,this.message=e,this.token=t,this.previousToken=r,this.resyncedTokens=[]}exports.MismatchedTokenException=l,l.prototype=Error.prototype;function u(e,t,n){this.name=r,this.message=e,this.token=t,this.previousToken=n,this.resyncedTokens=[]}exports.NoViableAltException=u,u.prototype=Error.prototype;function d(e,t){this.name=a,this.message=e,this.token=t,this.resyncedTokens=[]}exports.NotAllInputParsedException=d,d.prototype=Error.prototype;function f(e,t,n){this.name=i,this.message=e,this.token=t,this.previousToken=n,this.resyncedTokens=[]}exports.EarlyExitException=f,f.prototype=Error.prototype})),P=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=m(),n=o(),r=N(),i=b(),a=s(),c=R();exports.EOF_FOLLOW_KEY={},exports.IN_RULE_RECOVERY_EXCEPTION=`InRuleRecoveryException`;function l(t){this.name=exports.IN_RULE_RECOVERY_EXCEPTION,this.message=t}exports.InRuleRecoveryException=l,l.prototype=Error.prototype,exports.Recoverable=function(){function o(){}return o.prototype.initRecoverable=function(e){this.firstAfterRepMap=new a.HashTable,this.resyncFollows=new a.HashTable,this.recoveryEnabled=n.has(e,`recoveryEnabled`)?e.recoveryEnabled:c.DEFAULT_PARSER_CONFIG.recoveryEnabled,this.recoveryEnabled&&(this.attemptInRepetitionRecovery=u)},o.prototype.getTokenToInsert=function(e){var n=t.createTokenInstance(e,``,NaN,NaN,NaN,NaN,NaN,NaN);return n.isInsertedInRecovery=!0,n},o.prototype.canTokenTypeBeInsertedInRecovery=function(e){return!0},o.prototype.tryInRepetitionRecovery=function(e,t,i,a){for(var o=this,s=this.findReSyncTokenType(),c=this.exportLexerState(),l=[],u=!1,d=this.LA(1),f=this.LA(1),p=function(){var e=o.LA(0),t=o.errorMessageProvider.buildMismatchTokenMessage({expected:a,actual:d,previous:e,ruleName:o.getCurrRuleFullName()}),i=new r.MismatchedTokenException(t,d,o.LA(0));i.resyncedTokens=n.dropRight(l),o.SAVE_ERROR(i)};!u;)if(this.tokenMatcher(f,a)){p();return}else if(i.call(this)){p(),e.apply(this,t);return}else this.tokenMatcher(f,s)?u=!0:(f=this.SKIP_TOKEN(),this.addToResyncTokens(f,l));this.importLexerState(c)},o.prototype.shouldInRepetitionRecoveryBeTried=function(e,t,n){return!(n===!1||e===void 0||t===void 0||this.tokenMatcher(this.LA(1),e)||this.isBackTracking()||this.canPerformInRuleRecovery(e,this.getFollowsForInRuleRecovery(e,t)))},o.prototype.getFollowsForInRuleRecovery=function(e,t){var n=this.getCurrentGrammarPath(e,t);return this.getNextPossibleTokenTypes(n)},o.prototype.tryInRuleRecovery=function(e,t){if(this.canRecoverWithSingleTokenInsertion(e,t))return this.getTokenToInsert(e);if(this.canRecoverWithSingleTokenDeletion(e)){var n=this.SKIP_TOKEN();return this.consumeToken(),n}throw new l(`sad sad panda`)},o.prototype.canPerformInRuleRecovery=function(e,t){return this.canRecoverWithSingleTokenInsertion(e,t)||this.canRecoverWithSingleTokenDeletion(e)},o.prototype.canRecoverWithSingleTokenInsertion=function(e,t){var r=this;if(!this.canTokenTypeBeInsertedInRecovery(e)||n.isEmpty(t))return!1;var i=this.LA(1);return n.find(t,function(e){return r.tokenMatcher(i,e)})!==void 0},o.prototype.canRecoverWithSingleTokenDeletion=function(e){return this.tokenMatcher(this.LA(2),e)},o.prototype.isInCurrentRuleReSyncSet=function(e){var t=this.getCurrFollowKey(),r=this.getFollowSetFromFollowKey(t);return n.contains(r,e)},o.prototype.findReSyncTokenType=function(){for(var e=this.flattenFollowSet(),t=this.LA(1),r=2;;){var i=t.tokenType;if(n.contains(e,i))return i;t=this.LA(r),r++}},o.prototype.getCurrFollowKey=function(){if(this.RULE_STACK.length===1)return exports.EOF_FOLLOW_KEY;var t=this.getLastExplicitRuleShortName(),n=this.getLastExplicitRuleOccurrenceIndex(),r=this.getPreviousExplicitRuleShortName();return{ruleName:this.shortRuleNameToFullName(t),idxInCallingRule:n,inRule:this.shortRuleNameToFullName(r)}},o.prototype.buildFullFollowKeyStack=function(){var t=this,r=this.RULE_STACK,i=this.RULE_OCCURRENCE_STACK;return n.isEmpty(this.LAST_EXPLICIT_RULE_STACK)||(r=n.map(this.LAST_EXPLICIT_RULE_STACK,function(e){return t.RULE_STACK[e]}),i=n.map(this.LAST_EXPLICIT_RULE_STACK,function(e){return t.RULE_OCCURRENCE_STACK[e]})),n.map(r,function(n,a){return a===0?exports.EOF_FOLLOW_KEY:{ruleName:t.shortRuleNameToFullName(n),idxInCallingRule:i[a],inRule:t.shortRuleNameToFullName(r[a-1])}})},o.prototype.flattenFollowSet=function(){var e=this,t=n.map(this.buildFullFollowKeyStack(),function(t){return e.getFollowSetFromFollowKey(t)});return n.flatten(t)},o.prototype.getFollowSetFromFollowKey=function(n){if(n===exports.EOF_FOLLOW_KEY)return[t.EOF];var r=n.ruleName+n.idxInCallingRule+i.IN+n.inRule;return this.resyncFollows.get(r)},o.prototype.addToResyncTokens=function(e,n){return this.tokenMatcher(e,t.EOF)||n.push(e),n},o.prototype.reSyncTo=function(e){for(var t=[],r=this.LA(1);this.tokenMatcher(r,e)===!1;)r=this.SKIP_TOKEN(),this.addToResyncTokens(r,t);return n.dropRight(t)},o.prototype.attemptInRepetitionRecovery=function(e,t,n,r,i,a,o){},o.prototype.getCurrentGrammarPath=function(e,t){var r=this.getHumanReadableRuleStack(),i=n.cloneArr(this.RULE_OCCURRENCE_STACK);return{ruleStack:r,occurrenceStack:i,lastTok:e,lastTokOccurrence:t}},o.prototype.getHumanReadableRuleStack=function(){var e=this;return n.isEmpty(this.LAST_EXPLICIT_RULE_STACK)?n.map(this.RULE_STACK,function(t){return e.shortRuleNameToFullName(t)}):n.map(this.LAST_EXPLICIT_RULE_STACK,function(t){return e.shortRuleNameToFullName(e.RULE_STACK[t])})},o}();function u(e,n,r,i,a,o,s){var c=this.getKeyForAutomaticLookahead(i,a),l=this.firstAfterRepMap.get(c);if(l===void 0){var u=this.getCurrRuleFullName(),d=this.getGAstProductions().get(u);l=new o(d,a).startWalking(),this.firstAfterRepMap.put(c,l)}var f=l.token,p=l.occurrence,m=l.isEndOfRule;this.RULE_STACK.length===1&&m&&f===void 0&&(f=t.EOF,p=1),this.shouldInRepetitionRecoveryBeTried(f,p,s)&&this.tryInRepetitionRecovery(e,n,r,f)}exports.attemptInRepetitionRecovery=u})),F=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=D(),n=o(),r=R(),i=w();exports.LooksAhead=function(){function e(){}return e.prototype.initLooksAhead=function(e){this.dynamicTokensEnabled=n.has(e,`dynamicTokensEnabled`)?e.dynamicTokensEnabled:r.DEFAULT_PARSER_CONFIG.dynamicTokensEnabled,this.maxLookahead=n.has(e,`maxLookahead`)?e.maxLookahead:r.DEFAULT_PARSER_CONFIG.maxLookahead,this.lookAheadFuncsCache=n.isES2015MapSupported()?new Map:[],n.isES2015MapSupported()?(this.getLaFuncFromCache=this.getLaFuncFromMap,this.setLaFuncCache=this.setLaFuncCacheUsingMap):(this.getLaFuncFromCache=this.getLaFuncFromObj,this.setLaFuncCache=this.setLaFuncUsingObj)},e.prototype.lookAheadBuilderForOptional=function(e,n,r){return t.buildSingleAlternativeLookaheadFunction(e,n,r)},e.prototype.lookAheadBuilderForAlternatives=function(e,n,r,i){return t.buildAlternativesLookAheadFunc(e,n,r,i)},e.prototype.getKeyForAutomaticLookahead=function(e,t){var n=this.getLastExplicitRuleShortName();return i.getKeyForAutomaticLookahead(n,e,t)},e.prototype.getLookaheadFuncForOr=function(e,r){var a=this.getKeyForAutomaticLookahead(i.OR_IDX,e),o=this.getLaFuncFromCache(a);if(o===void 0){var s=this.getCurrRuleFullName(),c=this.getGAstProductions().get(s),l=n.some(r,function(e){return n.isFunction(e.GATE)});return o=t.buildLookaheadFuncForOr(e,c,this.maxLookahead,l,this.dynamicTokensEnabled,this.lookAheadBuilderForAlternatives),this.setLaFuncCache(a,o),o}else return o},e.prototype.getLookaheadFuncForOption=function(e,n){return this.getLookaheadFuncFor(e,n,this.maxLookahead,t.PROD_TYPE.OPTION)},e.prototype.getLookaheadFuncForMany=function(e,n){return this.getLookaheadFuncFor(e,n,this.maxLookahead,t.PROD_TYPE.REPETITION)},e.prototype.getLookaheadFuncForManySep=function(e,n){return this.getLookaheadFuncFor(e,n,this.maxLookahead,t.PROD_TYPE.REPETITION_WITH_SEPARATOR)},e.prototype.getLookaheadFuncForAtLeastOne=function(e,n){return this.getLookaheadFuncFor(e,n,this.maxLookahead,t.PROD_TYPE.REPETITION_MANDATORY)},e.prototype.getLookaheadFuncForAtLeastOneSep=function(e,n){return this.getLookaheadFuncFor(e,n,this.maxLookahead,t.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR)},e.prototype.getLookaheadFuncFor=function(e,n,r,i){var a=this.getLaFuncFromCache(e);if(a===void 0){var o=this.getCurrRuleFullName(),s=this.getGAstProductions().get(o);return a=t.buildLookaheadFuncForOptionalProd(n,s,r,this.dynamicTokensEnabled,i,this.lookAheadBuilderForOptional),this.setLaFuncCache(e,a),a}else return a},e.prototype.getLaFuncFromCache=function(e){},e.prototype.getLaFuncFromMap=function(e){return this.lookAheadFuncsCache.get(e)},e.prototype.getLaFuncFromObj=function(e){return this.lookAheadFuncsCache[e]},e.prototype.setLaFuncCache=function(e,t){},e.prototype.setLaFuncCacheUsingMap=function(e,t){this.lookAheadFuncsCache.set(e,t)},e.prototype.setLaFuncUsingObj=function(e,t){this.lookAheadFuncsCache[e]=t},e}()})),ee=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=s(),r=O();function i(e,n){for(var r=t.keys(e),i=r.length,a=0;a<i;a++)for(var o=r[a],s=e[o],c=s.length,l=0;l<c;l++){var u=s[l];u.tokenTypeIdx===void 0&&(u.fullName===void 0?this[u.name](u.children,n):this[u.fullName](u.children,n))}}exports.defaultVisit=i;function a(e,r){var i=function(){};return n.defineNameProp(i,e+`BaseSemantics`),i.prototype={visit:function(e,n){if(t.isArray(e)&&(e=e[0]),!t.isUndefined(e))return e.fullName===void 0?this[e.name](e.children,n):this[e.fullName](e.children,n)},validateVisitor:function(){var e=u(this,r);if(!t.isEmpty(e)){var i=t.map(e,function(e){return e.msg});throw Error(`Errors Detected in CST Visitor <`+n.functionName(this.constructor)+`>:
	`+(``+i.join(`

`).replace(/\n/g,`
	`)))}}},i.prototype.constructor=i,i._RULE_NAMES=r,i}exports.createBaseSemanticVisitorConstructor=a;function c(e,r,a){var o=function(){};n.defineNameProp(o,e+`BaseSemanticsWithDefaults`);var s=Object.create(a.prototype);return t.forEach(r,function(e){s[e]=i}),o.prototype=s,o.prototype.constructor=o,o}exports.createBaseVisitorConstructorWithDefaults=c;var l;(function(e){e[e.REDUNDANT_METHOD=0]=`REDUNDANT_METHOD`,e[e.MISSING_METHOD=1]=`MISSING_METHOD`})(l=exports.CstVisitorDefinitionError||={});function u(e,t){var n=d(e,t),r=p(e,t);return n.concat(r)}exports.validateVisitor=u;function d(e,r){var i=t.map(r,function(r){if(!t.isFunction(e[r]))return{msg:`Missing visitor method: <`+r+`> on `+n.functionName(e.constructor)+` CST Visitor.`,type:l.MISSING_METHOD,methodName:r}});return t.compact(i)}exports.validateMissingCstMethods=d;var f=[`constructor`,`visit`,`validateVisitor`];function p(e,i){var a=[];for(var o in e)r.validTermsPattern.test(o)&&t.isFunction(e[o])&&!t.contains(f,o)&&!t.contains(i,o)&&a.push({msg:`Redundant visitor method: <`+o+`> on `+n.functionName(e.constructor)+` CST Visitor
There is no Grammar Rule corresponding to this method's name.
`+(`For utility methods on visitor classes use methods names that do not match /`+r.validTermsPattern.source+`/.`),type:l.REDUNDANT_METHOD,methodName:o});return a}exports.validateRedundantMethods=p})),te=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=T(),n=o(),r=ee(),i=w(),a=R();exports.TreeBuilder=function(){function e(){}return e.prototype.initTreeBuilder=function(e){if(this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.outputCst=n.has(e,`outputCst`)?e.outputCst:a.DEFAULT_PARSER_CONFIG.outputCst,this.nodeLocationTracking=n.has(e,`nodeLocationTracking`)?e.nodeLocationTracking:a.DEFAULT_PARSER_CONFIG.nodeLocationTracking,!this.outputCst)this.cstInvocationStateUpdate=n.NOOP,this.cstFinallyStateUpdate=n.NOOP,this.cstPostTerminal=n.NOOP,this.cstPostNonTerminal=n.NOOP,this.cstPostRule=n.NOOP,this.getLastExplicitRuleShortName=this.getLastExplicitRuleShortNameNoCst,this.getPreviousExplicitRuleShortName=this.getPreviousExplicitRuleShortNameNoCst,this.getLastExplicitRuleOccurrenceIndex=this.getLastExplicitRuleOccurrenceIndexNoCst,this.manyInternal=this.manyInternalNoCst,this.orInternal=this.orInternalNoCst,this.optionInternal=this.optionInternalNoCst,this.atLeastOneInternal=this.atLeastOneInternalNoCst,this.manySepFirstInternal=this.manySepFirstInternalNoCst,this.atLeastOneSepFirstInternal=this.atLeastOneSepFirstInternalNoCst;else if(/full/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=t.setNodeLocationFull,this.setNodeLocationFromNode=t.setNodeLocationFull,this.cstPostRule=n.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationFullRecovery):(this.setNodeLocationFromToken=n.NOOP,this.setNodeLocationFromNode=n.NOOP,this.cstPostRule=this.cstPostRuleFull,this.setInitialNodeLocation=this.setInitialNodeLocationFullRegular);else if(/onlyOffset/i.test(this.nodeLocationTracking))this.recoveryEnabled?(this.setNodeLocationFromToken=t.setNodeLocationOnlyOffset,this.setNodeLocationFromNode=t.setNodeLocationOnlyOffset,this.cstPostRule=n.NOOP,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRecovery):(this.setNodeLocationFromToken=n.NOOP,this.setNodeLocationFromNode=n.NOOP,this.cstPostRule=this.cstPostRuleOnlyOffset,this.setInitialNodeLocation=this.setInitialNodeLocationOnlyOffsetRegular);else if(/none/i.test(this.nodeLocationTracking))this.setNodeLocationFromToken=n.NOOP,this.setNodeLocationFromNode=n.NOOP,this.cstPostRule=n.NOOP,this.setInitialNodeLocation=n.NOOP;else throw Error(`Invalid <nodeLocationTracking> config option: "`+e.nodeLocationTracking+`"`)},e.prototype.setInitialNodeLocationOnlyOffsetRecovery=function(e){e.location={startOffset:NaN,endOffset:NaN}},e.prototype.setInitialNodeLocationOnlyOffsetRegular=function(e){e.location={startOffset:this.LA(1).startOffset,endOffset:NaN}},e.prototype.setInitialNodeLocationFullRecovery=function(e){e.location={startOffset:NaN,startLine:NaN,startColumn:NaN,endOffset:NaN,endLine:NaN,endColumn:NaN}},e.prototype.setInitialNodeLocationFullRegular=function(e){var t=this.LA(1);e.location={startOffset:t.startOffset,startLine:t.startLine,startColumn:t.startColumn,endOffset:NaN,endLine:NaN,endColumn:NaN}},e.prototype.cstNestedInvocationStateUpdate=function(e,t){var n={name:e,fullName:this.shortRuleNameToFull.get(this.getLastExplicitRuleShortName())+e,children:{}};this.setInitialNodeLocation(n),this.CST_STACK.push(n)},e.prototype.cstInvocationStateUpdate=function(e,t){this.LAST_EXPLICIT_RULE_STACK.push(this.RULE_STACK.length-1);var n={name:e,children:{}};this.setInitialNodeLocation(n),this.CST_STACK.push(n)},e.prototype.cstFinallyStateUpdate=function(){this.LAST_EXPLICIT_RULE_STACK.pop(),this.CST_STACK.pop()},e.prototype.cstNestedFinallyStateUpdate=function(){var e=this.CST_STACK.pop();this.cstPostRule(e)},e.prototype.cstPostRuleFull=function(e){var t=this.LA(0),n=e.location;n.startOffset<=t.startOffset?(n.endOffset=t.endOffset,n.endLine=t.endLine,n.endColumn=t.endColumn):(n.startOffset=NaN,n.startLine=NaN,n.startColumn=NaN)},e.prototype.cstPostRuleOnlyOffset=function(e){var t=this.LA(0),n=e.location;n.startOffset<=t.startOffset?n.endOffset=t.endOffset:n.startOffset=NaN},e.prototype.cstPostTerminal=function(e,n){var r=this.CST_STACK[this.CST_STACK.length-1];t.addTerminalToCst(r,n,e),this.setNodeLocationFromToken(r.location,n)},e.prototype.cstPostNonTerminal=function(e,n){var r=this.CST_STACK[this.CST_STACK.length-1];t.addNoneTerminalToCst(r,n,e),this.setNodeLocationFromNode(r.location,e.location)},e.prototype.getBaseCstVisitorConstructor=function(){if(n.isUndefined(this.baseCstVisitorConstructor)){var e=r.createBaseSemanticVisitorConstructor(this.className,this.allRuleNames);return this.baseCstVisitorConstructor=e,e}return this.baseCstVisitorConstructor},e.prototype.getBaseCstVisitorConstructorWithDefaults=function(){if(n.isUndefined(this.baseCstVisitorWithDefaultsConstructor)){var e=r.createBaseVisitorConstructorWithDefaults(this.className,this.allRuleNames,this.getBaseCstVisitorConstructor());return this.baseCstVisitorWithDefaultsConstructor=e,e}return this.baseCstVisitorWithDefaultsConstructor},e.prototype.nestedRuleBeforeClause=function(e,t){var n;if(e.NAME!==void 0)return n=e.NAME,this.nestedRuleInvocationStateUpdate(n,t),n},e.prototype.nestedAltBeforeClause=function(e,t,n,r){var a=this.getLastExplicitRuleShortName(),o=i.getKeyForAltIndex(a,n,t,r),s;if(e.NAME!==void 0)return s=e.NAME,this.nestedRuleInvocationStateUpdate(s,o),{shortName:o,nestedName:s}},e.prototype.nestedRuleFinallyClause=function(e,n){var r=this.CST_STACK,i=r[r.length-1];this.nestedRuleFinallyStateUpdate();var a=r[r.length-1];t.addNoneTerminalToCst(a,n,i),this.setNodeLocationFromNode(a.location,i.location)},e.prototype.getLastExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_STACK[e]},e.prototype.getLastExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-1]},e.prototype.getPreviousExplicitRuleShortName=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-2];return this.RULE_STACK[e]},e.prototype.getPreviousExplicitRuleShortNameNoCst=function(){var e=this.RULE_STACK;return e[e.length-2]},e.prototype.getLastExplicitRuleOccurrenceIndex=function(){var e=this.LAST_EXPLICIT_RULE_STACK[this.LAST_EXPLICIT_RULE_STACK.length-1];return this.RULE_OCCURRENCE_STACK[e]},e.prototype.getLastExplicitRuleOccurrenceIndexNoCst=function(){var e=this.RULE_OCCURRENCE_STACK;return e[e.length-1]},e.prototype.nestedRuleInvocationStateUpdate=function(e,t){this.RULE_OCCURRENCE_STACK.push(1),this.RULE_STACK.push(t),this.cstNestedInvocationStateUpdate(e,t)},e.prototype.nestedRuleFinallyStateUpdate=function(){this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstNestedFinallyStateUpdate()},e}()})),I=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=R();exports.LexerAdapter=function(){function e(){}return e.prototype.initLexerAdapter=function(){this.tokVector=[],this.tokVectorLength=0,this.currIdx=-1},Object.defineProperty(e.prototype,`input`,{get:function(){return this.tokVector},set:function(e){this.reset(),this.tokVector=e,this.tokVectorLength=e.length},enumerable:!0,configurable:!0}),e.prototype.SKIP_TOKEN=function(){return this.currIdx<=this.tokVector.length-2?(this.consumeToken(),this.LA(1)):t.END_OF_FILE},e.prototype.LA=function(e){return this.currIdx+e<0||this.tokVectorLength<=this.currIdx+e?t.END_OF_FILE:this.tokVector[this.currIdx+e]},e.prototype.consumeToken=function(){this.currIdx++},e.prototype.exportLexerState=function(){return this.currIdx},e.prototype.importLexerState=function(e){this.currIdx=e},e.prototype.resetLexerState=function(){this.currIdx=-1},e.prototype.moveToTerminatedState=function(){this.currIdx=this.tokVector.length-1},e.prototype.getLexerPosition=function(){return this.exportLexerState()},e}()})),L=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=N(),r=R(),i=A(),a=C(),s=O(),c=h();exports.RecognizerApi=function(){function e(){}return e.prototype.CONSUME=function(e,t){return this.consumeInternal(e,0,t)},e.prototype.CONSUME1=function(e,t){return this.consumeInternal(e,1,t)},e.prototype.CONSUME2=function(e,t){return this.consumeInternal(e,2,t)},e.prototype.CONSUME3=function(e,t){return this.consumeInternal(e,3,t)},e.prototype.CONSUME4=function(e,t){return this.consumeInternal(e,4,t)},e.prototype.CONSUME5=function(e,t){return this.consumeInternal(e,5,t)},e.prototype.CONSUME6=function(e,t){return this.consumeInternal(e,6,t)},e.prototype.CONSUME7=function(e,t){return this.consumeInternal(e,7,t)},e.prototype.CONSUME8=function(e,t){return this.consumeInternal(e,8,t)},e.prototype.CONSUME9=function(e,t){return this.consumeInternal(e,9,t)},e.prototype.SUBRULE=function(e,t){return this.subruleInternal(e,0,t)},e.prototype.SUBRULE1=function(e,t){return this.subruleInternal(e,1,t)},e.prototype.SUBRULE2=function(e,t){return this.subruleInternal(e,2,t)},e.prototype.SUBRULE3=function(e,t){return this.subruleInternal(e,3,t)},e.prototype.SUBRULE4=function(e,t){return this.subruleInternal(e,4,t)},e.prototype.SUBRULE5=function(e,t){return this.subruleInternal(e,5,t)},e.prototype.SUBRULE6=function(e,t){return this.subruleInternal(e,6,t)},e.prototype.SUBRULE7=function(e,t){return this.subruleInternal(e,7,t)},e.prototype.SUBRULE8=function(e,t){return this.subruleInternal(e,8,t)},e.prototype.SUBRULE9=function(e,t){return this.subruleInternal(e,9,t)},e.prototype.OPTION=function(e){return this.optionInternal(e,0)},e.prototype.OPTION1=function(e){return this.optionInternal(e,1)},e.prototype.OPTION2=function(e){return this.optionInternal(e,2)},e.prototype.OPTION3=function(e){return this.optionInternal(e,3)},e.prototype.OPTION4=function(e){return this.optionInternal(e,4)},e.prototype.OPTION5=function(e){return this.optionInternal(e,5)},e.prototype.OPTION6=function(e){return this.optionInternal(e,6)},e.prototype.OPTION7=function(e){return this.optionInternal(e,7)},e.prototype.OPTION8=function(e){return this.optionInternal(e,8)},e.prototype.OPTION9=function(e){return this.optionInternal(e,9)},e.prototype.OR=function(e){return this.orInternal(e,0)},e.prototype.OR1=function(e){return this.orInternal(e,1)},e.prototype.OR2=function(e){return this.orInternal(e,2)},e.prototype.OR3=function(e){return this.orInternal(e,3)},e.prototype.OR4=function(e){return this.orInternal(e,4)},e.prototype.OR5=function(e){return this.orInternal(e,5)},e.prototype.OR6=function(e){return this.orInternal(e,6)},e.prototype.OR7=function(e){return this.orInternal(e,7)},e.prototype.OR8=function(e){return this.orInternal(e,8)},e.prototype.OR9=function(e){return this.orInternal(e,9)},e.prototype.MANY=function(e){this.manyInternal(0,e)},e.prototype.MANY1=function(e){this.manyInternal(1,e)},e.prototype.MANY2=function(e){this.manyInternal(2,e)},e.prototype.MANY3=function(e){this.manyInternal(3,e)},e.prototype.MANY4=function(e){this.manyInternal(4,e)},e.prototype.MANY5=function(e){this.manyInternal(5,e)},e.prototype.MANY6=function(e){this.manyInternal(6,e)},e.prototype.MANY7=function(e){this.manyInternal(7,e)},e.prototype.MANY8=function(e){this.manyInternal(8,e)},e.prototype.MANY9=function(e){this.manyInternal(9,e)},e.prototype.MANY_SEP=function(e){this.manySepFirstInternal(0,e)},e.prototype.MANY_SEP1=function(e){this.manySepFirstInternal(1,e)},e.prototype.MANY_SEP2=function(e){this.manySepFirstInternal(2,e)},e.prototype.MANY_SEP3=function(e){this.manySepFirstInternal(3,e)},e.prototype.MANY_SEP4=function(e){this.manySepFirstInternal(4,e)},e.prototype.MANY_SEP5=function(e){this.manySepFirstInternal(5,e)},e.prototype.MANY_SEP6=function(e){this.manySepFirstInternal(6,e)},e.prototype.MANY_SEP7=function(e){this.manySepFirstInternal(7,e)},e.prototype.MANY_SEP8=function(e){this.manySepFirstInternal(8,e)},e.prototype.MANY_SEP9=function(e){this.manySepFirstInternal(9,e)},e.prototype.AT_LEAST_ONE=function(e){this.atLeastOneInternal(0,e)},e.prototype.AT_LEAST_ONE1=function(e){return this.atLeastOneInternal(1,e)},e.prototype.AT_LEAST_ONE2=function(e){this.atLeastOneInternal(2,e)},e.prototype.AT_LEAST_ONE3=function(e){this.atLeastOneInternal(3,e)},e.prototype.AT_LEAST_ONE4=function(e){this.atLeastOneInternal(4,e)},e.prototype.AT_LEAST_ONE5=function(e){this.atLeastOneInternal(5,e)},e.prototype.AT_LEAST_ONE6=function(e){this.atLeastOneInternal(6,e)},e.prototype.AT_LEAST_ONE7=function(e){this.atLeastOneInternal(7,e)},e.prototype.AT_LEAST_ONE8=function(e){this.atLeastOneInternal(8,e)},e.prototype.AT_LEAST_ONE9=function(e){this.atLeastOneInternal(9,e)},e.prototype.AT_LEAST_ONE_SEP=function(e){this.atLeastOneSepFirstInternal(0,e)},e.prototype.AT_LEAST_ONE_SEP1=function(e){this.atLeastOneSepFirstInternal(1,e)},e.prototype.AT_LEAST_ONE_SEP2=function(e){this.atLeastOneSepFirstInternal(2,e)},e.prototype.AT_LEAST_ONE_SEP3=function(e){this.atLeastOneSepFirstInternal(3,e)},e.prototype.AT_LEAST_ONE_SEP4=function(e){this.atLeastOneSepFirstInternal(4,e)},e.prototype.AT_LEAST_ONE_SEP5=function(e){this.atLeastOneSepFirstInternal(5,e)},e.prototype.AT_LEAST_ONE_SEP6=function(e){this.atLeastOneSepFirstInternal(6,e)},e.prototype.AT_LEAST_ONE_SEP7=function(e){this.atLeastOneSepFirstInternal(7,e)},e.prototype.AT_LEAST_ONE_SEP8=function(e){this.atLeastOneSepFirstInternal(8,e)},e.prototype.AT_LEAST_ONE_SEP9=function(e){this.atLeastOneSepFirstInternal(9,e)},e.prototype.RULE=function(e,n,o){if(o===void 0&&(o=r.DEFAULT_RULE_CONFIG),t.contains(this.definedRulesNames,e)){var s={message:i.defaultGrammarValidatorErrorProvider.buildDuplicateRuleNameError({topLevelRule:e,grammarName:this.className}),type:r.ParserDefinitionErrorType.DUPLICATE_RULE_NAME,ruleName:e};this.definitionErrors.push(s)}if(this.definedRulesNames.push(e),!this.gastProductionsCache.containsKey(e)&&!this.serializedGrammar){var c=a.buildTopProduction(n.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,c)}var l=this.defineRule(e,n,o);return this[e]=l,l},e.prototype.OVERRIDE_RULE=function(e,t,n){n===void 0&&(n=r.DEFAULT_RULE_CONFIG);var i=[];if(i=i.concat(s.validateRuleIsOverridden(e,this.definedRulesNames,this.className)),this.definitionErrors.push.apply(this.definitionErrors,i),!this.serializedGrammar){var o=a.buildTopProduction(t.toString(),e,this.tokensMap);this.gastProductionsCache.put(e,o)}var c=this.defineRule(e,t,n);return this[e]=c,c},e.prototype.BACKTRACK=function(e,t){return function(){this.isBackTrackingStack.push(1);var r=this.saveRecogState();try{return e.apply(this,t),!0}catch(e){if(n.isRecognitionException(e))return!1;throw e}finally{this.reloadRecogState(r),this.isBackTrackingStack.pop()}}},e.prototype.getGAstProductions=function(){return this.gastProductionsCache},e.prototype.getSerializedGastProductions=function(){return c.serializeGrammar(this.gastProductionsCache.values())},e}()})),ne=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=w(),r=N(),i=D(),a=E(),c=R(),l=P(),u=m(),f=d(),p=s();exports.RecognizerEngine=function(){function e(){}return e.prototype.initRecognizerEngine=function(e,n){if(this.className=p.classNameFromInstance(this),this.shortRuleNameToFull=new p.HashTable,this.fullRuleNameToShort=new p.HashTable,this.ruleShortNameIdx=256,this.tokenMatcher=f.tokenStructuredMatcherNoCategories,this.definedRulesNames=[],this.tokensMap={},this.allRuleNames=[],this.isBackTrackingStack=[],this.RULE_STACK=[],this.RULE_OCCURRENCE_STACK=[],this.gastProductionsCache=new p.HashTable,this.serializedGrammar=t.has(n,`serializedGrammar`)?n.serializedGrammar:c.DEFAULT_PARSER_CONFIG.serializedGrammar,t.isArray(e)){if(t.isEmpty(e))throw Error(`A Token Vocabulary cannot be empty.
	Note that the first argument for the parser constructor
	is no longer a Token vector (since v4.0).`);if(typeof e[0].startOffset==`number`)throw Error(`The Parser constructor no longer accepts a token vector as the first argument.
	See: https://sap.github.io/chevrotain/docs/changes/BREAKING_CHANGES.html#_4-0-0
	For Further details.`)}if(t.isArray(e))this.tokensMap=t.reduce(e,function(e,t){return e[u.tokenName(t)]=t,e},{});else if(t.has(e,`modes`)&&t.every(t.flatten(t.values(e.modes)),f.isTokenType)){var r=t.flatten(t.values(e.modes)),i=t.uniq(r);this.tokensMap=t.reduce(i,function(e,t){return e[u.tokenName(t)]=t,e},{})}else if(t.isObject(e))this.tokensMap=t.cloneObj(e);else throw Error(`<tokensDictionary> argument must be An Array of Token constructors, A dictionary of Token constructors or an IMultiModeLexerDefinition`);this.tokensMap.EOF=u.EOF,this.tokenMatcher=t.every(t.values(e),function(e){return t.isEmpty(e.categoryMatches)})?f.tokenStructuredMatcherNoCategories:f.tokenStructuredMatcher,f.augmentTokenTypes(t.values(this.tokensMap))},e.prototype.defineRule=function(e,i,a){if(this.selfAnalysisDone)throw Error(`Grammar rule <`+e+`> may not be defined after the 'performSelfAnalysis' method has been called'
Make sure that all grammar rule definitions are done before 'performSelfAnalysis' is called.`);var o=t.has(a,`resyncEnabled`)?a.resyncEnabled:c.DEFAULT_RULE_CONFIG.resyncEnabled,s=t.has(a,`recoveryValueFunc`)?a.recoveryValueFunc:c.DEFAULT_RULE_CONFIG.recoveryValueFunc,l=this.ruleShortNameIdx<<n.BITS_FOR_METHOD_IDX+n.BITS_FOR_OCCURRENCE_IDX;this.ruleShortNameIdx++,this.shortRuleNameToFull.put(l,e),this.fullRuleNameToShort.put(e,l);function u(e){try{if(this.outputCst===!0){i.apply(this,e);var t=this.CST_STACK[this.CST_STACK.length-1];return this.cstPostRule(t),t}else return i.apply(this,e)}catch(e){var n=this.RULE_STACK.length===1,a=o&&!this.isBackTracking()&&this.recoveryEnabled;if(r.isRecognitionException(e))if(a){var c=this.findReSyncTokenType();if(this.isInCurrentRuleReSyncSet(c))if(e.resyncedTokens=this.reSyncTo(c),this.outputCst){var l=this.CST_STACK[this.CST_STACK.length-1];return l.recoveredNode=!0,l}else return s();else{if(this.outputCst){var l=this.CST_STACK[this.CST_STACK.length-1];l.recoveredNode=!0,e.partialCstResult=l}throw e}}else if(n)return this.moveToTerminatedState(),s();else throw e;else throw e}finally{this.ruleFinallyStateUpdate()}}var d=function(t,n){return t===void 0&&(t=0),this.ruleInvocationStateUpdate(l,e,t),u.call(this,n)},f=`ruleName`;return d[f]=e,d},e.prototype.optionInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.OPTION_IDX,t),i=this.nestedRuleBeforeClause(e,r);try{return this.optionInternalLogic(e,t,r)}finally{i!==void 0&&this.nestedRuleFinallyClause(r,i)}},e.prototype.optionInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(n.OPTION_IDX,t);return this.optionInternalLogic(e,t,r)},e.prototype.optionInternalLogic=function(e,t,n){var r=this,i=this.getLookaheadFuncForOption(n,t),a,o;if(e.DEF!==void 0){if(a=e.DEF,o=e.GATE,o!==void 0){var s=i;i=function(){return o.call(r)&&s.call(r)}}}else a=e;if(i.call(this)===!0)return a.call(this)},e.prototype.atLeastOneInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.AT_LEAST_ONE_IDX,e),i=this.nestedRuleBeforeClause(t,r);try{return this.atLeastOneInternalLogic(e,t,r)}finally{i!==void 0&&this.nestedRuleFinallyClause(r,i)}},e.prototype.atLeastOneInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(n.AT_LEAST_ONE_IDX,e);this.atLeastOneInternalLogic(e,t,r)},e.prototype.atLeastOneInternalLogic=function(e,t,r){var o=this,s=this.getLookaheadFuncForAtLeastOne(r,e),c,l;if(t.DEF!==void 0){if(c=t.DEF,l=t.GATE,l!==void 0){var u=s;s=function(){return l.call(o)&&u.call(o)}}}else c=t;if(s.call(this)===!0)for(var d=this.doSingleRepetition(c);s.call(this)===!0&&d===!0;)d=this.doSingleRepetition(c);else throw this.raiseEarlyExitException(e,i.PROD_TYPE.REPETITION_MANDATORY,t.ERR_MSG);this.attemptInRepetitionRecovery(this.atLeastOneInternal,[e,t],s,n.AT_LEAST_ONE_IDX,e,a.NextTerminalAfterAtLeastOneWalker)},e.prototype.atLeastOneSepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.AT_LEAST_ONE_SEP_IDX,e),i=this.nestedRuleBeforeClause(t,r);try{this.atLeastOneSepFirstInternalLogic(e,t,r)}finally{i!==void 0&&this.nestedRuleFinallyClause(r,i)}},e.prototype.atLeastOneSepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(n.AT_LEAST_ONE_SEP_IDX,e);this.atLeastOneSepFirstInternalLogic(e,t,r)},e.prototype.atLeastOneSepFirstInternalLogic=function(e,t,r){var o=this,s=t.DEF,c=t.SEP;if(this.getLookaheadFuncForAtLeastOneSep(r,e).call(this)===!0){s.call(this);for(var l=function(){return o.tokenMatcher(o.LA(1),c)};this.tokenMatcher(this.LA(1),c)===!0;)this.CONSUME(c),s.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,c,l,s,a.NextTerminalAfterAtLeastOneSepWalker],l,n.AT_LEAST_ONE_SEP_IDX,e,a.NextTerminalAfterAtLeastOneSepWalker)}else throw this.raiseEarlyExitException(e,i.PROD_TYPE.REPETITION_MANDATORY_WITH_SEPARATOR,t.ERR_MSG)},e.prototype.manyInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.MANY_IDX,e),i=this.nestedRuleBeforeClause(t,r);try{return this.manyInternalLogic(e,t,r)}finally{i!==void 0&&this.nestedRuleFinallyClause(r,i)}},e.prototype.manyInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(n.MANY_IDX,e);return this.manyInternalLogic(e,t,r)},e.prototype.manyInternalLogic=function(e,t,r){var i=this,o=this.getLookaheadFuncForMany(r,e),s,c;if(t.DEF!==void 0){if(s=t.DEF,c=t.GATE,c!==void 0){var l=o;o=function(){return c.call(i)&&l.call(i)}}}else s=t;for(var u=!0;o.call(this)===!0&&u===!0;)u=this.doSingleRepetition(s);this.attemptInRepetitionRecovery(this.manyInternal,[e,t],o,n.MANY_IDX,e,a.NextTerminalAfterManyWalker,u)},e.prototype.manySepFirstInternal=function(e,t){var r=this.getKeyForAutomaticLookahead(n.MANY_SEP_IDX,e),i=this.nestedRuleBeforeClause(t,r);try{this.manySepFirstInternalLogic(e,t,r)}finally{i!==void 0&&this.nestedRuleFinallyClause(r,i)}},e.prototype.manySepFirstInternalNoCst=function(e,t){var r=this.getKeyForAutomaticLookahead(n.MANY_SEP_IDX,e);this.manySepFirstInternalLogic(e,t,r)},e.prototype.manySepFirstInternalLogic=function(e,t,r){var i=this,o=t.DEF,s=t.SEP;if(this.getLookaheadFuncForManySep(r,e).call(this)===!0){o.call(this);for(var c=function(){return i.tokenMatcher(i.LA(1),s)};this.tokenMatcher(this.LA(1),s)===!0;)this.CONSUME(s),o.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,s,c,o,a.NextTerminalAfterManySepWalker],c,n.MANY_SEP_IDX,e,a.NextTerminalAfterManySepWalker)}},e.prototype.repetitionSepSecondInternal=function(e,t,r,i,a){for(;r();)this.CONSUME(t),i.call(this);this.attemptInRepetitionRecovery(this.repetitionSepSecondInternal,[e,t,r,i,a],r,n.AT_LEAST_ONE_SEP_IDX,e,a)},e.prototype.doSingleRepetition=function(e){var t=this.getLexerPosition();return e.call(this),this.getLexerPosition()>t},e.prototype.orInternalNoCst=function(e,n){var r=t.isArray(e)?e:e.DEF,i=this.getLookaheadFuncForOr(n,r).call(this,r);if(i!==void 0)return r[i].ALT.call(this);this.raiseNoAltException(n,e.ERR_MSG)},e.prototype.orInternal=function(e,r){var i=this.getKeyForAutomaticLookahead(n.OR_IDX,r),a=this.nestedRuleBeforeClause(e,i);try{var o=t.isArray(e)?e:e.DEF,s=this.getLookaheadFuncForOr(r,o).call(this,o);if(s!==void 0){var c=o[s],l=this.nestedAltBeforeClause(c,r,n.OR_IDX,s);try{return c.ALT.call(this)}finally{l!==void 0&&this.nestedRuleFinallyClause(l.shortName,l.nestedName)}}this.raiseNoAltException(r,e.ERR_MSG)}finally{a!==void 0&&this.nestedRuleFinallyClause(i,a)}},e.prototype.ruleFinallyStateUpdate=function(){if(this.RULE_STACK.pop(),this.RULE_OCCURRENCE_STACK.pop(),this.cstFinallyStateUpdate(),this.RULE_STACK.length===0&&!this.isAtEndOfInput()){var e=this.LA(1),t=this.errorMessageProvider.buildNotAllInputParsedMessage({firstRedundant:e,ruleName:this.getCurrRuleFullName()});this.SAVE_ERROR(new r.NotAllInputParsedException(t,e))}},e.prototype.subruleInternal=function(e,t,n){var i;try{var a=n===void 0?void 0:n.ARGS;return i=e.call(this,t,a),this.cstPostNonTerminal(i,n!==void 0&&n.LABEL!==void 0?n.LABEL:e.ruleName),i}catch(t){throw r.isRecognitionException(t)&&t.partialCstResult!==void 0&&(this.cstPostNonTerminal(t.partialCstResult,n!==void 0&&n.LABEL!==void 0?n.LABEL:e.ruleName),delete t.partialCstResult),t}},e.prototype.consumeInternal=function(e,t,n){var i;try{var a=this.LA(1);if(this.tokenMatcher(a,e)===!0)this.consumeToken(),i=a;else{var o=void 0,s=this.LA(0);throw o=n!==void 0&&n.ERR_MSG?n.ERR_MSG:this.errorMessageProvider.buildMismatchTokenMessage({expected:e,actual:a,previous:s,ruleName:this.getCurrRuleFullName()}),this.SAVE_ERROR(new r.MismatchedTokenException(o,a,s))}}catch(n){if(this.recoveryEnabled&&n.name===`MismatchedTokenException`&&!this.isBackTracking()){var c=this.getFollowsForInRuleRecovery(e,t);try{i=this.tryInRuleRecovery(e,c)}catch(e){throw e.name===l.IN_RULE_RECOVERY_EXCEPTION?n:e}}else throw n}return this.cstPostTerminal(n!==void 0&&n.LABEL!==void 0?n.LABEL:e.tokenName,i),i},e.prototype.saveRecogState=function(){var e=this.errors,n=t.cloneArr(this.RULE_STACK);return{errors:e,lexerState:this.exportLexerState(),RULE_STACK:n,CST_STACK:this.CST_STACK,LAST_EXPLICIT_RULE_STACK:this.LAST_EXPLICIT_RULE_STACK}},e.prototype.reloadRecogState=function(e){this.errors=e.errors,this.importLexerState(e.lexerState),this.RULE_STACK=e.RULE_STACK},e.prototype.ruleInvocationStateUpdate=function(e,t,n){this.RULE_OCCURRENCE_STACK.push(n),this.RULE_STACK.push(e),this.cstInvocationStateUpdate(t,e)},e.prototype.isBackTracking=function(){return!t.isEmpty(this.isBackTrackingStack)},e.prototype.getCurrRuleFullName=function(){var e=this.getLastExplicitRuleShortName();return this.shortRuleNameToFull.get(e)},e.prototype.shortRuleNameToFullName=function(e){return this.shortRuleNameToFull.get(e)},e.prototype.isAtEndOfInput=function(){return this.tokenMatcher(this.LA(1),u.EOF)},e.prototype.reset=function(){this.resetLexerState(),this.isBackTrackingStack=[],this.errors=[],this.RULE_STACK=[],this.LAST_EXPLICIT_RULE_STACK=[],this.CST_STACK=[],this.RULE_OCCURRENCE_STACK=[]},e}()})),re=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=N(),n=o(),r=D(),i=R();exports.ErrorHandler=function(){function e(){}return e.prototype.initErrorHandler=function(e){this._errors=[],this.errorMessageProvider=n.defaults(e.errorMessageProvider,i.DEFAULT_PARSER_CONFIG.errorMessageProvider)},e.prototype.SAVE_ERROR=function(e){if(t.isRecognitionException(e))return e.context={ruleStack:this.getHumanReadableRuleStack(),ruleOccurrenceStack:n.cloneArr(this.RULE_OCCURRENCE_STACK)},this._errors.push(e),e;throw Error(`Trying to save an Error which is not a RecognitionException`)},Object.defineProperty(e.prototype,`errors`,{get:function(){return n.cloneArr(this._errors)},set:function(e){this._errors=e},enumerable:!0,configurable:!0}),e.prototype.raiseEarlyExitException=function(e,n,i){for(var a=this.getCurrRuleFullName(),o=this.getGAstProductions().get(a),s=r.getLookaheadPathsForOptionalProd(e,o,n,this.maxLookahead)[0],c=[],l=1;l<this.maxLookahead;l++)c.push(this.LA(l));var u=this.errorMessageProvider.buildEarlyExitMessage({expectedIterationPaths:s,actual:c,previous:this.LA(0),customUserDescription:i,ruleName:a});throw this.SAVE_ERROR(new t.EarlyExitException(u,this.LA(1),this.LA(0)))},e.prototype.raiseNoAltException=function(e,n){for(var i=this.getCurrRuleFullName(),a=this.getGAstProductions().get(i),o=r.getLookaheadPathsForOr(e,a,this.maxLookahead),s=[],c=1;c<=this.maxLookahead;c++)s.push(this.LA(c));var l=this.LA(0),u=this.errorMessageProvider.buildNoViableAltMessage({expectedPathsPerAlt:o,actual:s,previous:l,customUserDescription:n,ruleName:this.getCurrRuleFullName()});throw this.SAVE_ERROR(new t.NoViableAltException(u,this.LA(1),l))},e}()})),ie=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=E(),n=o();exports.ContentAssist=function(){function e(){}return e.prototype.initContentAssist=function(){},e.prototype.computeContentAssist=function(e,r){var i=this.gastProductionsCache.get(e);if(n.isUndefined(i))throw Error(`Rule ->`+e+`<- does not exist in this grammar.`);return t.nextPossibleTokensAfter([i],r,this.tokenMatcher,this.maxLookahead)},e.prototype.getNextPossibleTokenTypes=function(e){var r=n.first(e.ruleStack),i=this.getGAstProductions().get(r);return new t.NextAfterTokenWalker(i,e).startWalking()},e}()})),R=t((exports=>{var t=exports&&exports.__extends||(function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},e(t,n)};return function(t,n){e(t,n);function r(){this.constructor=t}t.prototype=n===null?Object.create(n):(r.prototype=n.prototype,new r)}})();Object.defineProperty(exports,`__esModule`,{value:!0});var n=s(),r=o(),i=x(),a=m(),c=C(),l=T(),u=A(),d=M(),f=P(),p=F(),h=te(),g=I(),_=L(),v=ne(),y=re(),b=ie();exports.END_OF_FILE=a.createTokenInstance(a.EOF,``,NaN,NaN,NaN,NaN,NaN,NaN),Object.freeze(exports.END_OF_FILE),exports.DEFAULT_PARSER_CONFIG=Object.freeze({recoveryEnabled:!1,maxLookahead:4,ignoredIssues:{},dynamicTokensEnabled:!1,outputCst:!0,errorMessageProvider:u.defaultParserErrorProvider,serializedGrammar:null,nodeLocationTracking:`none`}),exports.DEFAULT_RULE_CONFIG=Object.freeze({recoveryValueFunc:function(){},resyncEnabled:!0}),(function(e){e[e.INVALID_RULE_NAME=0]=`INVALID_RULE_NAME`,e[e.DUPLICATE_RULE_NAME=1]=`DUPLICATE_RULE_NAME`,e[e.INVALID_RULE_OVERRIDE=2]=`INVALID_RULE_OVERRIDE`,e[e.DUPLICATE_PRODUCTIONS=3]=`DUPLICATE_PRODUCTIONS`,e[e.UNRESOLVED_SUBRULE_REF=4]=`UNRESOLVED_SUBRULE_REF`,e[e.LEFT_RECURSION=5]=`LEFT_RECURSION`,e[e.NONE_LAST_EMPTY_ALT=6]=`NONE_LAST_EMPTY_ALT`,e[e.AMBIGUOUS_ALTS=7]=`AMBIGUOUS_ALTS`,e[e.CONFLICT_TOKENS_RULES_NAMESPACE=8]=`CONFLICT_TOKENS_RULES_NAMESPACE`,e[e.INVALID_TOKEN_NAME=9]=`INVALID_TOKEN_NAME`,e[e.INVALID_NESTED_RULE_NAME=10]=`INVALID_NESTED_RULE_NAME`,e[e.DUPLICATE_NESTED_NAME=11]=`DUPLICATE_NESTED_NAME`,e[e.NO_NON_EMPTY_LOOKAHEAD=12]=`NO_NON_EMPTY_LOOKAHEAD`,e[e.AMBIGUOUS_PREFIX_ALTS=13]=`AMBIGUOUS_PREFIX_ALTS`,e[e.TOO_MANY_ALTS=14]=`TOO_MANY_ALTS`})(exports.ParserDefinitionErrorType||={});function S(e){return e===void 0&&(e=void 0),function(){return e}}exports.EMPTY_ALT=S;var w=function(){function t(t,n){n===void 0&&(n=exports.DEFAULT_PARSER_CONFIG),this.ignoredIssues=exports.DEFAULT_PARSER_CONFIG.ignoredIssues,this.definitionErrors=[],this.selfAnalysisDone=!1;var i=this;i.initErrorHandler(n),i.initLexerAdapter(),i.initLooksAhead(n),i.initRecognizerEngine(t,n),i.initRecoverable(n),i.initTreeBuilder(n),i.initContentAssist(),this.ignoredIssues=r.has(n,`ignoredIssues`)?n.ignoredIssues:exports.DEFAULT_PARSER_CONFIG.ignoredIssues,r.toFastProperties(this)}return t.performSelfAnalysis=function(e){e.performSelfAnalysis()},t.prototype.performSelfAnalysis=function(){var e=this,a;this.selfAnalysisDone=!0;var o=n.classNameFromInstance(this),s=this.gastProductionsCache;if(this.serializedGrammar){var f=c.deserializeGrammar(this.serializedGrammar,this.tokensMap);r.forEach(f,function(t){e.gastProductionsCache.put(t.name,t)})}var p=d.resolveGrammar({rules:s.values()});if(this.definitionErrors.push.apply(this.definitionErrors,p),r.isEmpty(p)){var m=d.validateGrammar({rules:s.values(),maxLookahead:this.maxLookahead,tokenTypes:r.values(this.tokensMap),ignoredIssues:this.ignoredIssues,errMsgProvider:u.defaultGrammarValidatorErrorProvider,grammarName:o});this.definitionErrors.push.apply(this.definitionErrors,m)}if(r.isEmpty(this.definitionErrors)&&(this.resyncFollows=i.computeAllProdsFollows(s.values())),this.allRuleNames=l.analyzeCst(s.values(),this.fullRuleNameToShort).allRuleNames,!t.DEFER_DEFINITION_ERRORS_HANDLING&&!r.isEmpty(this.definitionErrors))throw a=r.map(this.definitionErrors,function(e){return e.message}),Error(`Parser Definition Errors detected:
 `+a.join(`
-------------------------------
`))},t.DEFER_DEFINITION_ERRORS_HANDLING=!1,t}();exports.Parser=w,r.applyMixins(w,[f.Recoverable,p.LooksAhead,h.TreeBuilder,g.LexerAdapter,v.RecognizerEngine,_.RecognizerApi,y.ErrorHandler,b.ContentAssist]),exports.CstParser=function(n){t(i,n);function i(t,i){i===void 0&&(i=exports.DEFAULT_PARSER_CONFIG);var a=this,o=r.cloneObj(i);return o.outputCst=!0,a=n.call(this,t,o)||this,a}return i}(w),exports.EmbeddedActionsParser=function(n){t(i,n);function i(t,i){i===void 0&&(i=exports.DEFAULT_PARSER_CONFIG);var a=this,o=r.cloneObj(i);return o.outputCst=!1,a=n.call(this,t,o)||this,a}return i}(w)})),ae=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=k();function n(e,n){var r=n===void 0?{}:n,i=r.resourceBase,a=i===void 0?`https://unpkg.com/chevrotain@`+t.VERSION+`/diagrams/`:i,o=r.css,s=o===void 0?`https://unpkg.com/chevrotain@`+t.VERSION+`/diagrams/diagrams.css`:o,c=`
<!-- This is a generated file -->
<!DOCTYPE html>
<meta charset="utf-8">
<style>
  body {
    background-color: hsl(30, 20%, 95%)
  }
</style>

`,l=`
<link rel='stylesheet' href='`+s+`'>
`,u=`
<script src='`+a+`vendor/railroad-diagrams.js'><\/script>
<script src='`+a+`src/diagrams_builder.js'><\/script>
<script src='`+a+`src/diagrams_behavior.js'><\/script>
<script src='`+a+`src/main.js'><\/script>
`,d=`
<div id="diagrams" align="center"></div>    
`,f=`
<script>
    window.serializedGrammar = `+JSON.stringify(e,null,`  `)+`;
<\/script>
`;return c+l+u+d+f+`
<script>
    var diagramsDiv = document.getElementById("diagrams");
    main.drawDiagramsFromSerializedGrammar(serializedGrammar, diagramsDiv);
<\/script>
`}exports.createSyntaxDiagramsCode=n})),oe=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=o(),n=m(),r=h();function i(e){return`
(function (root, factory) {
    if (typeof define === 'function' && define.amd) {
        // AMD. Register as an anonymous module.
        define(['chevrotain'], factory);
    } else if (typeof module === 'object' && module.exports) {
        // Node. Does not work with strict CommonJS, but
        // only CommonJS-like environments that support module.exports,
        // like Node.
        module.exports = factory(require('chevrotain'));
    } else {
        // Browser globals (root is window)
        root.returnExports = factory(root.b);
    }
}(typeof self !== 'undefined' ? self : this, function (chevrotain) {

`+s(e)+`
    
return {
    `+e.name+`: `+e.name+` 
}
}));
`}exports.genUmdModule=i;function a(e){return`    
`+s(e)+`
return new `+e.name+`(tokenVocabulary, config)    
`}exports.genWrapperFunction=a;function s(e){return`
function `+e.name+`(tokenVocabulary, config) {
    // invoke super constructor
    // No support for embedded actions currently, so we can 'hardcode'
    // The use of CstParser.
    chevrotain.CstParser.call(this, tokenVocabulary, config)

    const $ = this

    `+c(e.rules)+`

    // very important to call this after all the rules have been defined.
    // otherwise the parser may not work correctly as it will lack information
    // derived during the self analysis phase.
    this.performSelfAnalysis(this)
}

// inheritance as implemented in javascript in the previous decade... :(
`+e.name+`.prototype = Object.create(chevrotain.CstParser.prototype)
`+e.name+`.prototype.constructor = `+e.name+`    
    `}exports.genClass=s;function c(e){return t.map(e,function(e){return l(e,1)}).join(`
`)}exports.genAllRules=c;function l(e,t){var n=b(t,`$.RULE("`+e.name+`", function() {`)+`
`;return n+=y(e.definition,t+1),n+=b(t+1,`})`)+`
`,n}exports.genRule=l;function u(e,t){var r=n.tokenName(e.terminalType);return b(t,`$.CONSUME`+e.idx+`(this.tokensMap.`+r+`)
`)}exports.genTerminal=u;function d(e,t){return b(t,`$.SUBRULE`+e.idx+`($.`+e.nonTerminalName+`)
`)}exports.genNonTerminal=d;function f(e,n){var r=b(n,`$.OR`+e.idx+`([`)+`
`,i=t.map(e.definition,function(e){return p(e,n+1)});return r+=i.join(`,
`),r+=`
`+b(n,`])
`),r}exports.genAlternation=f;function p(e,t){var n=b(t,`{`)+`
`;return e.name&&(n+=b(t+1,`NAME: "`+e.name+`",`)+`
`),n+=b(t+1,`ALT: function() {`)+`
`,n+=y(e.definition,t+1),n+=b(t+1,`}`)+`
`,n+=b(t,`}`),n}exports.genSingleAlt=p;function g(e,t){if(e instanceof r.NonTerminal)return d(e,t);if(e instanceof r.Option)return _(`OPTION`,e,t);if(e instanceof r.RepetitionMandatory)return _(`AT_LEAST_ONE`,e,t);if(e instanceof r.RepetitionMandatoryWithSeparator)return _(`AT_LEAST_ONE_SEP`,e,t);if(e instanceof r.RepetitionWithSeparator)return _(`MANY_SEP`,e,t);if(e instanceof r.Repetition)return _(`MANY`,e,t);if(e instanceof r.Alternation)return f(e,t);if(e instanceof r.Terminal)return u(e,t);if(e instanceof r.Flat)return y(e.definition,t);throw Error(`non exhaustive match`)}function _(e,t,r){var i=b(r,`$.`+(e+t.idx)+`(`);return t.name||t.separator?(i+=`{
`,t.name&&(i+=b(r+1,`NAME: "`+t.name+`"`)+`,
`),t.separator&&(i+=b(r+1,`SEP: this.tokensMap.`+n.tokenName(t.separator))+`,
`),i+=`DEF: `+v(t.definition,r+2)+`
`,i+=b(r,`}`)+`
`):i+=v(t.definition,r+1),i+=b(r,`)`)+`
`,i}function v(e,t){var n=`function() {
`;return n+=y(e,t),n+=b(t,`}`)+`
`,n}function y(e,n){var r=``;return t.forEach(e,function(e){r+=g(e,n+1)}),r}function b(e,t){return Array(e*4+1).join(` `)+t}})),se=t((exports=>{Object.defineProperty(exports,`__esModule`,{value:!0});var t=oe();function n(e){var n=t.genWrapperFunction({name:e.name,rules:e.rules}),r=Function(`tokenVocabulary`,`config`,`chevrotain`,n);return function(t){return r(e.tokenVocabulary,t,z())}}exports.generateParserFactory=n;function r(e){return t.genUmdModule({name:e.name,rules:e.rules})}exports.generateParserModule=r})),z=t(((exports,t)=>{Object.defineProperty(exports,`__esModule`,{value:!0});var n=R(),r=p(),i=m(),a=N(),o=k(),s=A(),c=ae(),l=_(),u=h(),d=M(),g=se(),v=f(),y={};y.VERSION=o.VERSION,y.Parser=n.Parser,y.CstParser=n.CstParser,y.EmbeddedActionsParser=n.EmbeddedActionsParser,y.ParserDefinitionErrorType=n.ParserDefinitionErrorType,y.Lexer=r.Lexer,y.LexerDefinitionErrorType=r.LexerDefinitionErrorType,y.EOF=i.EOF,y.tokenName=i.tokenName,y.tokenLabel=i.tokenLabel,y.tokenMatcher=i.tokenMatcher,y.createToken=i.createToken,y.createTokenInstance=i.createTokenInstance,y.EMPTY_ALT=n.EMPTY_ALT,y.defaultParserErrorProvider=s.defaultParserErrorProvider,y.isRecognitionException=a.isRecognitionException,y.EarlyExitException=a.EarlyExitException,y.MismatchedTokenException=a.MismatchedTokenException,y.NotAllInputParsedException=a.NotAllInputParsedException,y.NoViableAltException=a.NoViableAltException,y.defaultLexerErrorProvider=v.defaultLexerErrorProvider,y.Flat=u.Flat,y.Repetition=u.Repetition,y.RepetitionWithSeparator=u.RepetitionWithSeparator,y.RepetitionMandatory=u.RepetitionMandatory,y.RepetitionMandatoryWithSeparator=u.RepetitionMandatoryWithSeparator,y.Option=u.Option,y.Alternation=u.Alternation,y.NonTerminal=u.NonTerminal,y.Terminal=u.Terminal,y.Rule=u.Rule,y.GAstVisitor=l.GAstVisitor,y.serializeGrammar=u.serializeGrammar,y.serializeProduction=u.serializeProduction,y.resolveGrammar=d.resolveGrammar,y.defaultGrammarResolverErrorProvider=s.defaultGrammarResolverErrorProvider,y.validateGrammar=d.validateGrammar,y.defaultGrammarValidatorErrorProvider=s.defaultGrammarValidatorErrorProvider,y.assignOccurrenceIndices=d.assignOccurrenceIndices,y.clearCache=function(){console.warn(`The clearCache function was 'soft' removed from the Chevrotain API.
	 It performs no action other than printing this message.
	 Please avoid using it as it will be completely removed in the future`)},y.createSyntaxDiagramsCode=c.createSyntaxDiagramsCode,y.generateParserFactory=g.generateParserFactory,y.generateParserModule=g.generateParserModule,t.exports=y})),B=e(z()),ce=e=>(0,B.createToken)({name:e,pattern:B.Lexer.NA,longer_alt:ge}),H={},U=(e,t,n,r={})=>{let i=[e];r.extraCategories&&i.push(...r.extraCategories);let a=(0,B.createToken)({name:t,pattern:n,categories:i,longer_alt:ge}),o=Array.isArray(e)?e[0].name:e.name;H[o]===void 0&&(H[o]=[]),H[o].push(a);let s=n.toString().match(/^\/([a-zA-Z0-9]*)\/[a-zA-Z]*$/iu);return s&&s[1]&&(a.$autocomplete=s[1]),Object.assign(a,r),a},le=(0,B.createToken)({name:`HSpace`,pattern:/[ \t]+/,group:B.Lexer.SKIPPED}),ue=(0,B.createToken)({name:`EOL`,line_breaks:!0,pattern:/[ \t\r]*\n\s*/,label:`End of line`}),de=(0,B.createToken)({name:`StringLiteral`,pattern:/".*"/}),fe=(0,B.createToken)({name:`StringLiteralSingleQuote`,pattern:/'.*'/}),pe=(0,B.createToken)({name:`Comment`,pattern:/(#|\/\/)[^\n]*/}),me=(0,B.createToken)({name:`NumberLiteral`,pattern:/-?(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?/}),he=(0,B.createToken)({name:`BlackHoleStr`,pattern:/[Bb][Hh][12]/}),ge=(0,B.createToken)({name:`Identifier`,pattern:/[a-zA-Z_][a-zA-Z_0-9]*/}),_e=(0,B.createToken)({name:`ComparisonOperator`,pattern:B.Lexer.NA}),W=ce(`AutomatorCurrency`),ve=ce(`PrestigeEvent`),G=ce(`StudyPath`),ye=ce(`TimeUnit`);U(_e,`OpGTE`,/>=/,{$autocomplete:`>=`,$compare:(e,t)=>Decimal.gte(e,t)}),U(_e,`OpLTE`,/<=/,{$autocomplete:`<=`,$compare:(e,t)=>Decimal.lte(e,t)}),U(_e,`OpGT`,/>/,{$autocomplete:`>`,$compare:(e,t)=>Decimal.gt(e,t)}),U(_e,`OpLT`,/</,{$autocomplete:`<`,$compare:(e,t)=>Decimal.lt(e,t)});var be=U(_e,`OpEQ`,/==/,{$compare:(e,t)=>Decimal.eq(e,t)}),xe=(0,B.createToken)({name:`EqualSign`,pattern:/=/,categories:_e,label:`=`,longer_alt:be});xe.$compare=(e,t)=>Decimal.eq(e,t),U(W,`EP`,/ep/i,{$getter:()=>Currency.eternityPoints.value}),U(W,`IP`,/ip/i,{$getter:()=>Currency.infinityPoints.value}),U(W,`AM`,/am/i,{$getter:()=>Currency.antimatter.value}),U(W,`DT`,/dt/i,{$getter:()=>Currency.dilatedTime.value}),U(W,`TP`,/tp/i,{$getter:()=>Currency.tachyonParticles.value}),U(W,`RG`,/rg/i,{$getter:()=>new Decimal(Replicanti.galaxies.total)}),U(W,`RM`,/rm/i,{$getter:()=>Currency.realityMachines.value}),U(W,`infinities`,/infinities/i,{$getter:()=>Currency.infinities.value}),U(W,`bankedInfinities`,/banked[ \t]+infinities/i,{$autocomplete:`banked infinities`,$getter:()=>Currency.infinitiesBanked.value}),U(W,`eternities`,/eternities/i,{$getter:()=>Currency.eternities.value}),U(W,`realities`,/realities/i,{$getter:()=>Currency.realities.value}),U(W,`PendingIP`,/pending[ \t]+ip/i,{$autocomplete:`pending IP`,$getter:()=>Player.canCrunch?gainedInfinityPoints():r.D0}),U(W,`PendingEP`,/pending[ \t]+ep/i,{$autocomplete:`pending EP`,$getter:()=>Player.canEternity?gainedEternityPoints():r.D0}),U(W,`PendingTP`,/pending[ \t]+tp/i,{$autocomplete:`pending TP`,$getter:()=>player.dilation.active?getTachyonGain():r.D0}),U(W,`PendingRM`,/pending[ \t]+rm/i,{$autocomplete:`pending RM`,$getter:()=>isRealityAvailable()?MachineHandler.gainedRealityMachines:r.D0}),U(W,`PendingGlyphLevel`,/pending[ \t]+glyph[ \t]+level/i,{$autocomplete:`pending Glyph level`,$getter:()=>new Decimal(isRealityAvailable()?gainedGlyphLevel().actualLevel:0)}),U(W,`Rep`,/rep(licanti)?/i,{$autocomplete:`rep`,$getter:()=>Replicanti.amount}),U(W,`TT`,/(tt|time theorems?)/i,{$autocomplete:`TT`,$getter:()=>Currency.timeTheorems.value}),U(W,`TotalTT`,/total[ \t]+tt/i,{$autocomplete:`total TT`,$getter:()=>player.timestudy.theorem.plus(TimeTheorems.calculateTimeStudiesCost())}),U(W,`TotalCompletions`,/total[ \t]+completions/i,{$autocomplete:`total completions`,$getter:()=>EternityChallenges.completions}),U(W,`PendingCompletions`,/pending[ \t]+completions/i,{$autocomplete:`pending completions`,$getter:()=>EternityChallenge.isRunning?EternityChallenge.current.gainedCompletionStatus.totalCompletions:r.NUMMAX}),U(W,`FilterScore`,/filter[ \t]+score/i,{$autocomplete:`filter score`,$getter:()=>{if(!EffarigUnlock.glyphFilter.isUnlocked)return-Number.MAX_VALUE;let e=GlyphSelection.glyphList(GlyphSelection.choiceCount,gainedGlyphLevel(),{isChoosingGlyph:!1}),t=AutoGlyphProcessor.pick(e);return AutoGlyphProcessor.filterValue(t)},$unlocked:()=>EffarigUnlock.glyphFilter.isUnlocked}),U(W,`ST`,/space[ \t]+theorems/i,{$autocomplete:`space theorems`,$getter:()=>V.availableST,$unlocked:()=>V.spaceTheorems>0}),U(W,`TotalST`,/total[ \t]+space[ \t]+theorems/i,{$autocomplete:`total space theorems`,$getter:()=>V.spaceTheorems,$unlocked:()=>V.spaceTheorems>0});for(let e=1;e<=12;++e){let t=e;U(W,`EC${e}`,RegExp(`ec${e} completions`,`i`),{$autocomplete:`ec${e} completions`,$getter:()=>EternityChallenge(t).completions})}U(ve,`Infinity`,/infinity/i,{extraCategories:[G],$autobuyer:()=>Autobuyer.bigCrunch,$autobuyerDurationMode:AUTO_CRUNCH_MODE.TIME,$autobuyerXHighestMode:AUTO_CRUNCH_MODE.X_HIGHEST,$autobuyerCurrencyMode:AUTO_CRUNCH_MODE.AMOUNT,$prestigeAvailable:()=>Player.canCrunch,$prestige:()=>bigCrunchResetRequest(!0),$prestigeLevel:1,$prestigeCurrency:`IP`,$studyPath:TIME_STUDY_PATH.INFINITY_DIM}),U(ve,`Eternity`,/eternity/i,{$autobuyer:()=>Autobuyer.eternity,$autobuyerDurationMode:AUTO_ETERNITY_MODE.TIME,$autobuyerXHighestMode:AUTO_ETERNITY_MODE.X_HIGHEST,$autobuyerCurrencyMode:AUTO_ETERNITY_MODE.AMOUNT,$prestigeAvailable:()=>Player.canEternity,$prestigeLevel:2,$prestigeCurrency:`EP`,$prestige:()=>eternity(!1,!0),$respec:()=>{player.respec=!0}}),U(ve,`Reality`,/reality/i,{$autobuyer:()=>Autobuyer.reality,$autobuyerCurrencyMode:AUTO_REALITY_MODE.RM,$prestigeAvailable:()=>isRealityAvailable(),$prestigeLevel:3,$prestigeCurrency:`RM`,$prestige:()=>autoReality(),$respec:()=>{player.reality.respec=!0}}),U(G,`Idle`,/idle/i,{$studyPath:TIME_STUDY_PATH.IDLE}),U(G,`Passive`,/passive/i,{$studyPath:TIME_STUDY_PATH.PASSIVE}),U(G,`Active`,/active/i,{$studyPath:TIME_STUDY_PATH.ACTIVE}),U(G,`Antimatter`,/antimatter/i,{$studyPath:TIME_STUDY_PATH.ANTIMATTER_DIM}),U(G,`Time`,/time/i,{$studyPath:TIME_STUDY_PATH.TIME_DIM}),U(G,`Light`,/light/i,{$studyPath:TIME_STUDY_PATH.LIGHT}),U(G,`Dark`,/dark/i,{$studyPath:TIME_STUDY_PATH.DARK}),U(ye,`Milliseconds`,/ms/i,{$autocomplete:`ms`,$scale:1}),U(ye,`Seconds`,/s(ec(onds?)?)?/i,{$autocomplete:`sec`,$scale:1e3}),U(ye,`Minutes`,/m(in(utes?)?)?/i,{$autocomplete:`min`,$scale:60*1e3}),U(ye,`Hours`,/h(ours?)?/i,{$autocomplete:`hours`,$scale:3600*1e3});var Se=(0,B.createToken)({name:`Keyword`,pattern:B.Lexer.NA,longer_alt:ge}),Ce=[],K=(e,t,n={})=>{let r=[Se];n.extraCategories&&r.push(...n.extraCategories);let i=(0,B.createToken)({name:e,pattern:t,categories:r,longer_alt:ge});return i.$autocomplete=e.toLocaleLowerCase(),Ce.push(i),Object.assign(i,n),i};K(`Auto`,/auto/i),K(`Buy`,/buy/i),K(`Blob`,/blob\s\s/i,{$unlocked:()=>!1}),K(`If`,/if/i),K(`Load`,/load/i),K(`Notify`,/notify/i),K(`Nowait`,/nowait/i),K(`Off`,/off/i),K(`On`,/on/i),K(`Pause`,/pause/i),K(`Name`,/name([ \t]+(\/(?!\/)|[^\n#/])*)?/i),K(`Id`,/id\b([ \t]+\d)?/i),K(`Purchase`,/purchase/i),K(`Respec`,/respec/i),K(`Restart`,/restart/i),K(`Start`,/start/i),K(`Stop`,/stop/i),K(`Studies`,/studies/i),K(`Unlock`,/unlock/i),K(`Until`,/until/i),K(`Use`,/use/i),K(`Wait`,/wait/i),K(`While`,/while/i),K(`BlackHole`,/black[ \t]+hole/i,{$autocomplete:`black hole`,$unlocked:()=>BlackHole(1).isUnlocked}),K(`StoreGameTime`,/stored?[ \t]+game[ \t]+time/i,{$autocomplete:`store game time`,$unlocked:()=>Enslaved.isUnlocked}),K(`Dilation`,/dilation/i),K(`EC`,/ec/i),K(`XHighest`,/x[ \t]+highest/i,{$autocomplete:`x highest`});var we=(0,B.createToken)({name:`ECLiteral`,pattern:/ec[1-9][0-9]*/i,longer_alt:ge}),Te=(0,B.createToken)({name:`LCurly`,pattern:/[ \t]*{/}),q=(0,B.createToken)({name:`RCurly`,pattern:/[ \t]*}/}),Ee=(0,B.createToken)({name:`Comma`,pattern:/,/}),De=(0,B.createToken)({name:`Pipe`,pattern:/\|/,label:`|`}),Oe=(0,B.createToken)({name:`Dash`,pattern:/-/,label:`-`}),ke=(0,B.createToken)({name:`Exclamation`,pattern:/!/,label:`!`});const Ae=[le,de,fe,pe,ue,_e,...H.ComparisonOperator,Te,q,Ee,xe,De,Oe,ke,he,me,W,...H.AutomatorCurrency,we,Se,...Ce,ve,...H.PrestigeEvent,G,...H.StudyPath,ye,...H.TimeUnit,ge];Te.LABEL=`'{'`,q.LABEL=`'}'`,me.LABEL=`Number`,Ee.LABEL=`❟`;const je=new B.Lexer(Ae,{positionTracking:`full`,ensureOptimizations:!0}),Me=[];for(let e of je.lexerDefinition)Me[e.tokenTypeIdx]=e;const J=Ae.mapToObject(e=>e.name,e=>e);var Ne=new Set(H.AutomatorCurrency.map(e=>e.$autocomplete.toUpperCase()));const Pe=function(e){try{if(Ne.has(e.toUpperCase()))return e.toUpperCase()}catch{return e}for(let t of H.AutomatorCurrency)if(e.match(t.PATTERN)&&e.match(t.PATTERN)[0].length===e.length)return t.$autocomplete.toUpperCase();return e};var Fe=new Set([`Identifier`,`LCurly`,`RCurly`]);const Ie=je.lexerDefinition.filter(e=>!Fe.has(e.name)).map(e=>e.PATTERN.source).flatMap(e=>e.includes(`(`)||e.includes(`)`)?e:e.split(String.raw`[ \t]+`));var Le=/name[ \t]+(.+$)/iu,Re=/id[ \t]+(\d)/iu;function ze(e){if(!AutomatorBackend.isOn)return;let t=AutomatorBackend.stack.top.commandState;t&&t.prestigeLevel!==void 0&&(t.prestigeLevel=Math.max(t.prestigeLevel,e))}EventHub.logic.on(GAME_EVENT.BIG_CRUNCH_AFTER,()=>ze(J.Infinity.$prestigeLevel)),EventHub.logic.on(GAME_EVENT.ETERNITY_RESET_AFTER,()=>ze(J.Eternity.$prestigeLevel)),EventHub.logic.on(GAME_EVENT.REALITY_RESET_AFTER,()=>ze(J.Reality.$prestigeLevel));function Be(e,t,n,r){return{run:()=>{let i=r?`UNTIL`:`WHILE`;return e()?(AutomatorBackend.push(t),AutomatorData.logCommandEvent(`Checked ${Ve(n)} (${!r}),
        moving to line ${AutomatorBackend.translateLineNumber(n.LCurly[0].startLine+1)-1}
        (start of ${i} loop)`,n.startLine),AUTOMATOR_COMMAND_STATUS.SAME_INSTRUCTION):(AutomatorData.logCommandEvent(`Checked ${Ve(n)} (${r}),
          exiting loop at line ${AutomatorBackend.translateLineNumber(n.RCurly[0].startLine+1)-1}
          (end of ${i} loop)`,n.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_TICK_NEXT_INSTRUCTION)},blockCommands:t}}function Ve(e){let t=e.comparison[0].children,n=t.compareValue.map(e=>{if(e.children.AutomatorCurrency)return()=>e.children.AutomatorCurrency[0].image;let t=e.children.$value;return typeof t==`string`?()=>t:()=>format(t,2,2)}),r=t.ComparisonOperator[0].image;return`${n[0]()} ${r} ${n[1]()}`}function He(e){let t,n;switch(e){case`INFINITY`:return`${format(player.records.recentInfinities[0][1],2)} IP`;case`ETERNITY`:return t=AutomatorData.lastECCompletionCount,n=`${format(player.records.recentEternities[0][1],2)} EP`,t===0?`${n}`:`${n}, ${t} completions`;case`REALITY`:return`${format(player.records.recentRealities[0][1],2)} RM`;default:throw Error(`Unrecognized prestige ${e} in Automator event log`)}}const Ue=[{id:`auto`,rule:e=>()=>{e.CONSUME(J.Auto),e.CONSUME(J.PrestigeEvent),e.OR([{ALT:()=>e.CONSUME(J.On)},{ALT:()=>e.CONSUME(J.Off)},{ALT:()=>e.OR1([{ALT:()=>e.SUBRULE(e.duration)},{ALT:()=>e.SUBRULE(e.xHighest)},{ALT:()=>e.SUBRULE(e.currencyAmount)}])}])},validate:(e,t)=>{if(e.startLine=e.Auto[0].startLine,e.PrestigeEvent&&e.currencyAmount){let n=e.PrestigeEvent[0].tokenType.$prestigeCurrency,r=e.currencyAmount[0].children.AutomatorCurrency[0].tokenType.name;if(n!==r)return t.addError(e.currencyAmount,`AutomatorCurrency doesn't match prestige (${n} vs ${r})`,`Use ${n} for the specified prestige resource`),!1}if(!e.PrestigeEvent)return!0;let n=e.duration||e.xHighest;if(e.PrestigeEvent[0].tokenType===J.Infinity){if(!Autobuyer.bigCrunch.isUnlocked)return t.addError(e.PrestigeEvent,`Infinity autobuyer is not unlocked`,`Complete the Big Crunch Autobuyer challenge to use this command`),!1;if(n&&!EternityMilestone.bigCrunchModes.isReached)return t.addError((e.duration||e.xHighest)[0],`Advanced Infinity autobuyer settings are not unlocked`,`Reach ${quantifyInt(`Eternity`,EternityMilestone.bigCrunchModes.config.eternities)}
            to use this command`),!1}if(e.PrestigeEvent[0].tokenType===J.Eternity){if(!EternityMilestone.autobuyerEternity.isReached)return t.addError(e.PrestigeEvent,`Eternity autobuyer is not unlocked`,`Reach ${quantifyInt(`Eternity`,EternityMilestone.autobuyerEternity.config.eternities)}
            to use this command`),!1;if(n&&!RealityUpgrade(13).isBought)return t.addError((e.duration||e.xHighest)[0],`Advanced Eternity autobuyer settings are not unlocked`,`Purchase the Reality Upgrade which unlocks advanced Eternity autobuyer settings`),!1}if(e.PrestigeEvent[0].tokenType===J.Reality){if(!RealityUpgrade(25).isBought)return t.addError(e.PrestigeEvent,`Reality autobuyer is not unlocked`,`Purchase the Reality Upgrade which unlocks the Reality autobuyer`),!1;if(n)return t.addError((e.duration||e.xHighest)[0],`Auto Reality cannot be set to a duration or x highest`,`Use RM for Auto Reality`),!1}return!0},compile:e=>{let t=e.PrestigeEvent[0].tokenType===J.Reality,n=!!(e.On||e.duration||e.xHighest||e.currencyAmount),r=e.duration?e.duration[0].children.$value:void 0,i=e.xHighest?e.xHighest[0].children.$value:void 0,a=e.currencyAmount?e.currencyAmount[0].children.$value:void 0,o=e.PrestigeEvent[0].tokenType.$autobuyerDurationMode,s=e.PrestigeEvent[0].tokenType.$autobuyerXHighestMode,c=e.PrestigeEvent[0].tokenType.$autobuyerCurrencyMode,l=e.PrestigeEvent[0].tokenType.$autobuyer();return()=>{l.isActive=n;let u=``;r===void 0?i===void 0?a!==void 0&&(l.mode=c,t?(l.rm=new Decimal(a),u=`${format(l.rm,2)} RM`):(l.amount=new Decimal(a),u=`${a} ${e.PrestigeEvent[0].image===`infinity`?`IP`:`EP`}`)):(l.mode=s,l.xHighest=new Decimal(i),u=`${format(i,2,2)} times highest`):(l.mode=o,l.time=r/1e3,u=`${l.time>1e3?formatInt(l.time):quantify(`second`,l.time)}`);let d=l.isActive&&u!==``?`(Setting: ${u})`:``;return AutomatorData.logCommandEvent(`Automatic ${e.PrestigeEvent[0].image}
          turned ${l.isActive?`ON`:`OFF`} ${d}`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION}},blockify:e=>{let t=e.duration?`${e.duration[0].children.NumberLiteral[0].image} ${e.duration[0].children.TimeUnit[0].image}`:void 0,n=e.xHighest?e.xHighest[0].children.$value:void 0,r=e.currencyAmount?`${e.currencyAmount[0].children.NumberLiteral[0].image} ${e.currencyAmount[0].children.AutomatorCurrency[0].image.toUpperCase()}`:void 0,i=!!e.On,a=``;return a=t||(n?`${n} x highest`:r?`${r}`:i?`ON`:`OFF`),{singleSelectionInput:e.PrestigeEvent[0].tokenType.name.toUpperCase(),singleTextInput:a,...automatorBlocksMap.AUTO}}},{id:`blackHole`,rule:e=>()=>{e.CONSUME(J.BlackHole),e.OR([{ALT:()=>e.CONSUME(J.On)},{ALT:()=>e.CONSUME(J.Off)}])},validate:e=>(e.startLine=e.BlackHole[0].startLine,!0),compile:e=>{let t=!!e.On;return()=>{t===BlackHoles.arePaused&&BlackHoles.togglePause();let n;return n=BlackHole(1).isUnlocked?`Black Holes toggled ${e.On?`ON`:`OFF`}`:Enslaved.isRunning||Pelle.isDisabled(`blackhole`)?`Black Hole command ignored because BH is disabled in your current Reality`:`Black Hole command ignored because BH is not unlocked`,AutomatorData.logCommandEvent(n,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION}},blockify:e=>({singleSelectionInput:e.On?`ON`:`OFF`,...automatorBlocksMap[`BLACK HOLE`]})},{id:`blob`,rule:e=>()=>{e.CONSUME(J.Blob)},validate:e=>(e.startLine=e.Blob[0].startLine,!0),compile:()=>()=>AUTOMATOR_COMMAND_STATUS.SKIP_INSTRUCTION,blockify:()=>({...automatorBlocksMap.BLOB})},{id:`comment`,rule:e=>()=>{e.CONSUME(J.Comment)},validate:e=>(e.startLine=e.Comment[0].startLine,!0),compile:()=>()=>AUTOMATOR_COMMAND_STATUS.SKIP_INSTRUCTION,blockify:e=>({...automatorBlocksMap.COMMENT,singleTextInput:e.Comment[0].image.replace(/(#|\/\/)\s?/u,``)})},{id:`ifBlock`,rule:e=>()=>{e.CONSUME(J.If),e.SUBRULE(e.comparison),e.CONSUME(J.LCurly),e.CONSUME(J.EOL),e.SUBRULE(e.block),e.CONSUME(J.RCurly)},validate:(e,t)=>(e.startLine=e.If[0].startLine,t.checkBlock(e,e.If)),compile:(e,t)=>{let n=t.visit(e.comparison),r=t.visit(e.block);return{run:t=>t.commandState===null?(t.commandState={advanceOnPop:!0,ifEndLine:e.RCurly[0].startLine},n()?(AutomatorBackend.push(r),AutomatorData.logCommandEvent(`Checked ${Ve(e)} (true),
            entering IF block`,e.startLine),AUTOMATOR_COMMAND_STATUS.SAME_INSTRUCTION):(AutomatorData.logCommandEvent(`Checked ${Ve(e)} (false),
              skipping to line ${AutomatorBackend.translateLineNumber(e.RCurly[0].startLine+1)}`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION)):AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION,blockCommands:r}},blockify:(e,t)=>{let n=[];t.visit(e.block,n);let r=t.visit(e.comparison);return{nest:n,...automatorBlocksMap.IF,...r,genericInput1:Pe(r.genericInput1),genericInput2:Pe(r.genericInput2)}}},{id:`notify`,rule:e=>()=>{e.CONSUME(J.Notify),e.OR([{ALT:()=>e.CONSUME(J.StringLiteral)},{ALT:()=>e.CONSUME(J.StringLiteralSingleQuote)}])},validate:e=>(e.startLine=e.Notify[0].startLine,!0),compile:e=>{let t=e.StringLiteral||e.StringLiteralSingleQuote;return()=>(GameUI.notify.automator(`Automator: ${t[0].image}`),AutomatorData.logCommandEvent(`NOTIFY call: ${t[0].image}`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION)},blockify:e=>({...automatorBlocksMap.NOTIFY,singleTextInput:(e.StringLiteral||e.StringLiteralSingleQuote)[0].image})},{id:`pauseTime`,rule:e=>()=>{e.CONSUME(J.Pause),e.OR([{ALT:()=>e.SUBRULE(e.duration)},{ALT:()=>e.CONSUME(J.Identifier)}])},validate:(e,t)=>{e.startLine=e.Pause[0].startLine;let n;if(e.Identifier){if(!t.isValidVarFormat(e.Identifier[0],AUTOMATOR_VAR_TYPES.DURATION))return t.addError(e,`Constant ${e.Identifier[0].image} is not a valid time duration constant`,`Ensure that ${e.Identifier[0].image} is a number of seconds less than
            ${format(Number.MAX_VALUE/1e3)}`),!1;let r=t.lookupVar(e.Identifier[0],AUTOMATOR_VAR_TYPES.DURATION);n=r&&r.value}else n=t.visit(e.duration);return e.$duration=n,e.$duration!==void 0},compile:e=>{let t=e.$duration;return n=>{let r;if(e.duration){let t=e.duration[0].children;r=`${t.NumberLiteral[0].image} ${t.TimeUnit[0].image}`}else r=TimeSpan.fromMilliseconds(new Decimal(t));return n.commandState===null?(n.commandState={timeMs:0},AutomatorData.logCommandEvent(`Pause started (waiting ${r})`,e.startLine)):n.commandState.timeMs+=Decimal.max(Time.trueDeltaTime.totalMilliseconds,AutomatorBackend.currentInterval).toNumber(),n.commandState.timeMs>=t?(AutomatorData.logCommandEvent(`Pause finished (waited ${r})`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION}},blockify:e=>{let t;if(e.duration){let n=e.duration[0].children;t=`${n.NumberLiteral[0].image} ${n.TimeUnit[0].image}`}else t=`${e.Identifier[0].image}`;return{...automatorBlocksMap.PAUSE,singleTextInput:t}}},{id:`prestige`,rule:e=>()=>{e.CONSUME(J.PrestigeEvent),e.OPTION(()=>e.CONSUME(J.Nowait)),e.OPTION1(()=>e.CONSUME(J.Respec))},validate:(e,t)=>(e.startLine=e.PrestigeEvent[0].startLine,e.PrestigeEvent&&e.PrestigeEvent[0].tokenType===J.Eternity&&!EternityMilestone.autobuyerEternity.isReached?(t.addError(e.PrestigeEvent,`Eternity autobuyer is not unlocked`,`Reach ${quantifyInt(`Eternity`,EternityMilestone.autobuyerEternity.config.eternities)}
          to use this command`),!1):e.PrestigeEvent&&e.PrestigeEvent[0].tokenType===J.Reality&&!RealityUpgrade(25).isBought?(t.addError(e.PrestigeEvent,`Reality autobuyer is not unlocked`,`Purchase the Reality Upgrade which unlocks the Reality autobuyer`),!1):(e.PrestigeEvent&&e.PrestigeEvent[0].tokenType===J.Infinity&&e.Respec&&t.addError(e.Respec,`There's no 'respec' for infinity`,`Remove 'respec' from the command`),!0)),compile:e=>{let t=e.Nowait!==void 0,n=e.Respec!==void 0,r=e.PrestigeEvent[0].tokenType;return()=>{if(!r.$prestigeAvailable())return t?(AutomatorData.logCommandEvent(`${e.PrestigeEvent.image} attempted, but skipped due to NOWAIT`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION;n&&r.$respec(),r.$prestige();let i=e.PrestigeEvent[0].image.toUpperCase();return AutomatorData.logCommandEvent(`${i} triggered (${He(i)})`,e.startLine),i===`REALITY`&&AutomatorBackend.state.forceRestart?AUTOMATOR_COMMAND_STATUS.RESTART:AUTOMATOR_COMMAND_STATUS.NEXT_TICK_NEXT_INSTRUCTION}},blockify:e=>({...automatorBlocksMap[e.PrestigeEvent[0].tokenType.name.toUpperCase()],nowait:e.Nowait!==void 0,respec:e.Respec!==void 0})},{id:`startDilation`,rule:e=>()=>{e.CONSUME(J.Start),e.CONSUME(J.Dilation)},validate:e=>(e.startLine=e.Start[0].startLine,!0),compile:e=>()=>player.dilation.active?(AutomatorData.logCommandEvent(`Start Dilation encountered but ignored due to already being dilated`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):startDilatedEternity(!0)?(AutomatorData.logCommandEvent(`Dilation entered`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_TICK_NEXT_INSTRUCTION):AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION,blockify:()=>({singleSelectionInput:`DILATION`,...automatorBlocksMap.START})},{id:`startEC`,rule:e=>()=>{e.CONSUME(J.Start),e.SUBRULE(e.eternityChallenge)},validate:e=>(e.startLine=e.Start[0].startLine,!0),compile:e=>{let t=e.eternityChallenge[0].children.$ecNumber;return()=>{let n=EternityChallenge(t);return n.isRunning?(AutomatorData.logCommandEvent(`Start EC encountered but ignored due to already being in the specified EC`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):!EternityChallenge(t).isUnlocked&&!TimeStudy.eternityChallenge(t).purchase(!0)?AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION:n.start(!0)?(AutomatorData.logCommandEvent(`Eternity Challenge ${t} started`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_TICK_NEXT_INSTRUCTION):AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION}},blockify:e=>({singleSelectionInput:`EC`,singleTextInput:e.eternityChallenge[0].children.$ecNumber,...automatorBlocksMap.START})},{id:`storeGameTime`,rule:e=>()=>{e.CONSUME(J.StoreGameTime),e.OR([{ALT:()=>e.CONSUME(J.On)},{ALT:()=>e.CONSUME(J.Off)},{ALT:()=>e.CONSUME(J.Use)}])},validate:(e,t)=>(e.startLine=e.StoreGameTime[0].startLine,Enslaved.isUnlocked?!0:(t.addError(e.StoreGameTime[0],`You do not yet know how to store game time`,`Unlock the ability to store game time`),!1)),compile:e=>{if(e.Use)return()=>(Enslaved.isUnlocked?(Enslaved.useStoredTime(!1),AutomatorData.logCommandEvent(`Stored game time used`,e.startLine)):AutomatorData.logCommandEvent(`Attempted to use stored game time, but failed (not unlocked yet)`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION);let t=!!e.On;return()=>(t!==player.celestials.enslaved.isStoring&&Enslaved.toggleStoreBlackHole(),AutomatorData.logCommandEvent(`Storing game time toggled ${e.On?`ON`:`OFF`}`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION)},blockify:e=>({singleSelectionInput:e.Use?`USE`:e.On?`ON`:`OFF`,...automatorBlocksMap[`STORE GAME TIME`]})},{id:`studiesBuy`,rule:e=>()=>{e.CONSUME(J.Studies),e.OPTION(()=>e.CONSUME(J.Nowait)),e.CONSUME(J.Purchase),e.OR([{ALT:()=>e.SUBRULE(e.studyList)},{ALT:()=>e.CONSUME1(J.Identifier)}])},validate:(e,t)=>{if(e.startLine=e.Studies[0].startLine,e.Identifier){if(!t.isValidVarFormat(e.Identifier[0],AUTOMATOR_VAR_TYPES.STUDIES))return t.addError(e,`Constant ${e.Identifier[0].image} is not a valid Time Study constant`,`Ensure that ${e.Identifier[0].image} is a properly-formatted Time Study string`),!1;e.$studies=t.lookupVar(e.Identifier[0],AUTOMATOR_VAR_TYPES.STUDIES).value,e.$studies.image=e.Identifier[0].image}else e.studyList&&(e.$studies=t.visit(e.studyList));return!0},compile:e=>{let t=e.$studies;return e.Nowait===void 0?()=>{let n=0,r=0,i;for(let e of t.normal)TimeStudy(e).isBought?n++:TimeStudy(e).purchase(!0)?r++:i??=e;if(n+r<t.normal.length)return n+r===0&&AutomatorData.logCommandEvent(`Could not purchase any of the specified Time Studies`,e.startLine),r>0&&i&&AutomatorData.logCommandEvent(`Purchased ${quantifyInt(`Time Study`,r)} and stopped at
            Time Study ${i}, waiting to attempt to purchase more Time Studies`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION;let a=t.ec?TimeStudy.eternityChallenge(t.ec).isBought:!1;if(!t.ec||a&&!t.startEC)return AutomatorData.logCommandEvent(`Purchased all specified Time Studies`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION;let o=TimeStudy.eternityChallenge(t.ec).purchase(!0);return a||o?(t.startEC?(EternityChallenge(t.ec).start(!0),EternityChallenge(t.ec).isRunning?AutomatorData.logCommandEvent(`Purchased all specified Time Studies, then unlocked and started running
                Eternity Challenge ${t.ec}`,e.startLine):AutomatorData.logCommandEvent(`Purchased all specified Time Studies and unlocked Eternity Challenge
                ${t.ec}, but failed to start it`,e.startLine)):AutomatorData.logCommandEvent(`Purchased all specified Time Studies and unlocked Eternity Challenge
              ${t.ec}`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION}:()=>{for(let e of t.normal)TimeStudy(e).purchase(!0);return!t.ec||TimeStudy.eternityChallenge(t.ec).isBought||TimeStudy.eternityChallenge(t.ec).purchase(!0),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION}},blockify:e=>({singleTextInput:e.$studies.image,nowait:e.Nowait!==void 0,...automatorBlocksMap[`STUDIES PURCHASE`]})},{id:`studiesLoad`,rule:e=>()=>{e.CONSUME(J.Studies),e.OPTION(()=>e.CONSUME(J.Nowait)),e.CONSUME(J.Load),e.OR([{ALT:()=>e.CONSUME1(J.Id)},{ALT:()=>e.CONSUME1(J.Name)}])},validate:(e,t)=>{if(e.startLine=e.Studies[0].startLine,e.Id){let n=Re.exec(e.Id[0].image);if(!n||e.Id[0].isInsertedInRecovery)return t.addError(e,`Missing preset id`,`Provide the id of a saved study preset slot from the Time Studies page`),!1;let r=Number.parseInt(n[1],10);return r<1||r>6?(t.addError(e.Id[0],`Could not find a preset with an id of ${r}`,`Type in a valid id (1 - 6) for your study preset`),!1):(e.$presetIndex=r,!0)}if(e.Name){let n=Le.exec(e.Name[0].image);if(!n||e.Name[0].isInsertedInRecovery)return t.addError(e,`Missing preset name`,`Provide the name of a saved study preset from the Time Studies page`),!1;let r=player.timestudy.presets.findIndex(e=>e.name===n[1])+1;return r===0?(t.addError(e.Name[0],`Could not find preset named ${n[1]} (Note: Names are case-sensitive)`,`Check to make sure you typed in the correct name for your study preset`),!1):(e.$presetIndex=r,!0)}return!1},compile:e=>{let t=e.$presetIndex;return()=>{let n=new TimeStudyTree(player.timestudy.presets[t-1].studies),r=GameCache.currentStudyTree.value.purchasedStudies.length;TimeStudyTree.commitToGameState(n.purchasedStudies,!0,n.startEC);let i=GameCache.currentStudyTree.value.purchasedStudies.length,a=n.purchasedStudies.filter(e=>!GameCache.currentStudyTree.value.purchasedStudies.includes(e)).length,o=e.Name?e.Name[0].image:e.Id[0].image;return a===0?AutomatorData.logCommandEvent(`Fully loaded study preset ${o}`,e.startLine):i>r&&AutomatorData.logCommandEvent(`Partially loaded study preset ${o}
            (missing ${quantifyInt(`study`,a)})`,e.startLine),e.Nowait!==void 0||a===0?AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION:AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION}},blockify:e=>({singleSelectionInput:e.Name?`NAME`:`ID`,singleTextInput:e.Name?player.timestudy.presets[e.$presetIndex-1].name:e.$presetIndex,nowait:e.Nowait!==void 0,...automatorBlocksMap[`STUDIES LOAD`]})},{id:`studiesRespec`,rule:e=>()=>{e.CONSUME(J.Studies),e.CONSUME(J.Respec)},validate:e=>(e.startLine=e.Studies[0].startLine,!0),compile:e=>()=>(player.respec=!0,AutomatorData.logCommandEvent(`Turned study respec ON`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION),blockify:()=>automatorBlocksMap[`STUDIES RESPEC`]},{id:`unlockDilation`,rule:e=>()=>{e.CONSUME(J.Unlock),e.OPTION(()=>e.CONSUME(J.Nowait)),e.CONSUME(J.Dilation)},validate:e=>(e.startLine=e.Unlock[0].startLine,!0),compile:e=>{let t=e.Nowait!==void 0;return()=>PlayerProgress.dilationUnlocked()?(AutomatorData.logCommandEvent(`Skipped dilation unlock due to being already unlocked`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):TimeStudy.dilation.purchase(!0)?(AutomatorData.logCommandEvent(`Unlocked Dilation`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):t?(AutomatorData.logCommandEvent(`Skipped dilation unlock due to lack of requirements (NOWAIT)`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION},blockify:e=>({singleSelectionInput:`DILATION`,nowait:e.Nowait!==void 0,...automatorBlocksMap.UNLOCK})},{id:`unlockEC`,rule:e=>()=>{e.CONSUME(J.Unlock),e.OPTION(()=>e.CONSUME(J.Nowait)),e.SUBRULE(e.eternityChallenge)},validate:e=>(e.startLine=e.Unlock[0].startLine,!0),compile:e=>{let t=e.Nowait!==void 0,n=e.eternityChallenge[0].children.$ecNumber;return()=>EternityChallenge(n).isUnlocked?(AutomatorData.logCommandEvent(`Skipped EC ${n} unlock due to being already unlocked`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):t?(AutomatorData.logCommandEvent(`EC ${n} unlock failed and skipped (NOWAIT)`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):TimeStudy.eternityChallenge(n).purchase(!0)?(AutomatorData.logCommandEvent(`EC ${n} unlocked`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION},blockify:e=>({singleSelectionInput:`EC`,singleTextInput:e.eternityChallenge[0].children.$ecNumber,nowait:e.Nowait!==void 0,...automatorBlocksMap.UNLOCK})},{id:`untilLoop`,rule:e=>()=>{e.CONSUME(J.Until),e.OR([{ALT:()=>e.SUBRULE(e.comparison)},{ALT:()=>e.CONSUME(J.PrestigeEvent)}]),e.CONSUME(J.LCurly),e.CONSUME(J.EOL),e.SUBRULE(e.block),e.CONSUME(J.RCurly)},validate:(e,t)=>(e.startLine=e.Until[0].startLine,t.checkBlock(e,e.Until)),compile:(e,t)=>{let n=t.visit(e.block);if(e.comparison){let r=t.visit(e.comparison);return Be(()=>!r(),n,e,!0)}let r=e.PrestigeEvent[0].tokenType.$prestigeLevel,i;switch(e.PrestigeEvent[0].tokenType){case J.Infinity:i=`Infinity`;break;case J.Eternity:i=`Eternity`;break;case J.Reality:i=`Reality`;break;default:throw Error(`Unrecognized prestige layer in until loop`)}return{run:t=>(t.commandState===null&&(t.commandState={prestigeLevel:0}),t.commandState.prestigeLevel>=r?(AutomatorData.logCommandEvent(`${i} prestige has occurred, exiting until loop`,e.startLine),AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION):(AutomatorBackend.push(n),AutomatorData.logCommandEvent(`${i} prestige has not occurred yet, moving to line
            ${AutomatorBackend.translateLineNumber(e.LCurly[0].startLine+1)} (start of until loop)`,e.startLine),AUTOMATOR_COMMAND_STATUS.SAME_INSTRUCTION)),blockCommands:n}},blockify:(e,t)=>{let n=[];t.visit(e.block,n);let r=t.visit(e.comparison);return e.comparison?{nest:n,...automatorBlocksMap.UNTIL,...r,genericInput1:Pe(r.genericInput1),genericInput2:Pe(r.genericInput2)}:{genericInput1:e.PrestigeEvent[0].tokenType.name.toUpperCase(),nest:n,...automatorBlocksMap.UNTIL}}},{id:`waitCondition`,rule:e=>()=>{e.CONSUME(J.Wait),e.SUBRULE(e.comparison)},validate:e=>(e.startLine=e.Wait[0].startLine,!0),compile:(e,t)=>()=>{if(t.visit(e.comparison)()){let t=TimeSpan.fromMilliseconds(new Decimal(Date.now()-AutomatorData.waitStart)).toStringShort();return AutomatorData.isWaiting?AutomatorData.logCommandEvent(`Continuing after WAIT
            (${Ve(e)} is true, after ${t})`,e.startLine):AutomatorData.logCommandEvent(`WAIT skipped (${Ve(e)} is already true)`,e.startLine),AutomatorData.isWaiting=!1,AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION}return AutomatorData.isWaiting||(AutomatorData.logCommandEvent(`Started WAIT for ${Ve(e)}`,e.startLine),AutomatorData.waitStart=Date.now()),AutomatorData.isWaiting=!0,AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION},blockify:(e,t)=>{let n=[];t.visit(e.block,n);let r=t.visit(e.comparison);return{nest:n,...automatorBlocksMap.WAIT,...r,genericInput1:Pe(r.genericInput1),genericInput2:Pe(r.genericInput2)}}},{id:`waitEvent`,rule:e=>()=>{e.CONSUME(J.Wait),e.CONSUME(J.PrestigeEvent)},validate:e=>(e.startLine=e.Wait[0].startLine,!0),compile:e=>{let t=e.PrestigeEvent[0].tokenType.$prestigeLevel;return n=>{n.commandState===null&&(n.commandState={prestigeLevel:0});let r=n.commandState.prestigeLevel>=t,i=e.PrestigeEvent[0].image.toUpperCase();if(r){let t=TimeSpan.fromMilliseconds(new Decimal(Date.now()-AutomatorData.waitStart)).toStringShort();return AutomatorData.logCommandEvent(`Continuing after WAIT (${i} occurred for
            ${He(i)}, after ${t})`,e.startLine),AutomatorData.isWaiting=!1,AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION}return AutomatorData.isWaiting||(AutomatorData.logCommandEvent(`Started WAIT for ${i}`,e.startLine),AutomatorData.waitStart=Date.now()),AutomatorData.isWaiting=!0,AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION}},blockify:e=>({genericInput1:e.PrestigeEvent[0].tokenType.name.toUpperCase(),...automatorBlocksMap.WAIT})},{id:`waitBlackHole`,rule:e=>()=>{e.CONSUME(J.Wait),e.CONSUME(J.BlackHole),e.OR([{ALT:()=>e.CONSUME(J.Off)},{ALT:()=>e.CONSUME(J.BlackHoleStr)}])},validate:e=>(e.startLine=e.Wait[0].startLine,!0),compile:e=>()=>{let t=!!e.Off,n=e.BlackHoleStr?Number(e.BlackHoleStr[0].image.charAt(2)):0,r=t?!BlackHole(1).isActive:BlackHole(n).isActive,i=t?`inactive Black Holes`:`active Black Hole ${n}`;if(r){let t=TimeSpan.fromMilliseconds(new Decimal(Date.now()-AutomatorData.waitStart)).toStringShort();return AutomatorData.logCommandEvent(`Continuing after WAIT (waited ${t} for ${i})`,e.startLine),AutomatorData.isWaiting=!1,AUTOMATOR_COMMAND_STATUS.NEXT_INSTRUCTION}return AutomatorData.isWaiting||(AutomatorData.logCommandEvent(`Started WAIT for ${i}`,e.startLine),AutomatorData.waitStart=Date.now()),AutomatorData.isWaiting=!0,AUTOMATOR_COMMAND_STATUS.NEXT_TICK_SAME_INSTRUCTION},blockify:e=>({genericInput1:`BLACK HOLE`,compOperator:e.BlackHoleStr?e.BlackHoleStr[0].image.toUpperCase():`OFF`,...automatorBlocksMap.WAIT})},{id:`whileLoop`,rule:e=>()=>{e.CONSUME(J.While),e.SUBRULE(e.comparison),e.CONSUME(J.LCurly),e.CONSUME(J.EOL),e.SUBRULE(e.block),e.CONSUME(J.RCurly)},validate:(e,t)=>(e.startLine=e.While[0].startLine,t.checkBlock(e,e.While)),compile:(e,t)=>Be(t.visit(e.comparison),t.visit(e.block),e,!1),blockify:(e,t)=>{let n=[];t.visit(e.block,n);let r=t.visit(e.comparison);return{nest:n,...automatorBlocksMap.WHILE,...r,genericInput1:Pe(r.genericInput1),genericInput2:Pe(r.genericInput2)}}},{id:`stop`,rule:e=>()=>{e.CONSUME(J.Stop)},validate:e=>(e.startLine=e.Stop[0].startLine,!0),compile:e=>()=>(AutomatorData.logCommandEvent(`Automator execution stopped with STOP command`,e.startLine),AUTOMATOR_COMMAND_STATUS.HALT),blockify:()=>({...automatorBlocksMap.STOP})}];var We=e(z());const Ge=new class extends We.Parser{constructor(){super(Ae,{recoveryEnabled:!0,outputCst:!0,nodeLocationTracking:`full`});let e=this;e.RULE(`script`,()=>e.SUBRULE(e.block)),e.RULE(`block`,()=>e.MANY_SEP({SEP:J.EOL,DEF:()=>e.OPTION(()=>e.SUBRULE(e.command))}));let t=[`$.SUBRULE($.badCommand)`,`$.CONSUME(EOF)`];for(let n of Ue)e.RULE(n.id,n.rule(e)),t.push(`$.SUBRULE($.${n.id})`);let n=(window.Function(`$`,`EOF`,`
      return () => $.OR($.c1 || ($.c1 = [
        ${t.map(e=>`{ ALT: () => ${e} },`).join(`
`)}]));
    `));e.RULE(`command`,n(e,We.EOF)),e.RULE(`badCommand`,()=>e.AT_LEAST_ONE(()=>e.SUBRULE(e.badCommandToken)),{resyncEnabled:!1}),e.RULE(`badCommandToken`,()=>e.OR([{ALT:()=>e.CONSUME(J.Identifier)},{ALT:()=>e.CONSUME(J.NumberLiteral)},{ALT:()=>e.CONSUME(J.ComparisonOperator)}]),{resyncEnabled:!1}),e.RULE(`comparison`,()=>{e.SUBRULE(e.compareValue),e.CONSUME(J.ComparisonOperator),e.SUBRULE2(e.compareValue)}),e.RULE(`compareValue`,()=>e.OR([{ALT:()=>e.CONSUME(J.NumberLiteral)},{ALT:()=>e.CONSUME(J.Identifier)},{ALT:()=>e.CONSUME(J.AutomatorCurrency)}])),e.RULE(`duration`,()=>{e.CONSUME(J.NumberLiteral),e.CONSUME(J.TimeUnit)}),e.RULE(`eternityChallenge`,()=>e.OR([{ALT:()=>{e.CONSUME(J.EC),e.CONSUME(J.NumberLiteral)}},{ALT:()=>e.CONSUME(J.ECLiteral)}])),e.RULE(`studyList`,()=>{e.AT_LEAST_ONE(()=>e.SUBRULE(e.studyListEntry)),e.OPTION(()=>{e.CONSUME(J.Pipe),e.CONSUME1(J.NumberLiteral,{LABEL:`ECNumber`}),e.OPTION1(()=>e.CONSUME(J.Exclamation))})},{resyncEnabled:!1}),e.RULE(`studyListEntry`,()=>{e.OR([{ALT:()=>e.SUBRULE(e.studyRange)},{ALT:()=>e.CONSUME(J.NumberLiteral)},{ALT:()=>e.CONSUME(J.StudyPath)}]),e.OPTION(()=>e.CONSUME(J.Comma))}),e.RULE(`studyRange`,()=>{e.CONSUME(J.NumberLiteral,{LABEL:`firstStudy`}),e.CONSUME(J.Dash),e.CONSUME1(J.NumberLiteral,{LABEL:`lastStudy`})}),e.RULE(`xHighest`,()=>{e.CONSUME(J.NumberLiteral),e.CONSUME(J.XHighest)}),e.RULE(`currencyAmount`,()=>{e.CONSUME(J.NumberLiteral),e.CONSUME(J.AutomatorCurrency)}),e.performSelfAnalysis()}};var Ke=Ge.getBaseCstVisitorConstructorWithDefaults(),qe=class e extends Ke{constructor(e){super(),this.validateVisitor(),this.reset(e);for(let e of Ue){if(!e.validate)continue;let t=this[e.id];this[e.id]=n=>{e.validate(n,this)&&t&&t.call(this,n)}}let t=je.tokenize(e),n=t.tokens;Ge.input=n,this.parseResult=Ge.script(),this.visit(this.parseResult),this.addLexerErrors(t.errors),this.addParserErrors(Ge.errors,n),this.modifyErrorMessages(),this.errorCount=t.errors.length+this.errors.length+Ge.errors.length}addLexerErrors(e){for(let t of e)this.errors.push({startLine:t.line,startOffset:t.offset,endOffset:t.offset+t.length,info:`Unexpected characters: ${this.rawText.slice(t.offset,t.length)}`,tip:`${this.rawText.slice(t.offset,t.length)} cannot be part of a command, remove them`})}static combinePositionRanges(e,t){return{startLine:Math.min(e.startLine,t.startLine),startOffset:Math.min(e.startOffset,t.startOffset),endOffset:Math.max(e.endOffset,t.endOffset)}}addParserErrors(t,n){for(let r of t){let t=e.combinePositionRanges(e.getPositionRange(r.previousToken),e.getPositionRange(r.token));r.token.tokenType.name===`EOF`&&r.previousToken.tokenType.name===`EOF`&&(t=e.combinePositionRanges(t,e.getPositionRange(n[n.length-1]))),t.info=r.message.replace(/'\n\s*'/iu,`End of line`);let i=r.token.tokenType.name===`EOF`||r.token.tokenType.name===`EOL`;r.name===`NoViableAltException`?i||(t.info=`Unexpected input ${r.token.image}`,t.tip=`Remove ${r.token.image}`):r.name===`EarlyExitException`&&(t.info=`Unexpected end of command`,t.tip=`Complete the command by adding the other parameters`),this.errors.push(t)}}static getPositionRange(t){let n={startLine:Number.MAX_VALUE,startOffset:Number.MAX_VALUE,endOffset:0};if(t==null)return n;if(t.startOffset!==void 0)return{startLine:t.startLine,startOffset:t.startOffset,endOffset:t.endOffset};if(t.location!==void 0&&t.location.startOffset!==void 0)return t.location;if(t.children&&!Array.isArray(t.children))return e.getPositionRange(t.children);if(Array.isArray(t))return t.reduce((t,n)=>e.combinePositionRanges(t,e.getPositionRange(n)),n);for(let r in t){if(!Object.hasOwn(t,r)||!Array.isArray(t[r]))continue;n=e.combinePositionRanges(n,e.getPositionRange(t[r]))}return n}addError(t,n,r){let i=e.getPositionRange(t);i.info=n,i.tip=r,this.errors.push(i)}modifyErrorMessages(){if(!Player.automatorUnlocked||AutomatorData.currentScriptText()===void 0)return;let e=[],t=0;for(let n of this.errors.sort((e,t)=>e.startLine-t.startLine)){if(isNaN(n.startLine)&&(n.startLine=AutomatorData.currentScriptText().split(`
`).length),n.startLine===t)continue;if(n.tip){e.push(n),t=n.startLine;continue}/EOF but found.*\}/gu.test(n.info)?(n.info=n.info.replaceAll(`--> `,`[`).replaceAll(` <--`,`]`),n.tip=`Remove }. Parser halted at this line and may miss errors farther down the script.`):/found.*\}/gu.test(n.info)?(n.info=n.info.replaceAll(`--> `,`[`).replaceAll(` <--`,`]`),n.tip=`Remove }`):/Expecting/gu.test(n.info)?(n.info=n.info.replaceAll(`--> `,`[`).replaceAll(` <--`,`]`),n.tip=`Use the appropriate type of data in the command as specified in the command help`):/End of line/gu.test(n.info)?n.tip=`Provide the remaining arguments to complete the incomplete command`:/EOF but found:/gu.test(n.info)?n.tip=`Remove extra command argument`:n.tip=`This error's cause is unclear`,e.push(n),t=n.startLine}for(let t of e)t.startLine=AutomatorBackend.translateLineNumber(t.startLine);this.errors=e}reset(e){this.rawText=e,this.variables={},this.errors=[]}checkTimeStudyNumber(e){let t=Number.parseFloat(e.image);return!TimeStudy(t)||TimeStudy(t).isTriad&&!Ra.canBuyTriad?(this.addError(e,`Invalid Time Study identifier ${t}`,`Make sure you copied or typed in your time study IDs correctly`),0):t}lookupVar(e,t){let n=e.image,r={},i=player.reality.automator.constants;if(!Object.keys(i).includes(n)){this.addError(e,`Variable ${n} has not been defined`,`Use the definition panel to define ${n} in order to reference it, or check for typos`);return}let a=i[n],o;switch(t){case AUTOMATOR_VAR_TYPES.NUMBER:r.value=new Decimal(a);break;case AUTOMATOR_VAR_TYPES.STUDIES:o=new TimeStudyTree(a),r.value={normal:o.selectedStudies.map(e=>e.id),ec:o.ec,startEC:o.startEC};break;case AUTOMATOR_VAR_TYPES.DURATION:r.value=Number.parseInt(1e3*a,10);break;default:throw Error(`Unrecognized variable format in automator constant lookup`)}return r}isValidVarFormat(e,t){let n=e.image,r=player.reality.automator.constants;if(!Object.keys(r).includes(n))return!1;let i=r[n];switch(t){case AUTOMATOR_VAR_TYPES.NUMBER:return i.match(/^-?(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?$/u);case AUTOMATOR_VAR_TYPES.STUDIES:return TimeStudyTree.isValidImportString(i);case AUTOMATOR_VAR_TYPES.DURATION:return!Number.isNaN(Number.parseInt(1e3*i,10));default:throw Error(`Unrecognized variable format in automator constant lookup`)}}duration(e){if(e.$value)return e.$value;if(!e.TimeUnit||e.TimeUnit[0].isInsertedInRecovery){this.addError(e,`Missing time unit`,`Provide a unit of time (eg. seconds or minutes)`);return}let t=Number.parseFloat(e.NumberLiteral[0].image)*e.TimeUnit[0].tokenType.$scale;if(isNaN(t)){this.addError(e,`Error parsing duration`,`Provide a properly-formatted number for time`);return}return e.$value=t,e.$value}xHighest(e){if(e.$value)return e.$value;if(!e.NumberLiteral||e.NumberLiteral[0].isInsertedInRecovery){this.addError(e,`Missing multiplier`,`Provide a multiplier to set the autobuyer to`);return}return e.$value=new Decimal(e.NumberLiteral[0].image),e.$value}currencyAmount(e){if(e.$value)return e.$value;if(!e.NumberLiteral||e.NumberLiteral[0].isInsertedInRecovery){this.addError(e,`Missing amount`,`Provide a threshold to set the autobuyer to`);return}return e.$value=new Decimal(e.NumberLiteral[0].image),e.$value}studyRange(e,t){if(!e.firstStudy||e.firstStudy[0].isInsertedInRecovery||!e.lastStudy||e.lastStudy[0].isInsertedInRecovery){this.addError(e,`Missing Time Study number in range`,`Provide starting and ending IDs for Time Study number ranges`);return}let n=this.checkTimeStudyNumber(e.firstStudy[0]),r=this.checkTimeStudyNumber(e.lastStudy[0]);if(!(!n||!r||!t))for(let e=n;e<=r;++e)TimeStudy(e)&&t.push(e)}studyListEntry(e,t){if(e.studyRange){this.visit(e.studyRange,t);return}if(e.NumberLiteral){if(e.NumberLiteral[0].isInsertedInRecovery){this.addError(e,`Missing Time Study number`,`Provide a Time Study ID to purchase`);return}let n=this.checkTimeStudyNumber(e.NumberLiteral[0]);n&&t.push(n);return}if(e.StudyPath){let n=e.StudyPath[0].tokenType.$studyPath,r=NormalTimeStudies.paths[n];t.push(...r)}}studyList(t){if(t.$cached!==void 0)return t.$cached;let n=[];for(let e of t.studyListEntry)this.visit(e,n);let r=e.getPositionRange(t);if(t.$cached={normal:n,image:this.rawText.slice(r.startOffset,r.endOffset-r.startOffset+1),ec:0,startEC:!1},t.ECNumber){t.ECNumber.isInsertedInRecovery&&this.addError(t.Pipe[0],`Missing Eternity Challenge number`,`Specify which Eternity Challenge is being referred to`);let e=Number.parseFloat(t.ECNumber[0].image);(!Number.isInteger(e)||e<0||e>12)&&this.addError(t.ECNumber,`Invalid Eternity Challenge ID ${e}`,`Eternity Challenge ${e} does not exist, use an integer between ${format(1)} and ${format(12)}`),t.$cached.ec=e}return t.Exclamation&&(t.$cached.startEC=!0),t.$cached}compareValue(e){e.NumberLiteral?e.$value=new Decimal(e.NumberLiteral[0].image):e.Identifier&&(this.isValidVarFormat(e.Identifier[0],AUTOMATOR_VAR_TYPES.NUMBER)||this.addError(e,`Constant ${e.Identifier[0].image} cannot be used for comparison`,`Ensure that ${e.Identifier[0].image} contains a properly-formatted number and not a Time Study string`),this.lookupVar(e.Identifier[0],AUTOMATOR_VAR_TYPES.NUMBER)&&(e.$value=e.Identifier[0].image))}comparison(e){if(super.comparison(e),(!e.compareValue||e.compareValue[0].recoveredNode||e.compareValue.length!==2||e.compareValue[1].recoveredNode)&&this.addError(e,`Missing value for comparison`,`Ensure that the comparison has two values`),!e.ComparisonOperator||e.ComparisonOperator[0].isInsertedInRecovery){this.addError(e,`Missing comparison operator (<, >, <=, >=)`,`Insert the appropriate comparison operator`);return}(e.ComparisonOperator[0].tokenType===J.OpEQ||e.ComparisonOperator[0].tokenType===J.EqualSign)&&this.addError(e,`Please use an inequality comparison (>, <, >=, <=)`,`Comparisons cannot be done with equality, only with inequality operators`)}badCommand(e){let t=e.badCommandToken[0].children,n=Object.keys(t)[0];this.addError(t[n][0],`Unrecognized command "${t[n][0].image}"`,`Check to make sure you have typed in the command name correctly`)}eternityChallenge(e){let t,n;if(e.ECLiteral)n=Number.parseFloat(e.ECLiteral[0].image.slice(2)),t=e.ECLiteral[0];else if(e.NumberLiteral)n=Number.parseFloat(e.NumberLiteral[0].image),t=e.NumberLiteral[0];else{this.addError(e,`Missing Eternity Challenge number`,`Specify which Eternity Challenge is being referred to`);return}(!Number.isInteger(n)||n<1||n>12)&&this.addError(t,`Invalid Eternity Challenge ID ${n}`,`Eternity Challenge ${n} does not exist, use an integer between ${format(1)} and ${format(12)}`),e.$ecNumber=n}checkBlock(e,t){let n=!1;return(!e.RCurly||e.RCurly[0].isInsertedInRecovery)&&(this.addError(t[0],`Missing closing }`,`This loop has mismatched brackets, add a corresponding } on another line to close the loop`),n=!0),(!e.LCurly||e.LCurly[0].isInsertedInRecovery)&&(this.addError(t[0],`Missing opening {`,`This line has an extra } closing a loop which does not exist, remove the }`),n=!0),!n}script(e){e.block&&this.visit(e.block),e.variables=this.variables}},Je=class extends Ke{constructor(){super();for(let e of Ue){if(!e.compile)continue;let t=this[e.id];this[e.id]=(n,r)=>{t&&t!==super[e.id]&&t.call(this,n,r);let i=e.compile(n,this);typeof i==`function`&&(i={run:i}),i.lineNumber=n.startLine,r.push(i)}}this.validateVisitor()}comparison(e){let t=e.compareValue.map(e=>{if(e.children.AutomatorCurrency)return e.children.AutomatorCurrency[0].tokenType.$getter;let t=e.children.$value;return typeof t==`string`?()=>player.reality.automator.constants[t]:()=>t}),n=e.compareValue.map(e=>{if(e.children.AutomatorCurrency){let t=e.children.AutomatorCurrency[0].tokenType.$unlocked;return t?t():!0}return!0});if(!n[0]||!n[1])return()=>!1;let r=e.ComparisonOperator[0].tokenType.$compare;return()=>r(t[0](),t[1]())}block(e){let t=[];if(e.command)for(let n of e.command)this.visit(n,t);return t}script(e){if(e.variables===void 0)throw Error(`Compiler called before Validator`);return e.block?this.visit(e.block):[]}},Ye=class extends Ke{constructor(){super();for(let e of Ue){let t=e.blockify;if(!t)continue;let n=this[e.id];this[e.id]=(r,i)=>{n&&n!==super[e.id]&&n.call(this,r,i);try{let e=t(r,this);i.push({...e,id:UIID.next()})}catch{}}}this.validateVisitor()}comparison(e){let t=t=>{let n=e.compareValue[t];return n.children.AutomatorCurrency?n.children.AutomatorCurrency[0].image:n.children.$value};return{compOperator:e.ComparisonOperator[0].image,genericInput1:t(0),genericInput2:t(1)}}script(e){let t=[];return e.block&&this.visit(e.block,t),t}block(e,t){if(e.command)for(let n of e.command)this.visit(n,t)}};function Xe(e,t=!1){let n=`${e}\n `,r=new qe(n),i;return r.errorCount===0&&!t&&(i=new Je().visit(r.parseResult)),{errors:r.errors,compiled:i}}function Ze(e){return Xe(e,!0).errors.length>0}function Qe(e){let t=new qe(e),n=new Ye().visit(t.parseResult),r=e=>{if(!e)return 0;let t=e.children,n=0;for(let e of Object.keys(t)){let i=t[e][0]?.children?.block,a=i?i[0].children.command:[];if(n+=a?a.map(e=>r(e)+1).reduce((e,t)=>e+t,0):0,e===`EOF`)return-1}return n},i=e=>e.nest?1+e.nest.map(e=>i(e)).reduce((e,t)=>e+t,0):1,a=t.parseResult.children.block[0].children.command.map(e=>r(e)+1).reduce((e,t)=>e+t,0),o=n.map(e=>i(e)).reduce((e,t)=>e+t,0);return{blocks:n,validatedBlocks:a,visitedBlocks:o}}function $e(e){return new qe(e)}function et(e,t,n){let r=e.$autocomplete&&e.$autocomplete.startsWith(t)&&e.$autocomplete!==t,i=e.$unlocked?e.$unlocked():!0;r&&i&&n.add(e.$autocomplete);for(let r of e.categoryMatches)et(Me[r],t,n)}CodeMirror.registerHelper(`lint`,`automato`,(e,t,n)=>{let r=n.getDoc();return Xe(e,!0).errors.map(e=>({message:e.info,severity:`error`,from:r.posFromIndex(e.startOffset),to:r.posFromIndex(e.endOffset+1)}))}),CodeMirror.registerHelper(`hint`,`anyword`,e=>{let t=e.getDoc().getCursor(),n=t.ch,r=t.ch,i=e.getLine(t.line);for(;n&&/\w/u.test(i.charAt(n-1));)--n;let a=i.slice(0,n),o=i.slice(n,r),s=je.tokenize(a);if(s.errors.length>0)return;let c=Ge.computeContentAssist(`command`,s.tokens),l=new Set;for(let e of c){if(e.ruleStack[1]===`badCommand`)continue;et(e.nextTokenType,o,l)}return{list:[...l],from:CodeMirror.Pos(t.line,n),to:CodeMirror.Pos(t.line,r)}});var tt={regex:/(\/\/|#).*/u,token:`comment`,next:`start`};CodeMirror.defineSimpleMode(`automato`,{start:[tt,{regex:/studies\s+/iu,token:`keyword`,next:`studiesArgs`},{regex:/blob\s\s/iu,token:`blob`},{regex:/(auto|if|pause|studies|time[ \t]+theorems?|space[ \t]+theorems?|until|wait|while|black[ \t]+hole|stored?[ \t]+game[ \t]+time|notify)\s/iu,token:`keyword`,next:`commandArgs`},{regex:/stop/iu,token:`keyword`,next:`commandDone`},{regex:/start\s|unlock\s/iu,token:`keyword`,next:`startUnlock`},{regex:/infinity\S+|eternity\S+|reality\S+|pause\S+|restart\S+/iu,token:`error`,next:`commandDone`},{regex:/infinity|eternity|reality/iu,token:`keyword`,next:`prestige`},{regex:/pause|restart/iu,token:`keyword`,next:`commandDone`},{regex:/\}/iu,dedent:!0},{regex:/\S+\s/iu,token:`error`,next:`commandDone`}],studiesArgs:[tt,{sol:!0,next:`start`},{regex:/load(\s+|$)/iu,token:`variable-2`,next:`studiesLoad`},{regex:/respec/iu,token:`variable-2`,next:`commandDone`},{regex:/purchase/iu,token:`variable-2`,next:`studiesList`},{regex:/nowait(\s+|$)/iu,token:`property`}],studiesList:[tt,{sol:!0,next:`start`},{regex:/(antimatter|infinity|time)(?=[\s,|]|$)/iu,token:`number`},{regex:/(active|passive|idle)(?=[\s,|]|$)/iu,token:`number`},{regex:/(light|dark)(?=[\s,|]|$)/iu,token:`number`},{regex:/([1-9][0-9]+)(?=[\s,!|-]|$)/iu,token:`number`},{regex:/[a-zA-Z_][a-zA-Z_0-9]*/u,token:`variable`,next:`commandDone`},{regex:/!$/iu,token:`variable-2`},{regex:/([1-9]|1[0-2])(?=!|$)/iu,token:`number`}],studiesLoad:[tt,{sol:!0,next:`start`},{regex:/id(\s+|$)/iu,token:`variable-2`,next:`studiesLoadId`},{regex:/name(\s+|$)/iu,token:`variable-2`,next:`studiesLoadPreset`},{regex:/\S+/iu,token:`error`}],studiesLoadId:[tt,{sol:!0,next:`start`},{regex:/\d/iu,token:`qualifier`,next:`commandDone`}],studiesLoadPreset:[tt,{sol:!0,next:`start`},{regex:/(\/(?!\/)|[^\s#/])+/iu,token:`qualifier`,next:`commandDone`}],prestige:[tt,{sol:!0,next:`start`},{regex:/nowait(\s|$)/iu,token:`property`},{regex:/respec/iu,token:`variable-2`}],commandDone:[tt,{sol:!0,next:`start`},{regex:/\}/iu,dedent:!0},{regex:/\S+/iu,token:`error`}],startUnlock:[tt,{sol:!0,next:`start`},{regex:/ec\s?(1[0-2]|[1-9])|dilation/iu,token:`variable-2`,next:`commandDone`},{regex:/nowait(\s|$)/iu,token:`property`}],commandArgs:[tt,{sol:!0,next:`start`},{regex:/<=|>=|<|>/iu,token:`operator`},{regex:/nowait(\s|$)/iu,token:`property`},{regex:/".*"/iu,token:`string`,next:`commandDone`},{regex:/'.*'/iu,token:`string`,next:`commandDone`},{regex:/(on|off|bh1|bh2|dilation|load|respec)(\s|$)/iu,token:`variable-2`},{regex:/(eternity|reality|use)(\s|$)/iu,token:`variable-2`},{regex:/(antimatter|infinity|time)(\s|$|(?=,))/iu,token:`variable-2`},{regex:/(active|passive|idle)(\s|$|(?=,))/iu,token:`variable-2`},{regex:/(light|dark)(\s|$|(?=,))/iu,token:`variable-2`},{regex:/x[\t ]+highest(\s|$)/iu,token:`variable-2`},{regex:/pending[\t ]+(completions|ip|ep|tp|rm|glyph[\t ]+level)(\s|$)/iu,token:`variable-2`},{regex:/total[\t ]+(completions|tt|space theorems)(\s|$)/iu,token:`variable-2`},{regex:/filter[ \t]+score/iu,token:`variable-2`},{regex:/ec(1[0-2]|[1-9])[\t ]+completions(\s|$)/iu,token:`variable-2`},{regex:/(am|ip|ep|all)(\s|$)/iu,token:`variable-2`},{regex:/(rm|rg|dt|tp|tt|space theorems|(banked )?infinities|eternities|realities|rep(licanti)?)(\s|$)/iu,token:`variable-2`},{regex:/ sec(onds ?) ?| min(utes ?) ?| hours ?/iu,token:`variable-2`},{regex:/([0-9]+:[0-5][0-9]:[0-5][0-9]|[0-5]?[0-9]:[0-5][0-9]|t[1-4])/iu,token:`number`},{regex:/-?(0|[1-9]\d*)(\.\d+)?([eE][+-]?\d+)?/iu,token:`number`},{regex:/[a-zA-Z_][a-zA-Z_0-9]*/u,token:`variable`},{regex:/\{/iu,indent:!0,next:`commandDone`},{regex:/\}/iu,dedent:!0}],meta:{lineComment:`//`,electricChars:`}`}});const Y=Object.freeze({NEXT_INSTRUCTION:0,NEXT_TICK_SAME_INSTRUCTION:1,NEXT_TICK_NEXT_INSTRUCTION:2,SAME_INSTRUCTION:3,SKIP_INSTRUCTION:4,HALT:5,RESTART:6}),X=Object.freeze({PAUSE:1,RUN:2,SINGLE_STEP:3}),nt={NUMBER:{id:0,name:`number`},STUDIES:{id:1,name:`studies`},DURATION:{id:2,name:`duration`},UNKNOWN:{id:-1,name:`unknown`}},Z=Object.freeze({TEXT:0,BLOCK:1});var rt=class{constructor(e){this._stackIndex=e,this._commandIndex=0}initializeNew(e){this._commands=e,this._commandIndex=0,this.persistent={lineNumber:e[0].lineNumber,commandState:null}}get commandIndex(){return this._commandIndex}set commandIndex(e){this._commandIndex=e,this.lineNumber=this._commands[e].lineNumber}get lineNumber(){return this.persistent.lineNumber}set lineNumber(e){this.persistent.lineNumber=e}get commandState(){return this.persistent.commandState}set commandState(e){this.persistent.commandState=e}get persistent(){return player.reality.automator.state.stack[this._stackIndex]}set persistent(e){player.reality.automator.state.stack[this._stackIndex]=e}get commands(){return this._commands}set commands(e){this._commands=e}},it=class e{constructor(e){this._id=e,this.compile()}get id(){return this._id}get name(){return this.persistent.name}set name(e){this.persistent.name=e}get persistent(){return player.reality.automator.scripts[this._id]}get commands(){return this._compiled}get text(){return this.persistent.content}save(e){Q.isWithinLimit()&&(this.persistent.content=e),this.compile()}compile(){this._compiled=Xe(this.text).compiled}static create(t,n=``){let r=Object.keys(player.reality.automator.scripts),i=r.findIndex((e,t)=>t+1!==Number(e)),a=1+(i===-1?r.length:i);return(!player.reality.automator.scripts||a===0)&&(a=1),player.reality.automator.scripts[a]={id:a,name:t,content:n},new e(a)}};const Q={lastECCompletionCount:0,isWaiting:!1,waitStart:0,lastEvent:0,eventLog:[],isEditorFullscreen:!1,needsRecompile:!0,cachedErrors:0,blockTemplates:[],undoBuffer:[],redoBuffer:[],charsSinceLastUndoState:0,MAX_ALLOWED_SCRIPT_CHARACTERS:1e4,MAX_ALLOWED_TOTAL_CHARACTERS:6e4,MAX_ALLOWED_SCRIPT_NAME_LENGTH:15,MAX_ALLOWED_SCRIPT_COUNT:20,MAX_ALLOWED_CONSTANT_NAME_LENGTH:20,MAX_ALLOWED_CONSTANT_VALUE_LENGTH:250,MAX_ALLOWED_CONSTANT_COUNT:30,MIN_CHARS_BETWEEN_UNDOS:10,MAX_UNDO_ENTRIES:30,scriptIndex(){return player.reality.automator.state.editorScript},currentScriptName(){return player.reality.automator.scripts[this.scriptIndex()].name},currentScriptText(e){let t=e||this.scriptIndex();return player.reality.automator.scripts[t]?.content},createNewScript(e,t){let n=it.create(t,e);GameUI.notify.automator(`Imported Script "${t}"`),player.reality.automator.state.editorScript=n.id,Q.clearUndoData(),EventHub.dispatch(GAME_EVENT.AUTOMATOR_SAVE_CHANGED)},recalculateErrors(){let e=this.currentScriptText();this.cachedErrors=Xe(e).errors,this.cachedErrors.sort((e,t)=>e.startLine-t.startLine)},currentErrors(){return this.needsRecompile&&=(this.recalculateErrors(),!1),this.cachedErrors},logCommandEvent(e,t){let n=Date.now();this.eventLog.push({message:e.replaceAll(/\s?\n\s+/gu,` `),line:ct.translateLineNumber(t),thisReality:Time.thisRealityRealTime.totalSeconds,timestamp:n,timegap:n-this.lastEvent}),this.lastEvent=n,this.eventLog.length>player.options.automatorEvents.maxEntries&&this.eventLog.shift()},clearEventLog(){this.eventLog=[],this.lastEvent=0},singleScriptCharacters(){return player.reality.automator.type===Z.TEXT?AutomatorTextUI.editor?.getDoc().getValue().length??0:BlockAutomator.parseLines(BlockAutomator.lines).join(`
`).length},totalScriptCharacters(){return Object.values(player.reality.automator.scripts).filter(e=>e.id!==this.scriptIndex()).map(e=>e.content.length).reduce((e,t)=>e+t,0)+this.singleScriptCharacters()},isWithinLimit(){return this.singleScriptCharacters()<=this.MAX_ALLOWED_SCRIPT_CHARACTERS&&this.totalScriptCharacters()<=this.MAX_ALLOWED_TOTAL_CHARACTERS},clearUndoData(){this.undoBuffer=[],this.redoBuffer=[],this.charsSinceLastUndoState=0},pushUndoData(e,t){this.charsSinceLastUndoState+=t,!(this.charsSinceLastUndoState<=this.MIN_CHARS_BETWEEN_UNDOS&&this.undoBuffer.length>0)&&(this.undoBuffer[this.undoBuffer.length-1]!==e&&this.undoBuffer.push(e),this.undoBuffer.length>this.MAX_UNDO_ENTRIES&&this.undoBuffer.shift(),this.charsSinceLastUndoState=0)},pushRedoData(e){this.redoBuffer[this.redoBuffer.length-1]!==e&&this.redoBuffer.push(e)},undoScriptEdit(){if(this.undoBuffer.length===0||Tabs.current._currentSubtab.name!==`Automator`)return;let e=this.undoBuffer.pop();this.pushRedoData(this.currentScriptText()),player.reality.automator.scripts[this.scriptIndex()].content=e,ct.saveScript(this.scriptIndex(),e),player.reality.automator.type===Z.TEXT?AutomatorTextUI.editor.setValue(e):BlockAutomator.updateEditor(e)},redoScriptEdit(){if(this.redoBuffer.length===0||Tabs.current._currentSubtab.name!==`Automator`)return;let e=this.redoBuffer.pop();this.pushUndoData(this.currentScriptText(),2*this.MIN_CHARS_BETWEEN_UNDOS),player.reality.automator.scripts[this.scriptIndex()].content=e,ct.saveScript(this.scriptIndex(),e),player.reality.automator.type===Z.TEXT?AutomatorTextUI.editor.setValue(e):BlockAutomator.updateEditor(e)}},at={Active:`active`,Event:`event`,Error:`error`},ot={lines:{active:-1,event:-1,error:-1},updateHighlightedLine(e,t){if(player.reality.automator.type===Z.TEXT&&e!==-1){if(!AutomatorTextUI.editor)return;this.removeHighlightedTextLine(t),this.addHighlightedTextLine(e,t)}else this.lines[t]=e},removeHighlightedTextLine(e){let t=this.lines[e]-1;AutomatorTextUI.editor.removeLineClass(t,`background`,`c-automator-editor__${e}-line`),AutomatorTextUI.editor.removeLineClass(t,`gutter`,`c-automator-editor__${e}-line-gutter`),this.lines[e]=-1},addHighlightedTextLine(e,t){AutomatorTextUI.editor.addLineClass(e-1,`background`,`c-automator-editor__${t}-line`),AutomatorTextUI.editor.addLineClass(e-1,`gutter`,`c-automator-editor__${t}-line-gutter`),this.lines[t]=e},clearAllHighlightedLines(){for(let e of Object.values(at)){if(player.reality.automator.type===Z.TEXT&&AutomatorTextUI.editor)for(let t=0;t<AutomatorTextUI.editor.doc.size;t++)AutomatorTextUI.editor.removeLineClass(t,`background`,`c-automator-editor__${e}-line`),AutomatorTextUI.editor.removeLineClass(t,`gutter`,`c-automator-editor__${e}-line-gutter`);this.lines[e]=-1}}},st={scrollToRawLine(e){let t=player.reality.automator.type===Z.TEXT?e:ct.translateLineNumber(e);this.scrollToLine(t)},scrollToLine(e){let t,n,r;if(player.reality.automator.type===Z.TEXT?(t=document.querySelector(`.CodeMirror-scroll`),n=AutomatorTextUI.editor.defaultTextHeight(),r=e+1):(t=BlockAutomator.editor,n=34.5,r=e),!t)return;let i=t.clientHeight-40,a=n*(r-1);a>t.scrollTop+i&&t.scrollTo(0,a-i),a<t.scrollTop&&t.scrollTo(0,a),player.reality.automator.type===Z.BLOCK&&(BlockAutomator.gutter.style.bottom=`${t.scrollTop}px`)}},ct={MAX_COMMANDS_PER_UPDATE:100,hasJustCompleted:!1,_scripts:[],get state(){return player.reality.automator.state},get isOn(){return!this.stack.isEmpty},get mode(){return this.state.mode},set mode(e){this.state.mode=e},get isRunning(){return this.isOn&&this.mode===X.RUN},findRawScriptObject(e){let t=player.reality.automator.scripts,n=Object.values(t).findIndex(t=>t.id===e);return t[Number.parseInt(Object.keys(t)[n],10)]},get currentRunningScript(){return this.findRawScriptObject(this.state.topLevelScript)},get currentEditingScript(){return this.findRawScriptObject(player.reality.automator.state.editorScript)},get scriptName(){return this.currentRunningScript?.name??``},hasDuplicateName(e){return Object.values(player.reality.automator.scripts).map(e=>e.name).filter(t=>t===e).length>1},translateLineNumber(e){return player.reality.automator.type===Z.TEXT?e:BlockAutomator.lineNumber(e)},get currentLineNumber(){return this.stack.top?this.translateLineNumber(this.stack.top.lineNumber):-1},get currentInterval(){return Decimal.clampMin(Decimal.pow(.994,Currency.realities.value).mul(500),1)},get currentRawText(){return this.currentRunningScript?.content??``},get currentScriptLength(){return this.currentRawText.split(`
`).length},getUsedPresets(e){let t=this.findRawScriptObject(e);if(!t)return null;let n=new Set,r=t.content.split(`
`);for(let e of r){let t=e.match(/studies( nowait)? load id ([1-6])/iu);t&&n.add(Number(t[2])-1);let r=e.match(/studies( nowait)? load name (\S+)/iu);if(r){let e=player.timestudy.presets.findIndex(e=>e.name===r[2]);e!==-1&&n.add(e)}}let i=[...n];return i.sort(),i},getUsedConstants(e){let t=this.findRawScriptObject(e);if(!t)return null;let n=new Set,r=t.content.split(`
`);for(let e of r){let t=Object.keys(player.reality.automator.constants);for(let r of t)`(?<![Nn][Aa][Mm][Ee])\\s${r}(\\s|$)`.test(e)&&n.add(r)}let i=[...n];return i.sort(),i},addConstant(e,t){Object.keys(player.reality.automator.constants).length>=Q.MAX_ALLOWED_CONSTANT_COUNT||(player.reality.automator.constants[e]=t,player.reality.automator.constantSortOrder.push(e),EventHub.dispatch(GAME_EVENT.AUTOMATOR_CONSTANT_CHANGED))},modifyConstant(e,t){Object.keys(player.reality.automator.constants).includes(e)?(player.reality.automator.constants[e]=t,EventHub.dispatch(GAME_EVENT.AUTOMATOR_CONSTANT_CHANGED)):this.addConstant(e,t)},renameConstant(e,t){let n=player.reality.automator.constants[e];player.reality.automator.constants[t]=n,delete player.reality.automator.constants[e];let r=player.reality.automator.constantSortOrder.indexOf(e);r!==-1&&(player.reality.automator.constantSortOrder[r]=t),EventHub.dispatch(GAME_EVENT.AUTOMATOR_CONSTANT_CHANGED)},deleteConstant(e){delete player.reality.automator.constants[e];let t=player.reality.automator.constantSortOrder.indexOf(e);t>-1&&player.reality.automator.constantSortOrder.splice(t,1),EventHub.dispatch(GAME_EVENT.AUTOMATOR_CONSTANT_CHANGED)},serializeAutomatorData(e){let t=e=>`0000${e}`.slice(-5),n=[];for(let r of e)n.push(`${t(r.length)}${r}`);return n.join(``)},deserializeAutomatorData(e){if(e===``)throw Error(`Attempted deserialization of empty string`);let t=[],n=e;for(;n.length>0;){let e=Number(n.slice(0,5));if(n=n.slice(5),Number.isNaN(e)||n.length<e)throw Error(`Inconsistent or malformed serialized automator data`);{let r=n.slice(0,e);n=n.slice(e),t.push(r)}}return t},exportCurrentScriptContents(){let e=Q.currentScriptText().replace(/^\s*(.*?)\s*$/u,`$1`);if(e.length===0)return null;let t=Q.currentScriptName();return GameSaveSerializer.encodeText(this.serializeAutomatorData([t,e]),`automator script`)},parseScriptContents(e){let t,n;try{t=GameSaveSerializer.decodeText(e,`automator script`),n=this.deserializeAutomatorData(t)}catch{return null}return{name:n[0],content:n[1]}},importScriptContents(e){let t=this.parseScriptContents(e);Q.createNewScript(t.content,t.name),this.initializeFromSave()},exportFullScriptData(e){let t=this.findRawScriptObject(e),n=t.content.replace(/^\s*(.*?)\s*$/u,`$1`);if(n.length===0)return null;let r=new Set,i=new Set,a=n.split(`
`);for(let e of a){let t=e.match(/studies( nowait)? load id ([1-6])/iu);t&&r.add(Number(t[2])-1);let n=e.match(/studies( nowait)? load name (\S+)/iu);if(n){let e=player.timestudy.presets.findIndex(e=>e.name===n[2]);e!==-1&&r.add(e)}let a=Object.keys(player.reality.automator.constants);for(let t of a)`\\s${t}(\\s|$)`.test(e)&&i.add(t)}let o=[];for(let e of[...r]){let t=player.timestudy.presets[e];o.push(`${e}:${t?.name??``}:${t?.studies??``}`)}let s=[];for(let e of[...i])s.push(`${e}:${player.reality.automator.constants[e]}`);let c=this.serializeAutomatorData([t.name,o.join(`*`),s.join(`*`),n]);return GameSaveSerializer.encodeText(c,`automator data`)},parseFullScriptData(e){let t,n;try{t=GameSaveSerializer.decodeText(e,`automator data`),n=this.deserializeAutomatorData(t)}catch{return null}if(n.length!==4)return null;let r=n[1],i=[];if(r)for(let e of r.split(`*`)){let t=e.split(`:`);i.push({id:Number(t[0]),name:t[1],studies:t[2]})}i.sort((e,t)=>e.id-t.id);let a=n[2],o=[];for(let e of a.split(`*`)){if(e===``)continue;let t=e.split(`:`);o.push({key:t[0],value:t[1]})}return{name:n[0],presets:i,constants:o,content:n[3]}},importFullScriptData(e,t){let n=this.parseFullScriptData(e);if(Q.createNewScript(n.content,n.name),!t.presets)for(let e of n.presets)player.timestudy.presets[e.id]={name:e.name,studies:e.studies};if(!t.constants)for(let e of n.constants)this.modifyConstant(e.key,e.value);this.initializeFromSave()},update(e){if(!this.isOn)return;let t;switch(this.mode){case X.PAUSE:return;case X.SINGLE_STEP:this.singleStep(),t=ct.stack.top,t&&this.state.followExecution&&st.scrollToRawLine(t.lineNumber),this.state.mode=X.PAUSE;return;case X.RUN:break;default:this.stop();return}player.reality.automator.execTimer+=e;let n=Math.min(Math.floor(player.reality.automator.execTimer/this.currentInterval.toNumber()),this.MAX_COMMANDS_PER_UPDATE);player.reality.automator.execTimer-=n*this.currentInterval.toNumber();for(let e=0;e<n&&this.isRunning&&this.step();++e);},step(){if(this.stack.isEmpty)return!1;for(let e=0;e<100&&!this.hasJustCompleted;e++){switch(this.runCurrentCommand()){case Y.SAME_INSTRUCTION:return!0;case Y.NEXT_INSTRUCTION:return this.nextCommand();case Y.NEXT_TICK_SAME_INSTRUCTION:return!1;case Y.NEXT_TICK_NEXT_INSTRUCTION:return this.nextCommand(),!1;case Y.SKIP_INSTRUCTION:this.nextCommand();break;case Y.HALT:return this.stop(),!1;case Y.RESTART:return this.restart(),!1}this.stack.top||(this.hasJustCompleted=!0)}return this.hasJustCompleted||(GameUI.notify.error(`Automator halted - too many consecutive no-ops detected`),Q.logCommandEvent(`Automator halted due to excessive no-op commands`,this.currentLineNumber)),this.stop(),!1},singleStep(){if(!this.stack.isEmpty)switch(this.runCurrentCommand()){case Y.NEXT_TICK_SAME_INSTRUCTION:break;case Y.HALT:this.stop();break;case Y.RESTART:this.restart();break;default:this.nextCommand();break}},runCurrentCommand(){let e=this.stack.top;return e.commands[e.commandIndex].run(e)},nextCommand(){let e=this.stack.top;if(e.commandIndex>=e.commands.length-1){if(this.stack.pop(),this.stack.isEmpty){if(this.state.repeat)return this.start(this.state.topLevelScript,X.RUN,!1),!1;this.stop()}else if(this.stack.top.commandState&&this.stack.top.commandState.advanceOnPop)return Q.logCommandEvent(`Exiting IF block`,this.stack.top.commandState.ifEndLine),this.nextCommand()}else e.commandState=null,++e.commandIndex;return!0},push(e){e.length!==0&&this.stack.push(e)},findScript(e){return this._scripts.find(t=>t.id===e)},_createDefaultScript(){let e=it.create(`New Script`);return this._scripts=[e],this.state.topLevelScript=e.id,e.id},initializeFromSave(){let e=Object.keys(player.reality.automator.scripts).map(e=>Number.parseInt(e,10));e.length===0?e.push(this._createDefaultScript()):this._scripts=e.map(e=>new it(e)),e.includes(this.state.topLevelScript)||(this.state.topLevelScript=e[0]);let t=this.findScript(this.state.topLevelScript);if(t.commands){let e=t.commands;this.stack.initializeFromSave(e)||this.reset(e)}else this.stack.clear()},saveScript(e,t){let n=this.findScript(e);if(!n)return;let r=n.persistent.content,i=Math.abs(r.length-t.length);Q.pushUndoData(r,i),n.save(t),e===this.state.topLevelScript&&this.stop()},newScript(){let e=new Set(ct._scripts.map(e=>e.name)),t;if(e.has(`New Script`)){let n=2;for(;e.has(`New Script (${n})`);)n++;t=it.create(`New Script (${n})`)}else t=it.create(`New Script`);return this._scripts.push(t),t},deleteScript(e){let t=Object.values(player.reality.automator.scripts).findIndex(t=>t.id===e);delete player.reality.automator.scripts[Number.parseInt(Object.keys(player.reality.automator.scripts)[t],10)];let n=this._scripts.findIndex(t=>t.id===e);this._scripts.splice(n,1),this._scripts.length===0&&(this._createDefaultScript(),this.clearEditor()),e===this.state.topLevelScript&&(this.stop(),this.state.topLevelScript=this._scripts[0].id),EventHub.dispatch(GAME_EVENT.AUTOMATOR_SAVE_CHANGED)},toggleRepeat(){this.state.repeat=!this.state.repeat},toggleForceRestart(){this.state.forceRestart=!this.state.forceRestart},toggleFollowExecution(){this.state.followExecution=!this.state.followExecution,this.jumpToActiveLine()},jumpToActiveLine(){let e=this.state;e.topLevelScript===e.editorScript&&this.isRunning&&e.followExecution&&st.scrollToRawLine(ct.stack.top.lineNumber)},reset(e){this.stack.clear(),this.push(e)},stop(){this.stack.clear(),this.state.mode=X.PAUSE,this.hasJustCompleted=!0,ot.clearAllHighlightedLines()},pause(){this.state.mode=X.PAUSE},start(e=this.state.topLevelScript,t=X.RUN,n=!0){if(!Player.automatorUnlocked)return;this.hasJustCompleted=!1,this.state.topLevelScript=e,player.reality.automator.execTimer=0;let r=this.findScript(e);r&&(n&&r.compile(),r.commands&&(this.reset(r.commands),this.state.mode=t),Q.isWaiting=!1,player.options.automatorEvents.clearOnRestart&&Q.clearEventLog())},restart(){this.start(this.state.topLevelScript,X.RUN),!this.stack.isEmpty&&this.reset(this.stack._data[0].commands)},changeModes(e){if(Tutorial.moveOn(TUTORIAL_STATE.AUTOMATOR),player.reality.automator.type===Z.BLOCK)BlockAutomator.parseTextFromBlocks(),player.reality.automator.type=Z.TEXT;else{let t=AutomatorTextUI.editor.getDoc().getValue();BlockAutomator.updateEditor(t),ct.saveScript(e,t),player.reality.automator.type=Z.BLOCK}ot.clearAllHighlightedLines(),EventHub.ui.dispatch(GAME_EVENT.AUTOMATOR_TYPE_CHANGED)},clearEditor(){player.reality.automator.type===Z.BLOCK?BlockAutomator.clearEditor():AutomatorTextUI.clearEditor()},stack:{_data:[],push(e){let t=new rt(this.length);t.initializeNew(e),this._data.push(t)},pop(){this._data.length!==0&&(player.reality.automator.state.stack.pop(),this._data.pop())},clear(){this._data=[],player.reality.automator.state.stack.length=0},initializeFromSave(e){this._data=[];let t=player.reality.automator.state.stack,n=e;for(let e=0;e<t.length;++e){let r=t[e],i=new rt(e);i.commands=n;let a=n.findIndex(e=>e.lineNumber===r.lineNumber);if(a===-1)return!1;if(i.commandIndex=a,this._data.push(i),e!==t.length-1){if(n[a].blockCommands===void 0)return!1;n=n[a].blockCommands}}return!0},get top(){return this._data[this.length-1]},get length(){if(this._data.length!==player.reality.automator.state.stack.length)throw Error(`Inconsistent stack length`);return this._data.length},get isEmpty(){return this._data.length===0}}},lt={get perks(){return Perks.all.filter(e=>e.automatorPoints)},get upgrades(){return RealityUpgrades.all.filter(e=>e.automatorPoints)},get pointsFromPerks(){return this.perks.filter(e=>e.isBought).map(e=>e.automatorPoints).nSum()},get pointsFromUpgrades(){return this.upgrades.filter(e=>e.isBought).map(e=>e.automatorPoints).nSum()},get pointsFromOther(){return GameDatabase.reality.automator.otherAutomatorPoints.map(e=>e.automatorPoints()).nSum()},get totalPoints(){return this.pointsFromPerks+this.pointsFromUpgrades+this.pointsFromOther},get pointsForAutomator(){return 100}};var ut={name:`AutomatorBlockSingleInput`,props:{constant:{type:String,required:!1,default:``},block:{type:Object,required:!0},blockTarget:{type:String,required:!1,default:``},updateFunction:{type:Function,required:!0},initialSelection:{type:String,required:!1,default:``},patterns:{type:Array,required:!1,default:()=>[]},recursive:{type:Boolean,required:!1,default:!1},currentPath:{type:String,required:!1,default:``}},data(){return{b:{},suppressTooltip:!1,errors:[],hasError:!1,isTextInput:!1,dropdownOptions:[],dropdownSelection:``,textContents:``,pathRef:{},currentNodeOnPath:``,unknownNext:!1,nextNodeCount:0,lineNumber:0,scriptID:0}},computed:{displayedConstant(){return this.constant?this.constant===`BLOB`?``:this.constant:this.dropdownOptions.length===1&&!this.isBoolTarget&&!this.isTextInput?this.dropdownOptions[0]:``},isBoolTarget(){return this.blockTarget===`nowait`||this.blockTarget===`respec`},nextInputKey(){return this.block.targets[this.currentPath.length+1]},nextInputValue(){let e=this.block.targets?this.block[this.nextInputKey]:``;return e?`${e}`:``},hasLongTextInput(){return this.block.cmd===`NOTIFY`||this.block.cmd===`COMMENT`}},created(){if(this.scriptID=player.reality.automator.state.editorScript,this.b=this.block,this.lineNumber=BlockAutomator.lineNumber(BlockAutomator._idArray.indexOf(this.block.id)+1),BlockAutomator.updateIdArray(),!this.constant){if(this.isBoolTarget){this.dropdownOptions=[this.blockTarget.toUpperCase()],this.dropdownSelection=this.block[this.blockTarget]?this.blockTarget.toUpperCase():``;return}if(this.recursive){let e=this.patterns.filter(e=>e.startsWith(this.currentPath)&&e.length>this.currentPath.length).map(e=>e.charAt(this.currentPath.length));for(let t of e){if(this.pathRef[t])continue;let e=this.block[t];this.pathRef[t]=e,this.dropdownOptions.push(...e)}this.calculatePath()}this.dropdownOptions.includes(this.initialSelection)?this.dropdownSelection=this.initialSelection:this.initialSelection&&(this.isTextInput=!0,this.textContents=this.initialSelection),this.dropdownOptions.length===1&&this.dropdownOptions[0].startsWith(`*`)&&(this.isTextInput=!0,this.textContents=this.initialSelection),this.recalculateErrorCount(),this.suppressTooltip=!0,BlockAutomator.parseTextFromBlocks()}},destroyed(){if(player.reality.automator.type===AUTOMATOR_TYPE.TEXT||Tabs.current._currentSubtab.key!==`automator`||this.scriptID!==player.reality.automator.state.editorScript)return;this.recalculateErrorCount();let e=BlockAutomator.lineNumber(BlockAutomator._idArray.indexOf(this.block.id)+1);if(this.lineNumber!==e){let e=[];for(let t of AutomatorData.cachedErrors)t.startLine!==this.lineNumber&&e.push(t);e.sort((e,t)=>e.startLine-t.startLine),AutomatorData.cachedErrors=e;return}this.recalculateErrorCount(),BlockAutomator.parseTextFromBlocks()},methods:{update(){this.errors=AutomatorData.cachedErrors,this.hasError=this.errors.some(e=>e.startLine===this.lineNumber),this.dropdownSelection.startsWith(`*`)&&(this.isTextInput=!0),this.calculatePath()},calculatePath(){this.currentNodeOnPath=` `;for(let e of Object.keys(this.pathRef)){let t=this.pathRef[e].some(e=>e.startsWith(`*`))&&this.isTextInput;(this.pathRef[e].includes(this.dropdownSelection)||t)&&(this.currentNodeOnPath=e)}let e=this.currentPath+this.currentNodeOnPath;this.nextNodeCount=this.patterns.filter(t=>t.length>e.length&&t.startsWith(e)).length,this.unknownNext=this.nextNodeCount>1||this.dropdownSelection===``&&!this.isTextInput},validateInput(){let e,t;if(this.b.nest){let n={...this.b};n.nest=[],t=BlockAutomator.parseLines([n]),e=$e(t.join(`
`))}else t=BlockAutomator.parseLines([this.b]),e=$e(t[0]);if(t[0]===`undefined`)return;let n=[],r=BlockAutomator._idArray.filter(e=>e).length;for(let e of AutomatorData.cachedErrors)e.startLine!==this.lineNumber&&e.startLine<r&&n.push(e);if(e.errors.length>0){let t=e.errors[0];t.startLine=this.lineNumber,n.push(t)}n.sort((e,t)=>e.startLine-t.startLine),AutomatorData.cachedErrors=n},handleFocus(e){this.suppressTooltip=!e,this.changeBlock()},changeBlock(){if(this.updateFunction(this.block,this.block.id),this.blockTarget){let e;if(e=this.isBoolTarget?this.dropdownSelection!==``:this.isTextInput?this.textContents:this.dropdownSelection,this.block[this.blockTarget]=e,this.calculatePath(),this.nextNodeCount===0&&!this.isBoolTarget){let e=this.block.targets.indexOf(this.blockTarget);for(let t=e+1;t<this.block.targets.length;t++)this.block[this.block.targets[t]]=void 0}}this.recalculateErrorCount()},recalculateErrorCount(){BlockAutomator.parseTextFromBlocks(this.scriptID),this.validateInput(),AutomatorBackend.currentEditingScript.id===AutomatorBackend.currentRunningScript.id&&AutomatorBackend.stop()},errorTooltip(){if(!this.hasError||this.suppressTooltip)return;let e=this.errors.find(e=>e.startLine===this.lineNumber).info;return e=e.replaceAll(`
`,``).replace(/Expecting: one of these possible Token sequences:.*but found: (.*)/iu,`Unexpected input format: $1`),{content:`<div class="c-block-automator-error">
          <div>${e}</div>
        </div>`,html:!0,trigger:`manual`,show:!0,classes:[`c-block-automator-error-container`,`general-tooltip`]}},textInputClassObject(){return{"o-automator-block-input":!0,"o-long-text-input":this.hasLongTextInput,"l-error-textbox":this.hasError,"c-automator-input-required":!this.hasError}},dropdownClassObject(){return{"o-automator-block-input":!0,"c-automator-input-required":!this.isBoolTarget,"c-automator-input-optional":this.isBoolTarget,"l-error-textbox":this.hasError&&!this.isBoolTarget&&this.dropdownSelection===``}},revertToDropdown(){this.isTextInput=!1,this.dropdownSelection=``,this.textContents=``}}},dt=a(ut,function(){var e=this,t=e._self._c;return t(`div`,{staticClass:`c-automator-single-block`},[e.displayedConstant?t(`div`,{staticClass:`c-automator-single-block o-automator-command c-automator-constant-block`,class:{"l-blob":e.constant===`BLOB`}},[e._v(` `+e._s(e.displayedConstant)+` `)]):e.isTextInput?t(`div`,{staticClass:`c-automator-text-input-container`},[t(`input`,{directives:[{name:`model`,rawName:`v-model`,value:e.textContents,expression:`textContents`},{name:`tooltip`,rawName:`v-tooltip`,value:e.errorTooltip(),expression:`errorTooltip()`}],class:e.textInputClassObject(),domProps:{value:e.textContents},on:{keyup:function(t){return e.changeBlock()},focusin:function(t){return e.handleFocus(!0)},focusout:function(t){return e.handleFocus(!1)},input:function(t){t.target.composing||(e.textContents=t.target.value)}}}),e.dropdownOptions.length>1?t(`div`,{staticClass:`c-automator-close-text-input fa-solid fa-circle-xmark`,on:{click:e.revertToDropdown}}):e._e()]):t(`select`,{directives:[{name:`model`,rawName:`v-model`,value:e.dropdownSelection,expression:`dropdownSelection`}],class:e.dropdownClassObject(),on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return`_value`in e?e._value:e.value});e.dropdownSelection=t.target.multiple?n:n[0]},function(t){return e.changeBlock()}]}},e._l([``,...e.dropdownOptions],function(n){return t(`option`,{key:n,domProps:{value:n}},[e._v(` `+e._s(n)+` `)])}),0),e.recursive&&e.nextNodeCount>0?t(`AutomatorBlockSingleInput`,{key:e.currentNodeOnPath,attrs:{constant:e.unknownNext?`...`:``,block:e.block,"block-target":e.nextInputKey,patterns:e.patterns,"initial-selection":e.nextInputValue,"update-function":e.updateFunction,recursive:!0,"current-path":e.currentPath+e.currentNodeOnPath}}):e._e()],1)},[],!1,null,`8cdf61e4`,null,null).exports,ft={name:`AutomatorBlockSingleRow`,components:{draggable:e(i()).default,AutomatorBlockSingleInput:dt},props:{block:{type:Object,required:!0},updateBlock:{type:Function,required:!0},deleteBlock:{type:Function,required:!0}},data(){return{b:{},activeLine:-1,eventLine:-1,errorLine:-1}},computed:{lineNumber(){return BlockAutomator.lineNumberFromBlockID(this.b.id)},isActiveLine(){return this.lineNumber===this.activeLine},isEventLine(){return this.lineNumber===this.eventLine},isErrorLine(){return this.lineNumber===this.errorLine}},created(){this.recalculateErrorCount()},destroyed(){this.recalculateErrorCount()},mounted(){this.b=this.block},methods:{update(){let e=AutomatorHighlighter.lines;this.activeLine=e.active,this.eventLine=e.event,this.errorLine=e.error},parseRequest(){BlockAutomator.parseTextFromBlocks()},deleteBlockFromNest(e){let t=this.b.nest.findIndex(t=>t.id===e);this.b.nest.splice(t,1)},updateBlockFromNest(e,t){this.$set(this.b.nest,this.b.nest.findIndex(e=>e.id===t),e),this.parseRequest()},removeBlock(e,t){this.deleteBlock(e,t),this.recalculateErrorCount()},recalculateErrorCount(){AutomatorData.recalculateErrors(),AutomatorBackend.currentEditingScript.id===AutomatorBackend.currentRunningScript.id&&AutomatorBackend.stop()},highlightClass(){return{"c-automator-block-row-active":this.isActiveLine,"c-automator-block-row-event":this.isEventLine,"c-automator-block-row-error":this.isErrorLine}},nextSelection(){return this.b.targets?this.b[this.b.targets[0]]:``}}},pt=a(ft,function(){var e=this,t=e._self._c;return t(`div`,{staticClass:`c-automator-block-row--container`},[t(`div`,{staticClass:`c-automator-block-row`,class:e.highlightClass()},[t(`AutomatorBlockSingleInput`,{attrs:{constant:e.b.alias?e.b.alias:e.b.cmd,block:e.b,"update-function":e.updateBlock}}),e.b.canWait?t(`AutomatorBlockSingleInput`,{attrs:{block:e.b,"block-target":`nowait`,"initial-selection":e.b.nowait?`NOWAIT`:``,"update-function":e.updateBlock}}):e._e(),e.b.canRespec?t(`AutomatorBlockSingleInput`,{attrs:{block:e.b,"block-target":`respec`,"initial-selection":e.b.respec?`RESPEC`:``,"update-function":e.updateBlock}}):e._e(),e.b.allowedPatterns?t(`AutomatorBlockSingleInput`,{attrs:{block:e.b,"block-target":e.b.targets[0],patterns:e.b.allowedPatterns,"initial-selection":e.nextSelection(),"update-function":e.updateBlock,recursive:!0}}):e._e(),t(`div`,{staticClass:`o-automator-block-delete`,on:{click:function(t){return e.removeBlock(e.b.id)}}},[e._v(` X `)])],1),e.block.nested?t(`draggable`,{staticClass:`l-automator-nested-block`,attrs:{group:`code-blocks`},model:{value:e.block.nest,callback:function(t){e.$set(e.block,`nest`,t)},expression:`block.nest`}},e._l(e.block.nest,function(n){return t(`AutomatorBlockSingleRow`,{key:n.id,attrs:{block:n,"update-block":e.updateBlockFromNest,"delete-block":e.deleteBlockFromNest}})}),1):e._e()],1)},[],!1,null,`a2f8eeaa`,null,null).exports,mt=e(i()),ht=n({name:`AutomatorBlockEditor`,components:{AutomatorBlockSingleRow:pt,draggable:mt.default},computed:{lines:{get(){return this.$viewModel.tabs.reality.automator.lines},set(e){this.$viewModel.tabs.reality.automator.lines=e}},numberOfLines(){return this.lines.reduce((e,t)=>e+$.numberOfLinesInBlock(t),0)}},mounted(){$.initialize(),AutomatorData.recalculateErrors(),$.editor.scrollTo(0,$.previousScrollPosition),$.gutter.style.bottom=`${$.editor.scrollTop}px`},methods:{update(){AutomatorBackend.state.followExecution&&AutomatorBackend.jumpToActiveLine();let e=AutomatorBackend.isOn?$.lineNumberFromBlockID($.currentBlockId):-1;AutomatorHighlighter.updateHighlightedLine(e,LineEnum.Active)},setPreviousScroll(){$.previousScrollPosition=this.$refs.blockEditorElement.scrollTop,$.gutter.style.bottom=`${$.editor.scrollTop}px`},parseRequest(){$.updateIdArray(),AutomatorData.recalculateErrors(),$.parseTextFromBlocks()},updateBlock(e,t){this.lines[this.lines.findIndex(e=>e.id===t)]=e,this.parseRequest()},deleteBlock(e){let t=this.lines.findIndex(t=>t.id===e);this.lines.splice(t,1),this.parseRequest()}}});const $={editor:null,gutter:null,_idArray:[],initialize(){this.editor=document.querySelectorAll(`.c-automator-block-editor`)[0],this.gutter=document.querySelectorAll(`.c-automator-block-editor--gutter`)[0]},get lines(){return ui.view.tabs.reality.automator.lines},set lines(e){ui.view.tabs.reality.automator.lines=e,this.updateIdArray()},get currentBlockId(){return AutomatorBackend.stack.isEmpty?!1:this._idArray[AutomatorBackend.stack.top.lineNumber-1]},lineNumber(e){let t=this._idArray.map((e,t)=>e?-1:t+1).filter(e=>e!==-1);return e-t.countWhere(t=>t<=e)},lineNumberFromBlockID(e){return this.lineNumber(this._idArray.indexOf(e)+1)},parseTextFromBlocks(e){let t=this.parseLines($.lines).join(`
`),n=e??ui.view.tabs.reality.automator.editorScriptID;AutomatorData.recalculateErrors(),AutomatorBackend.saveScript(n,t)},updateEditor(e){let t=Qe(e).blocks;return this.lines=t,t},hasUnparsableCommands(e){let t=Qe(e);return t.validatedBlocks!==t.visitedBlocks},generateText(e,t=0){let n=`${`	`.repeat(t)}${e.cmd} `;n=n.replace(`COMMENT`,`//`).replace(`BLOB`,`blob  `),e.canWait&&e.nowait&&(n=n.replace(/(\S+)/u,`$1 NOWAIT`)),e.respec&&(n+=` RESPEC`);for(let t of[`genericInput1`,`compOperator`,`genericInput2`,`singleSelectionInput`,`singleTextInput`])e[t]&&(n+=` ${e[t]}`);return(e.cmd===`IF`||e.cmd===`WHILE`||e.cmd===`UNTIL`)&&(n+=` {`),n.replace(`  `,` `)},parseLines(e,t=0){let n=[];for(let r=0;r<e.length;r++)n.push(this.generateText(e[r],t)),(e[r].cmd===`IF`||e[r].cmd===`WHILE`||e[r].cmd===`UNTIL`)&&(n.push(...this.parseLines(e[r].nest,t+1)),n.push(`${`	`.repeat(t)}}`));return n},blockIdArray(e){let t=[];for(let n=0;n<e.length;n++){let r=e[n];t.push(r.id),r.nested&&t.push(...this.blockIdArray(r.nest),void 0)}return t},updateIdArray(){this._idArray=this.blockIdArray(this.lines)},numberOfLinesInBlock(e){return e.nested?Math.max(e.nest.reduce((e,t)=>e+this.numberOfLinesInBlock(t),1),2):1},clearEditor(){setTimeout(()=>this.lines=[],0)},previousScrollPosition:0};var gt=a(ht,function(){var e=this,t=e._self._c;return e._self._setupProxy,t(`div`,{staticClass:`c-automator-block-editor--container`},[t(`div`,{ref:`editorGutter`,staticClass:`c-automator-block-editor--gutter`},e._l(e.numberOfLines,function(n){return t(`div`,{key:n,staticClass:`c-automator-block-line-number`,style:{top:`${(n-1)*3.45}rem`}},[e._v(` `+e._s(n)+` `)])}),0),t(`div`,{ref:`blockEditorElement`,staticClass:`c-automator-block-editor`,on:{scroll:function(t){return e.setPreviousScroll()}}},[t(`draggable`,{staticClass:`c-automator-blocks`,attrs:{group:`code-blocks`,"ghost-class":`c-automator-block-row-ghost`},on:{end:e.parseRequest},model:{value:e.lines,callback:function(t){e.lines=t},expression:`lines`}},e._l(e.lines,function(n,r){return t(`AutomatorBlockSingleRow`,{key:n.id+1e4*r,attrs:{block:n,"update-block":e.updateBlock,"delete-block":e.deleteBlock}})}),1)],1)])},[],!1,null,`03efe65d`,null,null).exports;export{Ie as _,X as a,ct as c,it as d,st as f,$e as g,Ze as h,Y as i,Q as l,Qe as m,$ as n,Z as o,at as p,lt as r,nt as s,gt as t,ot as u};