import{b as e}from"./_plugin-vue2_normalizer-1QcuHEq3.js";const t={name:`AutomatorTextEditor`,props:{currentScriptId:{type:[Number,String],required:!0}},data(){return{markedLineNumber:0,unclearedLines:!1,isActiveScript:!1}},computed:{UI(){return n.initialize(),n},fullScreen(){return this.$viewModel.tabs.reality.automator.fullScreen}},watch:{currentScriptId:{handler(e,t){this.unmarkActiveLine();let n=player.reality.automator.scripts;(!this.UI.documents[e]||this.UI.documents[e].getValue()!==n[e].content)&&(this.UI.documents[e]=CodeMirror.Doc(n[e].content,`automato`)),this.UI.editor.getDoc()!==this.UI.documents[e]&&this.UI.editor.swapDoc(this.UI.documents[e]),this.UI.documents[t]!==void 0&&n[t]===void 0&&delete this.UI.documents[t]},immediate:!0},fullScreen(){this.$nextTick(()=>this.UI.editor.refresh())}},created(){n.initialize(),this.on$(GAME_EVENT.GAME_LOAD,()=>this.onGameLoad()),this.on$(GAME_EVENT.AUTOMATOR_SAVE_CHANGED,()=>this.onGameLoad())},mounted(){this.$refs.container.append(this.UI.container),this.$nextTick(()=>{this.UI.editor.refresh(),this.UI.editor.performLint(),this.UI.editor.scrollTo(null,n.savedVertPos)})},beforeDestroy(){AutomatorHighlighter.clearAllHighlightedLines(),n.savedVertPos=n.editor.doc.scrollTop,this.$refs.container.removeChild(this.UI.container)},methods:{update(){AutomatorBackend.jumpToActiveLine(),this.unclearedLines&&!AutomatorBackend.isOn&&this.clearAllActiveLines(),AutomatorBackend.isOn?this.setActiveState(`${AutomatorBackend.state.topLevelScript}`,AutomatorBackend.stack.top.lineNumber):this.setActiveState(``,-1)},onGameLoad(){this.UI.documents={}},unmarkActiveLine(){AutomatorHighlighter.updateHighlightedLine(-1,LineEnum.Active)},markActiveLine(e){AutomatorHighlighter.updateHighlightedLine(e,LineEnum.Active),this.unclearedLines=!0},clearAllActiveLines(){AutomatorHighlighter.clearAllHighlightedLines(),this.unclearedLines=!1},setActiveState(e,t){`${this.currentScriptId}`===e?this.markActiveLine(t):this.unmarkActiveLine()}}},n={documents:{},wrapper:null,editor:null,container:null,textArea:null,mode:{mode:`automato`,lint:`automato`,lineNumbers:!0,theme:`liquibyte`,tabSize:2,extraKeys:{Tab:e=>e.execCommand(`indentMore`),"Shift-Tab":e=>e.execCommand(`indentLess`)},autoCloseBrackets:!0,lineWrapping:!0},initialize(){this.container||(this.setUpContainer(),this.setUpEditor(),EventHub.ui.on(GAME_EVENT.GAME_LOAD,()=>this.documents={}))},setUpContainer(){this.container=document.createElement(`div`),this.container.className=`l-automator-editor__codemirror-container`,this.textArea=document.createElement(`textarea`),this.container.append(this.textArea)},setUpEditor(){this.editor=CodeMirror.fromTextArea(this.textArea,this.mode),this.editor.on(`beforeChange`,(e,t)=>{t.origin===`undo`&&t.cancel()}),this.editor.on(`keydown`,(e,t)=>{let n=t.key;if(t.ctrlKey&&[`z`,`y`].includes(n)){n===`z`&&AutomatorData.undoScriptEdit(),n===`y`&&AutomatorData.redoScriptEdit();return}e.state.completionActive||t.ctrlKey||t.altKey||t.metaKey||!/^[a-zA-Z0-9 \t]$/u.test(n)||CodeMirror.commands.autocomplete(e,null,{completeSingle:!1})}),this.editor.on(`change`,(e,t)=>{let n=ui.view.tabs.reality.automator.editorScriptID,r=e.getDoc().getValue();t.origin!==`setValue`&&(AutomatorBackend.saveScript(n,r),AutomatorData.redoBuffer=[]),AutomatorData.recalculateErrors();let i=AutomatorData.currentErrors().length;i>e.doc.size&&SecretAchievement(48).unlock(),AutomatorHighlighter.clearAllHighlightedLines()})},clearEditor(){this.editor||(this.setUpContainer(),this.setUpEditor()),this.editor.setValue(``),this.editor.clearHistory(),this.editor.clearGutter(`gutterId`)},savedVertPos:0};var r=function(){var e=this,t=e._self._c;return t(`div`,{ref:`container`,staticClass:`c-automator-editor l-automator-editor l-automator-pane__content`})},i=[],a=e(t,r,i,!1,null,null,null,null),o=a.exports;export{o as b,n as c};